[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Phd scripts book",
    "section": "",
    "text": "Overview\nThis book This book brings together the scripts developed within the PhD project “Evaluation of above-ground carbon dynamics in Sustainable Forest Management in the Amazon: providing support to Brazil’s climate commitments”, carried out by Gustavo Bediaga in the Graduate Program in Ecology at the University of Brasília.\nThe project is supervised by Dr. Mercedes Bustamante and developed in partnership with CIRAD, with the collaboration of researchers Plinio Sist, Sylvain Schmmit and Géraldine Derroire.\nThe scripts address the following topics:\n- Forest structure;\n- LiDAR-derived metrics;\n- Wood density databases;\n- Biomass estimation.\nAll scripts were written in RStudio 2025.09.2+418 as Quarto files, and were subsequently rendered into the HTML documents available here.",
    "crumbs": [
      "Overview"
    ]
  },
  {
    "objectID": "11_pps_prep.html",
    "href": "11_pps_prep.html",
    "title": "PPS prep",
    "section": "",
    "text": "Introduction\nThis is a script to merge all Permanent Plots (PP) tables from Floresta Nacional do Jamari (Flona do Jamari) used in my Phd project. Those PPs are within Annual Production Units (APU) from Flona do Jamari that had at least three Lidar flights. PPs tables were provided by Madeflona. There is a xlsx file for each year measurement on each APU. We organized the files in subdirectories following this scheme: ./data/tables/FMU_NAME/APU_NAME/xlxs files.",
    "crumbs": [
      "Data prep",
      "PPS prep"
    ]
  },
  {
    "objectID": "11_pps_prep.html#setup",
    "href": "11_pps_prep.html#setup",
    "title": "PPS prep",
    "section": "Setup",
    "text": "Setup\n\n\nCode\nlibrary(dplyr)\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(readxl)\nlibrary(stringr)\nlibrary(kableExtra)\nlibrary(openxlsx)",
    "crumbs": [
      "Data prep",
      "PPS prep"
    ]
  },
  {
    "objectID": "11_pps_prep.html#permanent-plots-information",
    "href": "11_pps_prep.html#permanent-plots-information",
    "title": "PPS prep",
    "section": "Permanent plots information",
    "text": "Permanent plots information\nPermanent plots were installed and measured following guidelines from (natalino2005?).\nAll PPs have 2,500 m2 (50 x 50 mts). Below you can see PPs distribution in the Flona do Jamari. Shapefiles of the PPs were provided by Madeflona. PPs shapefiles are in 31980 projection.\n\n\nCode\nflona_jamari &lt;- st_read(\"data/pps/geo/flona_jamari.shp\")\n\n\nReading layer `flona_jamari' from data source \n  `C:\\Gustavo\\Doutorado\\Dados\\UPAS da pesquisa\\Jamari\\Sylvain\\Jamari\\data\\pps\\geo\\flona_jamari.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 1 feature and 17 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: -63.21411 ymin: -9.48225 xmax: -62.73561 ymax: -8.961797\nGeodetic CRS:  SIRGAS 2000\n\n\nCode\nst_crs(flona_jamari) &lt;- 4674\n\numfs &lt;- st_read(\"data/pps/geo/umfs_RO.shp\")\n\n\nReading layer `umfs_RO' from data source \n  `C:\\Gustavo\\Doutorado\\Dados\\UPAS da pesquisa\\Jamari\\Sylvain\\Jamari\\data\\pps\\geo\\umfs_RO.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 5 features and 37 fields\nGeometry type: POLYGON\nDimension:     XYZM\nBounding box:  xmin: -63.20273 ymin: -9.483388 xmax: -62.71628 ymax: -8.319433\nz_range:       zmin: -1 zmax: 0\nm_range:       mmin: 0 mmax: 0\nCRS:           NA\n\n\nCode\numfs &lt;- umfs[2:3, ]\n\nst_crs(umfs) &lt;- 4674\n\npps_umf1 &lt;- st_read(\"data/pps/geo/handheld_gps/JAM1_PP.shp\")\n\n\nReading layer `JAM1_PP' from data source \n  `C:\\Gustavo\\Doutorado\\Dados\\UPAS da pesquisa\\Jamari\\Sylvain\\Jamari\\data\\pps\\geo\\handheld_gps\\JAM1_PP.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 100 features and 9 fields\nGeometry type: POINT\nDimension:     XYZ\nBounding box:  xmin: 497670 ymin: 8981113 xmax: 503674.7 ymax: 8997246\nz_range:       zmin: 0 zmax: 0\nCRS:           NA\n\n\nCode\npps_umf4 &lt;- st_read(\"data/pps/geo/handheld_gps/JAM4_U15_PP.shp\")\n\n\nReading layer `JAM4_U15_PP' from data source \n  `C:\\Gustavo\\Doutorado\\Dados\\UPAS da pesquisa\\Jamari\\Sylvain\\Jamari\\data\\pps\\geo\\handheld_gps\\JAM4_U15_PP.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 4 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 505049.3 ymin: 8988785 xmax: 507849.3 ymax: 8989232\nCRS:           NA\n\n\nCode\nst_crs(pps_umf1) &lt;- 31980\nst_crs(pps_umf4) &lt;- 31980\n\n\nggplot() +\n  geom_sf(data = flona_jamari, \n          fill = NA, \n          color = \"black\") +\n  geom_sf(data = umfs, \n          fill = NA,\n          color = \"orange\") +\n  geom_sf(data = pps_umf1, \n          color = \"red\", \n          size = 1) +\n  geom_sf(data = pps_umf4, \n          color = \"blue\", \n          size = 1) +\n theme_minimal() +\n  labs(\n    title = paste0(nrow(pps_umf1) + nrow(pps_umf4),\n                   \" Permanent Plots\"),\n    subtitle = \"FLONA do Jamari – FMU 1 and 4\",\n    x = \"Longitude\",\n    y = \"Latitude\"\n  )\n\n\n\n\n\n\n\n\n\nThe PPs tables contain several columns with information collected in the field. Below are the column headers and an example row.\n\n\nCode\npp_table_header &lt;- read.xlsx(\"data/pps/tables/UMF_I/UPA_1/JAM_I_UPA_1_2010.xlsx\",\n                                       rows = c(1, 2))\n\npp_table_header %&gt;%\n   kbl(caption = \"PP table columns\") %&gt;%\n   kable_classic(full_width = FALSE)\n\n\n\nPP table columns\n\n\np23_cdarea\np23_cdmedicao\np23_cdparcela\np23_cdsubparcela\np23_nrindividuo\np23_cdespecie\nEspecie\np23_cdcif\ndiametromm\np23_lgmudancapdm\np23_cdtratamento\np23_cdiluminacao\n\n\n\n\n6\n2010\n1\n1\n1\n113\nItaubarana [Ni ni] [00113]\n1\n190\nNA\n5\n2\n\n\n\n\n\nThe meaning of each column is described below. A complete description can be found in (natalino2005?).\np23_cdarea = area code;\np23_cdmedicao = year of measurement;\np23_cdparcela = plot number;\np23_cdsubparcela = subplot number;\np23_nrindividuo = sequential number of individual measurement;\np23_cdespecie = unique code for species;\nEspecie = common name of the species;\np23_cdcif = see table below;\ndiametromm = DBH in mm;\np23_lgmudancapdm = only filled if there was a change in the trunk point of measurement;\np23_cdcif = tree status in the forest. see table below.\n\n\nCode\npp_table_codes &lt;- read.csv(\"data/pps/tables/pps_table_codes.csv\")\n\npp_table_codes %&gt;%\n   slice(c(1:16)) %&gt;%\n   kbl(caption = \"p23_cdcif codes\") %&gt;%\n   kable_classic(full_width = FALSE)\n\n\n\np23_cdcif codes\n\n\nColumn\nColumn.description\nCode\nCode.description\n\n\n\n\np23_cdcif\nThis variable describes the different states in which trees can be found in a forest. These states result from the tree's own growth or from changes caused by human activities or natural processes. The numerical codes used combine the health condition of the individual with the status of its stem. In the first measurement, only living individuals are considered. From the second measurement onward, all individuals must be recorded, including those that are dead or not found.\n1\nStanding live tree with an intact stem\n\n\n\n\n2\nStanding live tree without a crown, with a stem equal to or longer than 4.0 m\n\n\n\n\n3\nStanding live tree without a crown, with a stem shorter than 4.0 m\n\n\n\n\n4\nFallen live tree\n\n\n\n\n5\nTree dead from natural causes\n\n\n\n\n6\nTree dead due to logging\n\n\n\n\n7\nTree dead due to silvicultural treatment\n\n\n\n\n8\nHarvested tree (logging stump)\n\n\n\n\n9\nTree not found\n\n\n\n\n10\nTree dead due to unknown anthopogenic causes\n\n\n\n\n11\nLeaning (supported) tree due to natural causes: a tree whose stem was tilted by natural damage and is supported by neighboring trees.\n\n\n\n\n12\nLeaning (supported) tree due to logging: a tree whose stem was tilted as a result of logging activities and is supported by neighboring trees.\n\n\n\n\n13\nInclined tree due to natural causes: a tree leaning at an angle greater than 45 degrees, caused by the natural fall of another tree or by the search for better light conditions.\n\n\n\n\n14\nInclined tree due to logging: a tree leaning at an angle greater than 45 degrees as a result of logging activities.\n\n\n\n\n15\nBent (arched) tree due to natural causes: a tree bent due to the presence of lianas or the natural fall of another tree.\n\n\n\n\n16\nBent (arched) tree due to logging: a tree bent as a result of logging activities.\n\n\n\n\n\np23_cdtratamento = silvicultural status. see table below.\n\n\nCode\npp_table_codes %&gt;%\n   slice(c(17:22)) %&gt;%\n   kbl(caption = \"p23_cdtratamento codes\") %&gt;%\n   kable_classic(full_width = FALSE)\n\n\n\np23_cdtratamento codes\n\n\nColumn\nColumn.description\nCode\nCode.description\n\n\n\n\np23_cdtratamento\nThis field identifies the condition of each tree with respect to the silvicultural actions applied in the forest.\n1\nTree with harvesting potential: the tree must have a straight stem, free of defects along its entire length, or be suitable for producing a log of at least 4 m in length. This code should be used even in areas where timber harvesting is not intended (control areas or permanent preservation areas), as it serves as an indicator of the forest's productive capacity.\n\n\n\n\n2\nGirdled tree: a tree from which a ring of bark has been removed as a silvicultural treatment, with the purpose of causing its devitalization.\n\n\n\n\n3\nGirdled tree treated with chemical product: a tree from which a ring of bark has been removed and that has received a chemical product as a silvicultural treatment, with the purpose of causing its devitalization.\n\n\n\n\n4\nTree benefiting from silvicultural treatment: a tree that has benefited from silvicultural treatments such as thinning or liana cutting, in order to release its crown and increase light availability.\n\n\n\n\n5\nTree neither reserved nor treated: a tree that was not selected for harvesting, did not benefit from silvicultural treatment, was not girdled, and did not receive chemical treatment. This category includes trees of species that do not reach large size or that, even if commercial or potentially commercial, have severely damaged, rotten, or highly deformed stems.\n\n\n\n\n6\nNo silvicultural status: harvested tree; tree dead from any cause; tree not found.\n\n\n\n\n\np23_cdiluminacao = crown sun exposure. see table below.\n\n\nCode\npp_table_codes %&gt;%\n   slice(c(23:26)) %&gt;%\n   kableExtra::kbl(caption = \"p23_cdiluminacao codes\") %&gt;%\n   kableExtra::kable_classic(full_width = FALSE)\n\n\n\np23_cdiluminacao codes\n\n\nColumn\nColumn.description\nCode\nCode.description\n\n\n\n\np23_cdiluminacao\nThe crown light exposure variable indicates the level of light exposure of the tree crown, as well as the degree of competition with the crowns of neighboring trees. This variable is important because it represents one of the factors that significantly influence growth. In the assessment of crown light exposure, only living, standing trees (whether complete or broken) with a diameter of approximately 10 cm or more are considered.\n1\nEmergent crown or fully exposed to light\n\n\n\n\n2\nPartially illuminated crown, i.e., partially shaded by neighboring tree crowns\n\n\n\n\n3\nCompletely shaded crown by neighboring tree crowns, receiving only lateral or diffuse light\n\n\n\n\n4\nNot assessed (tree without a crown)",
    "crumbs": [
      "Data prep",
      "PPS prep"
    ]
  },
  {
    "objectID": "11_pps_prep.html#standardizing-and-merging-all-tables-in-one",
    "href": "11_pps_prep.html#standardizing-and-merging-all-tables-in-one",
    "title": "PPS prep",
    "section": "Standardizing and merging all tables in one",
    "text": "Standardizing and merging all tables in one\nWe will standardize the PPs tables, add some extra columns and merge all tables in only one. First, let’s read all tables.\n\n\nCode\nlista.pps &lt;- list.files(\".\",\n                        \"^JAM.*\\\\.xls[x]?$\",\n                        recursive = T)\n\n\nWe have xlsx and xls files. We will do a loop to:\n\nUse read.excel to read the file;\nRetrieve the APU and FMU information from the directories and add corresponding columns;\nAdd a DBH column in cm (by dividing diametromm by ten);\nAdd a column with the species’ common name (retrieved in the Especie column);\nAdd separate columns for the epithet and genus extracted from the scientific name (retrieved in the Especie column);\nAdd a unique individual numeric code column in the final table.\n\n\n\nCode\ntabelao.pps &lt;- data.frame()\n\nfor(i in 1:length(lista.pps)) {\n  \n  \n  upa.table &lt;- read_excel(lista.pps[i])\n  \n  upa.table$UPA &lt;- basename(dirname(lista.pps[i]))\n  \n  upa.table$UMF &lt;- basename(dirname(dirname(lista.pps[i])))\n                      \n  \n  upa.table$diametrocm &lt;- upa.table$diametromm / 10\n  \n  # Cria uma coluna com nome popular\n  upa.table$nome_pop &lt;- str_extract(upa.table$Especie, \n                                    \".+?(?=\\\\s)\")\n  \n  # Separa o nome científico  \n  upa.table &lt;- upa.table %&gt;%\n    mutate(Especie =  str_extract(upa.table$Especie, \n                                  \"(?&lt;=\\\\[).+?(?=\\\\])\")) %&gt;%\n    tidyr::separate(`Especie`,\n                    c(\"genero\",\n                      \"epiteto\"),\n                      \" \")\n  \n  tabelao.pps &lt;&lt;- rbind(tabelao.pps,\n                        upa.table)\n  \n}\n\ntabelao.pps$cod_indiv &lt;- paste(tabelao.pps$UMF,\n                               tabelao.pps$UPA,\n                               tabelao.pps$p23_cdparcela,\n                               tabelao.pps$p23_cdsubparcela,\n                               tabelao.pps$p23_nrindividuo,\n                               sep=\"_\")\n\nwrite.csv(tabelao.pps,\n          \"output/pps/tabelao_pps.csv\")\n\n\nNow we have all PPs data merged in one main table (tabelao.pps). Let’s take a look at the data.\n\n\nCode\ntabelao.pps %&gt;%\n    group_by(UMF, \n             UPA) %&gt;%\n    summarise(\"Number of measurements\" = n_distinct(p23_cdmedicao),\n              \"Years\" = paste(sort(unique(p23_cdmedicao)), \n                              collapse = \", \"),\n              .groups = \"drop\") %&gt;%\n    kbl(caption = \"PPs measurements\") %&gt;%\n    kable_classic(full_width = FALSE)\n\n\n\nPPs measurements\n\n\nUMF\nUPA\nNumber of measurements\nYears\n\n\n\n\nUMF_I\nUPA_1\n5\n2010, 2013, 2016, 2018, 2021\n\n\nUMF_I\nUPA_10\n3\n2015, 2017, 2023\n\n\nUMF_I\nUPA_13\n2\n2020, 2022\n\n\nUMF_I\nUPA_2\n4\n2011, 2013, 2016, 2021\n\n\nUMF_I\nUPA_3\n4\n2012, 2013, 2017, 2023\n\n\nUMF_I\nUPA_4\n4\n2012, 2014, 2018, 2023\n\n\nUMF_I\nUPA_5\n3\n2013, 2015, 2019\n\n\nUMF_I\nUPA_6\n3\n2014, 2016, 2020\n\n\nUMF_I\nUPA_7\n2\n2019, 2020\n\n\nUMF_I\nUPA_8\n2\n2017, 2019\n\n\nUMF_I\nUPA_9\n2\n2017, 2019\n\n\nUMF_IV\nUPA_15\n2\n2020, 2022\n\n\n\n\n\nCode\nsp_indiv &lt;- tabelao.pps %&gt;%\n    group_by(UMF, \n             UPA) %&gt;%\n    summarise(\"Number of species\" = n_distinct(paste0(genero,\n                                                      epiteto)),\n              \"Number of individuals\" = n(),\n              .groups = \"drop\")\n\nsp_indiv_total &lt;- tabelao.pps %&gt;%\n  summarise(\n    UMF = \"Total\",\n    UPA = \"-\",\n    \"Number of species\" = n_distinct(paste0(genero, \n                                            epiteto)),\n    \"Number of individuals\" = n()\n            )\n\ntabelao_final &lt;- bind_rows(sp_indiv, \n                           sp_indiv_total)\n\ntabelao_final %&gt;%\n    kbl(caption = \"Number of species and individuals\") %&gt;%\n    kable_classic(full_width = FALSE)\n\n\n\nNumber of species and individuals\n\n\nUMF\nUPA\nNumber of species\nNumber of individuals\n\n\n\n\nUMF_I\nUPA_1\n81\n5708\n\n\nUMF_I\nUPA_10\n66\n2894\n\n\nUMF_I\nUPA_13\n66\n2194\n\n\nUMF_I\nUPA_2\n75\n5400\n\n\nUMF_I\nUPA_3\n73\n5327\n\n\nUMF_I\nUPA_4\n77\n5738\n\n\nUMF_I\nUPA_5\n78\n3680\n\n\nUMF_I\nUPA_6\n80\n3680\n\n\nUMF_I\nUPA_7\n71\n1884\n\n\nUMF_I\nUPA_8\n69\n1845\n\n\nUMF_I\nUPA_9\n69\n1845\n\n\nUMF_IV\nUPA_15\n48\n895\n\n\nTotal\n-\n106\n41090\n\n\n\n\n\nCode\nggplot(tabelao.pps, aes(x = diametrocm)) +\n  geom_histogram(\n    binwidth = 5,\n    fill = \"steelblue\",\n    color = \"black\",\n    alpha = 0.8\n  ) +\n  theme_minimal() +\n  labs(\n    title = \"DBH histogram\",\n    x = \"DBH (cm)\",\n    y = \"Number of individuals\"\n  )",
    "crumbs": [
      "Data prep",
      "PPS prep"
    ]
  }
]