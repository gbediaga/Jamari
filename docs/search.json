[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Phd scripts book",
    "section": "",
    "text": "Overview\nThis book compiles the scripts developed as part of the PhD project “Evaluation of above-ground carbon dynamics in Sustainable Forest Management in the Amazon: providing support to Brazil’s climate commitments”, carried out by Gustavo Bediaga within the Graduate Program in Ecology at the University of Brasília.\nThe project is supervised by Dr. Mercedes Bustamante and conducted in partnership with CIRAD, with the collaboration of Drs. Plinio Sist, Sylvain Schmidt, and Géraldine Derroire.\nThe scripts were developed during a research mobility at CIRAD, from October 2025 to January 2026, with support from the PEPR FORESTT program. During this period, the following activities were carried out:\n\nLearning Quarto:\n\nAcquired proficiency in Quarto to ensure that all data processing and analyses performed during the PhD are reproducible and transparent.\nData harmonization and standardization:\n\nAll datasets were prepared and translated into Quarto, with a full step-by-step description. Permanent plots data were standardized (1  Preparation of Permament Plots data) and harmonized (2  Harmonizing Permanent Plots data) following the methodology of the BioForest project. Commercial forest inventories were also prepared (3  Merging IF100 + logbook data) and merged with logbook datasets.\nData exploration:\n\nPerformed exploratory (4  Exploring data) and comparative analyses (5  Comparing wood density databases) to understand patterns and behavior in the data.\nData processing and analyses:\n\nDeveloped a workflow (6  Workflow to extract tree height from Lidar CHM to retrieve total tree height from Canopy Height Models (CHMs) derived from LiDAR (7  Workflow to extract tree height from Lidar CHM).\nEstimated tree biomass using multiple approaches (8  Estimate biomass with different total height estimations).\nInitiated tree height modeling with various datasets from the same study site (9  Modelling DBH x Height).\n\n\nDuring the mobility, we established contact with researcher Fabian Fischer, author of Fischer et al. (2024), who processed the CHMs for the entire study area using his published methodology and made the data available for this PhD project.\nWe also discussed the project methodology with CIRAD partners and delivered a presentation on Brazilian Forest Concessions at the Unit of Forêts et Sociétés at CIRAD.\nOverall, this mobility was highly beneficial, providing valuable skills, methodological insights for the PhD project, and strengthening collaboration with CIRAD.\n\n\n\n\n\n\nNote\n\n\n\nAll scripts were written in RStudio 2025.09.2+418 as Quarto files and were subsequently rendered into the HTML documents made available here.\n\n\n\n\n\n\nFischer, Fabian Jörg, Toby Jackson, Grégoire Vincent, and Tommaso Jucker. 2024. “Robust Characterisation of Forest Structure from Airborne Laser Scanning—a Systematic Assessment and Sample Workflow for Ecologists.” Methods in Ecology and Evolution 15 (October): 1873–88. https://doi.org/10.1111/2041-210X.14416.",
    "crumbs": [
      "Overview"
    ]
  },
  {
    "objectID": "11_pps_prep.html",
    "href": "11_pps_prep.html",
    "title": "1  Preparation of Permament Plots data",
    "section": "",
    "text": "1.1 Introduction\nThis script merges all Permanent Plot (PP) tables from the Jamari National Forest (Flona do Jamari) used in my PhD project. These PPs are located within Annual Production Units (APUs) that have been covered by at least three LiDAR flights.\nThe PP tables were provided by Madeflona. For each APU and each measurement year, there is a corresponding Excel (.xlsx) file. The files were organized into subdirectories following the structure:\n./data/pps/tables/FMU_NAME/APU_NAME/xlxs files.",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Preparation of Permament Plots data</span>"
    ]
  },
  {
    "objectID": "11_pps_prep.html#setup",
    "href": "11_pps_prep.html#setup",
    "title": "1  Preparation of Permament Plots data",
    "section": "1.2 Setup",
    "text": "1.2 Setup\n\n\nCode\nlibrary(dplyr)\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(readxl)\nlibrary(stringr)\nlibrary(kableExtra)\nlibrary(openxlsx)\nlibrary(florabr)",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Preparation of Permament Plots data</span>"
    ]
  },
  {
    "objectID": "11_pps_prep.html#permanent-plots-information",
    "href": "11_pps_prep.html#permanent-plots-information",
    "title": "1  Preparation of Permament Plots data",
    "section": "1.3 Permanent plots information",
    "text": "1.3 Permanent plots information\nPermanent plots were installed and measured following guidelines from Natalino et al. (2005).\nAll PPs have 2,500 m2 (50 x 50 mts). Below you can see PPs distribution in the Flona do Jamari. Shapefiles of the PPs were provided by Madeflona. PPs shapefiles are in 31980 projection.\n\n\nCode\nflona_jamari &lt;- st_read(\"data/pps/geo/flona_jamari.shp\",\n                        quiet = TRUE)\nst_crs(flona_jamari) &lt;- 4674\n\numfs &lt;- st_read(\"data/pps/geo/umfs_RO.shp\",\n                quiet = TRUE)\numfs &lt;- umfs[2:3, ]\n\nst_crs(umfs) &lt;- 4674\n\npps_umf1 &lt;- st_read(\"data/pps/geo/handheld_gps/JAM1_PP.shp\",\n                    quiet = TRUE)\npps_umf4 &lt;- st_read(\"data/pps/geo/handheld_gps/JAM4_U15_PP.shp\",\n                    quiet = TRUE)\n\nst_crs(pps_umf1) &lt;- 31980\nst_crs(pps_umf4) &lt;- 31980\n\n\nggplot() +\n  geom_sf(data = flona_jamari, \n          fill = NA, \n          color = \"black\") +\n  geom_sf(data = umfs, \n          fill = NA,\n          color = \"orange\") +\n  geom_sf(data = pps_umf1, \n          color = \"red\", \n          size = 1) +\n  geom_sf(data = pps_umf4, \n          color = \"blue\", \n          size = 1) +\n theme_minimal() +\n  labs(\n    title = paste0(nrow(pps_umf1) + nrow(pps_umf4),\n                   \" Permanent Plots\"),\n    subtitle = \"FLONA do Jamari – FMU 1 and 4\",\n    x = \"Longitude\",\n    y = \"Latitude\"\n  )\n\n\n\n\n\n\n\n\n\nThe PPs tables contain several columns with information collected in the field. Below are the column headers and an example row.\n\n\nCode\npp_table_header &lt;- read.xlsx(\"data/pps/tables/UMF_I/UPA_1/JAM_I_UPA_1_2010.xlsx\",\n                                       rows = c(1, 2))\n\npp_table_header %&gt;%\n   kbl(caption = \"PP table columns\") %&gt;%\n   kable_classic(full_width = FALSE)\n\n\n\nPP table columns\n\n\np23_cdarea\np23_cdmedicao\np23_cdparcela\np23_cdsubparcela\np23_nrindividuo\np23_cdespecie\nEspecie\np23_cdcif\ndiametromm\np23_lgmudancapdm\np23_cdtratamento\np23_cdiluminacao\n\n\n\n\n6\n2010\n1\n1\n1\n113\nItaubarana [Ni ni] [00113]\n1\n190\nNA\n5\n2\n\n\n\n\n\nThe meaning of each column is described below. A complete description can be found in Natalino et al. (2005).\np23_cdarea = area code;\np23_cdmedicao = year of measurement;\np23_cdparcela = plot number;\np23_cdsubparcela = subplot number;\np23_nrindividuo = sequential number of individual measurement;\np23_cdespecie = unique code for species;\nEspecie = common name of the species;\np23_cdcif = see table below;\ndiametromm = DBH in mm;\np23_lgmudancapdm = only filled if there was a change in the trunk point of measurement;\np23_cdcif = tree status in the forest. see table below.\n\n\nCode\npp_table_codes &lt;- read.csv(\"data/pps/tables/pps_table_codes.csv\")\n\npp_table_codes %&gt;%\n   slice(c(1:16)) %&gt;%\n   kbl(caption = \"p23_cdcif codes\") %&gt;%\n   kable_classic(full_width = FALSE)\n\n\n\np23_cdcif codes\n\n\nColumn\nColumn.description\nCode\nCode.description\n\n\n\n\np23_cdcif\nThis variable describes the different states in which trees can be found in a forest. These states result from the tree's own growth or from changes caused by human activities or natural processes. The numerical codes used combine the health condition of the individual with the status of its stem. In the first measurement, only living individuals are considered. From the second measurement onward, all individuals must be recorded, including those that are dead or not found.\n1\nStanding live tree with an intact stem\n\n\n\n\n2\nStanding live tree without a crown, with a stem equal to or longer than 4.0 m\n\n\n\n\n3\nStanding live tree without a crown, with a stem shorter than 4.0 m\n\n\n\n\n4\nFallen live tree\n\n\n\n\n5\nTree dead from natural causes\n\n\n\n\n6\nTree dead due to logging\n\n\n\n\n7\nTree dead due to silvicultural treatment\n\n\n\n\n8\nHarvested tree (logging stump)\n\n\n\n\n9\nTree not found\n\n\n\n\n10\nTree dead due to unknown anthopogenic causes\n\n\n\n\n11\nLeaning (supported) tree due to natural causes: a tree whose stem was tilted by natural damage and is supported by neighboring trees.\n\n\n\n\n12\nLeaning (supported) tree due to logging: a tree whose stem was tilted as a result of logging activities and is supported by neighboring trees.\n\n\n\n\n13\nInclined tree due to natural causes: a tree leaning at an angle greater than 45 degrees, caused by the natural fall of another tree or by the search for better light conditions.\n\n\n\n\n14\nInclined tree due to logging: a tree leaning at an angle greater than 45 degrees as a result of logging activities.\n\n\n\n\n15\nBent (arched) tree due to natural causes: a tree bent due to the presence of lianas or the natural fall of another tree.\n\n\n\n\n16\nBent (arched) tree due to logging: a tree bent as a result of logging activities.\n\n\n\n\n\np23_cdtratamento = silvicultural status. see table below.\n\n\nCode\npp_table_codes %&gt;%\n   slice(c(17:22)) %&gt;%\n   kbl(caption = \"p23_cdtratamento codes\") %&gt;%\n   kable_classic(full_width = FALSE)\n\n\n\np23_cdtratamento codes\n\n\nColumn\nColumn.description\nCode\nCode.description\n\n\n\n\np23_cdtratamento\nThis field identifies the condition of each tree with respect to the silvicultural actions applied in the forest.\n1\nTree with harvesting potential: the tree must have a straight stem, free of defects along its entire length, or be suitable for producing a log of at least 4 m in length. This code should be used even in areas where timber harvesting is not intended (control areas or permanent preservation areas), as it serves as an indicator of the forest's productive capacity.\n\n\n\n\n2\nGirdled tree: a tree from which a ring of bark has been removed as a silvicultural treatment, with the purpose of causing its devitalization.\n\n\n\n\n3\nGirdled tree treated with chemical product: a tree from which a ring of bark has been removed and that has received a chemical product as a silvicultural treatment, with the purpose of causing its devitalization.\n\n\n\n\n4\nTree benefiting from silvicultural treatment: a tree that has benefited from silvicultural treatments such as thinning or liana cutting, in order to release its crown and increase light availability.\n\n\n\n\n5\nTree neither reserved nor treated: a tree that was not selected for harvesting, did not benefit from silvicultural treatment, was not girdled, and did not receive chemical treatment. This category includes trees of species that do not reach large size or that, even if commercial or potentially commercial, have severely damaged, rotten, or highly deformed stems.\n\n\n\n\n6\nNo silvicultural status: harvested tree; tree dead from any cause; tree not found.\n\n\n\n\n\np23_cdiluminacao = crown sun exposure. see table below.\n\n\nCode\npp_table_codes %&gt;%\n   slice(c(23:26)) %&gt;%\n   kableExtra::kbl(caption = \"p23_cdiluminacao codes\") %&gt;%\n   kableExtra::kable_classic(full_width = FALSE)\n\n\n\np23_cdiluminacao codes\n\n\nColumn\nColumn.description\nCode\nCode.description\n\n\n\n\np23_cdiluminacao\nThe crown light exposure variable indicates the level of light exposure of the tree crown, as well as the degree of competition with the crowns of neighboring trees. This variable is important because it represents one of the factors that significantly influence growth. In the assessment of crown light exposure, only living, standing trees (whether complete or broken) with a diameter of approximately 10 cm or more are considered.\n1\nEmergent crown or fully exposed to light\n\n\n\n\n2\nPartially illuminated crown, i.e., partially shaded by neighboring tree crowns\n\n\n\n\n3\nCompletely shaded crown by neighboring tree crowns, receiving only lateral or diffuse light\n\n\n\n\n4\nNot assessed (tree without a crown)",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Preparation of Permament Plots data</span>"
    ]
  },
  {
    "objectID": "11_pps_prep.html#standardizing-and-merging-all-tables-in-one",
    "href": "11_pps_prep.html#standardizing-and-merging-all-tables-in-one",
    "title": "1  Preparation of Permament Plots data",
    "section": "1.4 Standardizing and merging all tables in one",
    "text": "1.4 Standardizing and merging all tables in one\nWe will standardize the PPs tables, add some extra columns and merge all tables in only one. First, let’s read all tables.\n\n\nCode\nlista.pps &lt;- list.files(\".\",\n                        \"^JAM.*\\\\.xls[x]?$\",\n                        recursive = T)\n\n\nWe have xlsx and xls files. We will do a loop to:\n\nUse read.excel to read the file;\nRetrieve the APU and FMU information from the directories and add corresponding columns;\nAdd a DBH column in cm (by dividing diametromm by ten);\nAdd a column with the species’ common name (retrieved in the Especie column);\nAdd separate columns for the epithet and genus extracted from the scientific name (retrieved in the Especie column);\nAdd information about exploitation in the APU (year, total area, exploited area, cutting intensity, authorized volume);\nAdd a unique individual numeric code column in the final table.\n\n\n\nCode\ntabelao.pps &lt;- data.frame()\n\nfor(i in 1:length(lista.pps)) {\n  \n  \n  upa.table &lt;- read_excel(lista.pps[i])\n  \n  upa.table$UPA &lt;- basename(dirname(lista.pps[i]))\n  \n  upa.table$UMF &lt;- basename(dirname(dirname(lista.pps[i])))\n                      \n  \n  upa.table$diametrocm &lt;- upa.table$diametromm / 10\n  \n  # Cria uma coluna com nome popular\n  upa.table$nome_pop &lt;- str_extract(upa.table$Especie, \n                                    \".+?(?=\\\\s)\")\n  \n   # Separa o nome científico  \n   upa.table &lt;- upa.table %&gt;%\n                      mutate(Especie =  str_extract(upa.table$Especie, \n                                                    \"(?&lt;=\\\\[).+?(?=\\\\])\")) %&gt;%\n                      tidyr::separate(`Especie`,\n                                      c(\"genero\",\n                                        \"epiteto\"),\n                                        \" \")\n   \n  tabelao.pps &lt;&lt;- rbind(tabelao.pps,\n                        upa.table)\n  \n}\n\ntabelao.pps$cod_upa &lt;- paste(tabelao.pps$UMF,\n                             tabelao.pps$UPA,\n                             sep=\"_\")\n\nconcessions &lt;- read_excel(\"data/pps/tables/UPAs_concessoes_planilha.xlsx\")\n\n# Mudar para código da UMF para algarismos romanos\nconcessions$UMF &lt;- as.roman(concessions$UMF)\n\n\nconcessions &lt;- concessions %&gt;%\n                      filter(Imóvel == \"Flona do Jamari\") %&gt;%\n                      mutate(\"cod_upa\" = paste(\"UMF\",\n                                              UMF,\n                                              \"UPA\",\n                                              UPA,\n                                              sep = \"_\"))\n\ntabelao.pps &lt;- tabelao.pps %&gt;%\n                    left_join(concessions %&gt;%\n                                select(cod_upa,\n                                        Ano,\n                                       `Área Tota`,\n                                       `Área Efet`,\n                                       Intensidad,\n                                       `Volume Tor`),\n                                by = \"cod_upa\") %&gt;%\n                    rename(exploit_year = Ano,\n                           apu_area_ha = `Área Tota`,\n                           authorized_area_ha = `Área Efet`,\n                           cutting_intens_m3_ha = Intensidad,\n                           authorized_vol_m3 = `Volume Tor`)\n\n\n\ntabelao.pps$cod_indiv &lt;- paste(tabelao.pps$UMF,\n                               tabelao.pps$UPA,\n                               tabelao.pps$p23_cdparcela,\n                               tabelao.pps$p23_cdsubparcela,\n                               tabelao.pps$p23_nrindividuo,\n                               sep=\"_\")\n\n\nCorrect scientific names\n\n\nCode\n###########################################################################################\n\n#Corrige o nome científico\n###########################################################################################\n\n###########################################################################################\n\n\n# Clean scientific names: \n  # 1. Remove \"cf.\"\n  # 2. Remove anything under parentheses.\n  tabelao.pps$nome_corrigido &lt;- trimws(\n                                  gsub(\"\\\\s*cf\\\\.\\\\s*|\\\\([^)]*\\\\)\",\n                                       \" \",\n                                       paste(tabelao.pps$genero,\n                                             tabelao.pps$epiteto),\n                                       ignore.case = T\n                                       )\n                                     )\n# Função para limpar caracteres do excel\n # get_binomial não estava funcionando para \"Chrysophyllum lucentifolium var. pachycarpa\"\n\nlimpa_nome &lt;- function(x) {\n  x &lt;- as.character(x)\n  x &lt;- iconv(x, from = \"\", to = \"UTF-8\")\n  x &lt;- gsub(\"\\u00A0\", \" \", x)              # NBSP\n  x &lt;- gsub(\"[[:space:]]+\", \" \", x)        # múltiplos espaços\n  trimws(x)\n}\n\n\n\n  # Get the binomial name (epithet + genus)\n  \n  tabelao.pps$nome_corrigido &lt;-  get_binomial(limpa_nome(tabelao.pps$nome_corrigido),\n                                              include_subspecies = FALSE,\n                                              include_variety = FALSE)\n\n\n#sub(\"^((\\\\S+)\\\\s+(\\\\S+)).*$\", \"\\\\1\", \"Chrysophyllum lucentifolium var. pachycarpa\")\n\n\n\ntabelao.pps$nome_corrigido &lt;- sub(\n  \"^((\\\\S+)\\\\s+(\\\\S+)).*$\",\n  \"\\\\1\",\n  gsub(\"[[:space:]]+\", \" \",\n       trimws(as.character(tabelao.pps$nome_corrigido)))\n)\n\n\n\nif (!file.exists(\"data/taxo/pps_florabr_taxo.rds\")) {\n   \n  \n  \n  # Check names with florabr\n  \n  floraBR &lt;- load_florabr(\"C:/Gustavo/Doutorado/Dados/Taxo_databases/florabr\")\n\n   res_florabr &lt;- check_names(data = floraBR,\n                                     max_distance = 0.1,\n                                     species = tabelao.pps$nome_corrigido,\n                                     parallel = T,\n                                     ncores = 12,\n                                     progress_bar = T\n                                       )\n   \n   # Resolve some species mannualy\n\n  write.csv(res_florabr$input_name[res_florabr$Spelling == \"Not_found\"],\n             file = \"data/taxo/manually_corrected_species_pps.csv\")\n   \n   \n      # Pouteria pachycarpa\n   # https://lpf.florestal.gov.br/pt-br/?option=com_madeirasbrasileiras&view=especieestudada&especieestudadaid=206\n #  res_florabr$acceptedName[res_florabr$input_name == \"Chrysophyllum lucentifolium var. pachycarpa\"] &lt;- \"Chrysophyllum lucentifolium\"\n   # não funciona por causa de caracteres do excel\n   \n   # Ni \n   # Non identified species\n   res_florabr$acceptedName[res_florabr$input_name == \"Ni\"] &lt;- \"NI\"\n   res_florabr$acceptedName[res_florabr$input_name == \"Ni ni\"] &lt;- \"NI\"\n   res_florabr$acceptedName[res_florabr$input_name == \"Ni sp.\"] &lt;- \"NI\"\n   \n   \n  saveRDS(res_florabr, \"data/taxo/pps_florabr_taxo.rds\")\n                                                } else {\n   res_florabr &lt;- readRDS(\"data/taxo/pps_florabr_taxo.rds\")\n                                                      }\n\n  \nres_florabr_unique &lt;- res_florabr %&gt;%\n  distinct(input_name, .keep_all = TRUE)\n\ntabelao.pps &lt;- tabelao.pps %&gt;%\n  left_join(\n    res_florabr_unique %&gt;%\n      select(input_name, acceptedName),\n    by = c(\"nome_corrigido\" = \"input_name\")\n  ) %&gt;%\n  mutate(\n    nome_florabr = case_when(\n      # keep name when second word is \"sp.\", since florabr assign a random name in these cases\n      str_detect(nome_corrigido, \"^\\\\S+\\\\s+sp\\\\.$\") ~ nome_corrigido,\n      TRUE ~ acceptedName\n    )\n  ) %&gt;%\n  select(-acceptedName)\n\n# Get corrected Genus and Epithet\n\ntabelao.pps$genero &lt;- sub(\"^([^ ]+).*$\", \"\\\\1\", tabelao.pps$nome_florabr)\n\ntabelao.pps$epiteto &lt;- sub(\"^\\\\S+\\\\s+(\\\\S+).*$\", \"\\\\1\", tabelao.pps$nome_florabr)\n\nwrite.csv(tabelao.pps,\n          \"output/pps/tabelao_pps.csv\")\n\n\nsp &lt;- read.csv(\"data/taxo/manually_corrected_species_pps.csv\",\nstringsAsFactors = FALSE)\n\ntext &lt;- {\nspecies &lt;- sp$x\nspecies &lt;- species[!is.na(species)]\n\nif (length(species) &gt; 0) {\npaste(\n\"Species corrected manually (n =\",\nlength(species),\n\"):\",\npaste(species, collapse = \", \")\n)\n} else {\n\"No species required manual correction.\"\n}\n}\n\n\n\n\n\n\n\n\nWarning\n\n\n\nSpecies corrected manually (n = 1 ): Ni sp.\n\n\nNow we have all PPs data merged in one main table (tabelao.pps). Let’s take a look at the data.\n\n\nCode\ntabelao.pps %&gt;%\n    group_by(UMF, \n             UPA) %&gt;%\n    summarise(\"Number of measurements\" = n_distinct(p23_cdmedicao),\n              \"Years\" = paste(sort(unique(p23_cdmedicao)), \n                              collapse = \", \"),\n              .groups = \"drop\") %&gt;%\n    kbl(caption = \"PPs measurements\") %&gt;%\n    kable_classic(full_width = FALSE)\n\n\n\nPPs measurements\n\n\nUMF\nUPA\nNumber of measurements\nYears\n\n\n\n\nUMF_I\nUPA_1\n5\n2010, 2013, 2016, 2018, 2021\n\n\nUMF_I\nUPA_10\n3\n2015, 2017, 2023\n\n\nUMF_I\nUPA_13\n2\n2020, 2022\n\n\nUMF_I\nUPA_2\n4\n2011, 2013, 2016, 2021\n\n\nUMF_I\nUPA_3\n4\n2012, 2013, 2017, 2023\n\n\nUMF_I\nUPA_4\n4\n2012, 2014, 2018, 2023\n\n\nUMF_I\nUPA_5\n3\n2013, 2015, 2019\n\n\nUMF_I\nUPA_6\n3\n2014, 2016, 2020\n\n\nUMF_I\nUPA_7\n2\n2019, 2020\n\n\nUMF_I\nUPA_8\n2\n2017, 2019\n\n\nUMF_I\nUPA_9\n2\n2017, 2019\n\n\nUMF_IV\nUPA_15\n2\n2020, 2022\n\n\n\n\n\nCode\nsp_indiv &lt;- tabelao.pps %&gt;%\n    group_by(UMF, \n             UPA) %&gt;%\n    summarise(\"Number of species\" = n_distinct(nome_florabr),\n              \"Number of individuals\" = n(),\n              .groups = \"drop\")\n\nsp_indiv_total &lt;- tabelao.pps %&gt;%\n  summarise(\n    UMF = \"Total\",\n    UPA = \"-\",\n    \"Number of species\" = n_distinct(nome_florabr),\n    \"Number of individuals\" = n()\n            )\n\ntabelao_final &lt;- bind_rows(sp_indiv, \n                           sp_indiv_total)\n\ntabelao_final %&gt;%\n    kbl(caption = \"Number of species and individuals\") %&gt;%\n    kable_classic(full_width = FALSE)\n\n\n\nNumber of species and individuals\n\n\nUMF\nUPA\nNumber of species\nNumber of individuals\n\n\n\n\nUMF_I\nUPA_1\n79\n5708\n\n\nUMF_I\nUPA_10\n66\n2894\n\n\nUMF_I\nUPA_13\n65\n2194\n\n\nUMF_I\nUPA_2\n73\n5400\n\n\nUMF_I\nUPA_3\n73\n5327\n\n\nUMF_I\nUPA_4\n77\n5738\n\n\nUMF_I\nUPA_5\n77\n3680\n\n\nUMF_I\nUPA_6\n79\n3680\n\n\nUMF_I\nUPA_7\n70\n1884\n\n\nUMF_I\nUPA_8\n69\n1845\n\n\nUMF_I\nUPA_9\n69\n1845\n\n\nUMF_IV\nUPA_15\n47\n895\n\n\nTotal\n-\n104\n41090\n\n\n\n\n\nCode\nggplot(tabelao.pps, aes(x = diametrocm)) +\n  geom_histogram(\n    binwidth = 5,\n    fill = \"steelblue\",\n    color = \"black\",\n    alpha = 0.8\n  ) +\n  theme_minimal() +\n  labs(\n    title = \"DBH histogram\",\n    x = \"DBH (cm)\",\n    y = \"Number of individuals\"\n  )\n\n\n\n\n\n\n\n\n\n\n\n\n\nNatalino, José, Macedo Silva, José Do Carmo, Alves Lopes, Lia Cunha, Oliveira Silvia, Maria Alves, et al. 2005. “Diretrizes Para Instalação e Medição de Parcelas Permanentes Em Florestas Naturais Da Amazônia Brasileira.”",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Preparation of Permament Plots data</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html",
    "href": "12_harmonizing_pps_data.html",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "",
    "text": "2.1 Introduction\nThis script corrects and harmonizes data from the Permanent Plots (PPs). It adapts the methodology described in [https://github.com/Bioforest-project/inventories/blob/main/analyses/data_aggregation.qmd] of the BioForest project.\nData processed here were generated by Chapter 1 script.",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html#setup",
    "href": "12_harmonizing_pps_data.html#setup",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "2.2 Setup",
    "text": "2.2 Setup\n\n\nCode\nlibrary(dplyr)\nlibrary(kableExtra)\nlibrary(stringr)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(entropart)",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html#load-data-and-visualize-years-of-measurement",
    "href": "12_harmonizing_pps_data.html#load-data-and-visualize-years-of-measurement",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "2.3 Load data and visualize years of measurement",
    "text": "2.3 Load data and visualize years of measurement\n\n\nCode\npps &lt;- read.csv(\"./output/pps/tabelao_pps.csv\")\n\npps %&gt;%\n    group_by(UMF, \n             UPA) %&gt;%\n    summarise(\"Number of measurements\" = n_distinct(p23_cdmedicao),\n              \"Years\" = paste(sort(unique(p23_cdmedicao)), \n                              collapse = \", \"),\n              .groups = \"drop\") %&gt;%\n    kbl(caption = \"PPs measurements\") %&gt;%\n    kable_classic(full_width = FALSE)\n\n\n\nPPs measurements\n\n\nUMF\nUPA\nNumber of measurements\nYears\n\n\n\n\nUMF_I\nUPA_1\n5\n2010, 2013, 2016, 2018, 2021\n\n\nUMF_I\nUPA_10\n3\n2015, 2017, 2023\n\n\nUMF_I\nUPA_13\n2\n2020, 2022\n\n\nUMF_I\nUPA_2\n4\n2011, 2013, 2016, 2021\n\n\nUMF_I\nUPA_3\n4\n2012, 2013, 2017, 2023\n\n\nUMF_I\nUPA_4\n4\n2012, 2014, 2018, 2023\n\n\nUMF_I\nUPA_5\n3\n2013, 2015, 2019\n\n\nUMF_I\nUPA_6\n3\n2014, 2016, 2020\n\n\nUMF_I\nUPA_7\n2\n2019, 2020\n\n\nUMF_I\nUPA_8\n2\n2017, 2019\n\n\nUMF_I\nUPA_9\n2\n2017, 2019\n\n\nUMF_IV\nUPA_15\n2\n2020, 2022",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html#taxonomic-identification",
    "href": "12_harmonizing_pps_data.html#taxonomic-identification",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "2.4 Taxonomic identification",
    "text": "2.4 Taxonomic identification\nWe will visualize the proportion of complete species identification (genus + epithet), genus only and non identified species for each APU. We can see that around 35% of the trees on each APU are non identified.\n\n\nCode\npps_cat &lt;- pps %&gt;%\n  mutate(\n    nome_completo = nome_florabr,\n    \n    categoria = case_when(\n      str_detect(nome_completo, regex(\"Ni\", ignore_case = TRUE)) ~ \"Undetermined\",\n      \n      is.na(epiteto) | epiteto == \"\" | epiteto == \"sp\" ~ \"Genus Only\",\n      \n      TRUE ~ \"Species\"\n    )\n  )\n\ntab_cat &lt;- pps_cat %&gt;%\n  group_by(UMF, UPA, categoria) %&gt;%\n  summarise(\n    n_individuos = n(),\n    .groups = \"drop\"\n  ) %&gt;%\n  group_by(UPA) %&gt;%\n  mutate(\n    porc = 100 * n_individuos / sum(n_individuos, na.rm = TRUE)\n  ) %&gt;%\n  ungroup()\n\nggplot(tab_cat,\n       aes(x = interaction(UMF, UPA),\n           y = n_individuos,\n           fill = categoria)) +\n  geom_col(position = \"fill\") +\n  geom_text(\n    aes(label = paste0(round(porc), \"%\")),\n    position = position_fill(vjust = 0.5),\n    size = 3,\n    color = \"black\"\n  ) +\n  scale_y_continuous(\n    labels = scales::percent_format(accuracy = 1)\n  ) +\n  theme_minimal() +\n  labs(\n    x = \"UMF + UPA\",\n    y = \"Proportion of individuals\",\n    title = \"Proportion of taxonomic identification levels per UMF and UPA\",\n    fill = \"Category\"\n  ) +\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1),\n    plot.title = element_text(hjust = 0.5, face = \"bold\")\n  )\n\n\n\n\n\n\n\n\n\nCode\ntext &lt;- paste0(\"In average, \", \n              round(mean(tab_cat$porc[tab_cat$categoria == \"Undetermined\"], \n                   na.rm = TRUE)),\n             \"% of the trees on each APU are non identified.\")\n\n\n\n\n\n\n\n\nWarning\n\n\n\nIn average, 36% of the trees on each APU are non identified.",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html#consistency-of-diameter-measurements",
    "href": "12_harmonizing_pps_data.html#consistency-of-diameter-measurements",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "3.1 Consistency of diameter measurements",
    "text": "3.1 Consistency of diameter measurements",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html#missing-na-and-zeros-dbh-values",
    "href": "12_harmonizing_pps_data.html#missing-na-and-zeros-dbh-values",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "3.2 Missing (NA) and zeros DBH values",
    "text": "3.2 Missing (NA) and zeros DBH values\nWe have no zeros or NA values in our DBH records.\n\n\nCode\npps %&gt;%\n  group_by(UMF,UPA) %&gt;%\n  summarise(\n    `Zeros in diametrocm` = sum(diametrocm == 0, \n                                na.rm = TRUE),\n    `NA in diametrocm` = sum(is.na(diametrocm)),\n    `Total records` = n(),\n    .groups = \"drop\"\n  ) %&gt;%\n  kbl(\n    caption = \"Number of zero and NA values in diameter (cm) by UMF and UPA\"\n  ) %&gt;%\n  kable_classic(full_width = FALSE)\n\n\n\nNumber of zero and NA values in diameter (cm) by UMF and UPA\n\n\nUMF\nUPA\nZeros in diametrocm\nNA in diametrocm\nTotal records\n\n\n\n\nUMF_I\nUPA_1\n0\n0\n5708\n\n\nUMF_I\nUPA_10\n0\n0\n2894\n\n\nUMF_I\nUPA_13\n0\n0\n2194\n\n\nUMF_I\nUPA_2\n0\n0\n5400\n\n\nUMF_I\nUPA_3\n0\n0\n5327\n\n\nUMF_I\nUPA_4\n0\n0\n5738\n\n\nUMF_I\nUPA_5\n0\n0\n3680\n\n\nUMF_I\nUPA_6\n0\n0\n3680\n\n\nUMF_I\nUPA_7\n0\n0\n1884\n\n\nUMF_I\nUPA_8\n0\n0\n1845\n\n\nUMF_I\nUPA_9\n0\n0\n1845\n\n\nUMF_IV\nUPA_15\n0\n0\n895",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html#check-dbh-cutoff",
    "href": "12_harmonizing_pps_data.html#check-dbh-cutoff",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "3.3 Check DBH cutoff",
    "text": "3.3 Check DBH cutoff\nWe have no diameter records below 10 cm.\n\n\nCode\npps %&gt;%\n  group_by(UMF,\n           UPA) %&gt;%\n  summarise(\n    `DBH below 10 cm` = sum(diametrocm &lt; 10, \n                            na.rm = TRUE),\n    `Total records`      = n(),\n    .groups = \"drop\"\n  ) %&gt;%\n  kbl(\n    caption = \"Number of diameter values below 10 cm by APU\"\n  ) %&gt;%\n  kable_classic(full_width = FALSE)\n\n\n\nNumber of diameter values below 10 cm by APU\n\n\nUMF\nUPA\nDBH below 10 cm\nTotal records\n\n\n\n\nUMF_I\nUPA_1\n0\n5708\n\n\nUMF_I\nUPA_10\n0\n2894\n\n\nUMF_I\nUPA_13\n0\n2194\n\n\nUMF_I\nUPA_2\n0\n5400\n\n\nUMF_I\nUPA_3\n0\n5327\n\n\nUMF_I\nUPA_4\n0\n5738\n\n\nUMF_I\nUPA_5\n0\n3680\n\n\nUMF_I\nUPA_6\n0\n3680\n\n\nUMF_I\nUPA_7\n0\n1884\n\n\nUMF_I\nUPA_8\n0\n1845\n\n\nUMF_I\nUPA_9\n0\n1845\n\n\nUMF_IV\nUPA_15\n0\n895",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html#avoid-duplicated-measurements",
    "href": "12_harmonizing_pps_data.html#avoid-duplicated-measurements",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "3.4 Avoid duplicated measurements",
    "text": "3.4 Avoid duplicated measurements\nThrere are no duplicated records in this dataset.\n\n\nCode\npps %&gt;%\n  group_by(across(-cod_indiv)) %&gt;%\n  summarise(\n    n_ids = n_distinct(cod_indiv),\n    ids   = paste(unique(cod_indiv), \n                  collapse = \", \"),\n    .groups = \"drop\"\n  ) %&gt;%\n  filter(n_ids &gt; 1) %&gt;%\n  kbl(\n    caption = \"Duplicate records\",\n    align = \"l\"\n  ) %&gt;%\n  kable_classic(full_width = FALSE)\n\n\n\nDuplicate records\n\n\nX\np23_cdarea\np23_cdmedicao\np23_cdparcela\np23_cdsubparcela\np23_nrindividuo\np23_cdespecie\ngenero\nepiteto\np23_cdcif\ndiametromm\np23_lgmudancapdm\np23_cdtratamento\np23_cdiluminacao\nUPA\nUMF\ndiametrocm\nnome_pop\nnome_corrigido\nnome_florabr\nn_ids\nids",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html#remove-dead-trees",
    "href": "12_harmonizing_pps_data.html#remove-dead-trees",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "4.1 Remove dead trees",
    "text": "4.1 Remove dead trees\nWe will remove all records with column cd23_cif == 5, 6, 7, 8, 9 or 10.\n\n\nCode\npps %&gt;%\n  filter(p23_cdcif %in% 5:10) %&gt;%\n  count(UMF, \n        UPA, \n        name = \"Removed records\") %&gt;%\n  kbl(\n    caption = \"Dead trees (cd23_cif = 5–10) by APU\"\n  ) %&gt;%\n  kable_classic(full_width = FALSE)\n\n\n\nDead trees (cd23_cif = 5–10) by APU\n\n\nUMF\nUPA\nRemoved records\n\n\n\n\nUMF_I\nUPA_1\n286\n\n\nUMF_I\nUPA_10\n183\n\n\nUMF_I\nUPA_13\n58\n\n\nUMF_I\nUPA_2\n272\n\n\nUMF_I\nUPA_3\n281\n\n\nUMF_I\nUPA_4\n241\n\n\nUMF_I\nUPA_5\n239\n\n\nUMF_I\nUPA_6\n162\n\n\nUMF_I\nUPA_7\n94\n\n\nUMF_I\nUPA_8\n69\n\n\nUMF_I\nUPA_9\n69\n\n\nUMF_IV\nUPA_15\n79\n\n\n\n\n\nCode\npps_live &lt;- pps[!pps$p23_cdcif %in% 5:10, ]",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html#interpolation-of-missing-measurements",
    "href": "12_harmonizing_pps_data.html#interpolation-of-missing-measurements",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "2.7 Interpolation of missing measurements",
    "text": "2.7 Interpolation of missing measurements\nIf trees are missed in a census and remeasured in a later census, we use the DBH values from the previous and next census to interpolate the missing DBH value(s). This can lead to bias in the first and last censuses where missing DBH cannot be detected. We need to check that recruitment and mortality rates are not systematically lower in these two censuses.\n\n\nCode\n# Convert to BioForest data pattern to run the code\ndata_cor &lt;- pps_live\nnames(data_cor) &lt;- c(\"X\",\n                     \"p23_cdarea\",\n                     \"Year\",\n                     \"Plot\",\n                     \"Subplot\",\n                     \"p23_nrindividuo\",\n                     \"p23_cdespecie\",\n                     \"Genus\",\n                     \"Species\",\n                     \"p23_cdcif\",\n                     \"diametromm\",\n                     \"p23_lgmudancapdm\",\n                     \"p23_cdtratamento\",\n                     \"p23_cdiluminacao\",\n                     \"UPA\",\n                     \"UMF\",\n                     \"diameter_cor\",\n                     \"nome_pop\",\n                     \"Site\",\n                     \"exploit_year\",\n                     \"apu_area_ha\",\n                     \"authorized_area_ha\",\n                     \"cutting_intens_m3_ha\",\n                     \"authorized_vol_m3\",\n                     \"IdStem\",\n                     \"nome_corrigido\",\n                     \"ScientificName\")\n\n\ninterpolate &lt;- function(diam, years) {\n  if (sum(!is.na(diam)) &gt; 1) {\n    return(approx(years, diam, years)$y)\n  } else {\n    return(diam)\n  }\n}\n\n# columns with tree-level information in data_cor\ncol_tree &lt;-\n  !grepl(\n    \"census|year|month|day|date|status|code|diam|hom|pom|circ|dbh\",\n    tolower(colnames(data_cor))\n  )\ncol_pattern &lt;- \"Census|Year|Month|Day|Date|Status|Code|Diam|HOM|POM|Circ|DBH\"\n\ntree_info &lt;- data_cor |&gt;\n  select(c(\"Year\", colnames(data_cor)[col_tree])) |&gt;\n  group_by(Site, Plot, IdStem) |&gt;\n  filter(Year == max(Year)) |&gt;\n  select(-Year)\n\nmissing_censuses &lt;- data_cor |&gt;\n  # list all census years by plot and subplot\n  group_by(Site, Plot, Subplot) |&gt;\n  reframe(Year = unique(Year)) |&gt;\n  ungroup() |&gt;\n  # add all combinations of IdStem x IdCensus (by Plot and Subplot)\n  right_join(\n    unique(data_cor[, c(\"Site\", \"Plot\", \"Subplot\", \"IdStem\")]),\n    by = c(\"Site\", \"Plot\", \"Subplot\")\n  ) |&gt;\n  # add tree-level information\n  merge(tree_info) |&gt;\n  # add DBH information\n  merge(\n    data_cor[, c(\"IdStem\", \"Year\", \"diameter_cor\")],\n    by = c(\"IdStem\", \"Year\"),\n    all = TRUE\n  ) |&gt;\n  # interpolate missing diameters\n  group_by(IdStem) |&gt;\n  mutate(\n    diameter_cor = interpolate(diameter_cor, Year)\n  ) |&gt;\n  subset(!is.na(diameter_cor)) |&gt;\n  # keep only measurements missing from original data:\n  subset(!paste(IdStem, Year) %in%\n    with(data_cor, paste(IdStem, Year))) |&gt; # nolint\n  mutate(Year = Year)\n\n# add interpolated DBHs to raw data\ndata_cor &lt;- bind_rows(\n  data_cor,\n  missing_censuses\n)\nrm(missing_censuses)\n\nif (sum(is.na(data_cor$Diameter)) &gt; 0) {\n  n_missing &lt;- sum(is.na(data_cor$Diameter))\n  stem_missing &lt;- length(unique(data_cor$IdStem[is.na(data_cor$Diameter)]))\n  text &lt;- paste(\n    \"We found a total of\", sum(is.na(data_cor$Diameter)),\n    \"missing DBH values, in\", stem_missing, \"stems.\",\n    \"The figure below shows a subset of\", min(stem_missing, 12),\n    \"trees with missing DBH (red points are interpolated DBH).\"\n  )\n} else {\n  text &lt;- \"No missing DBH values were interpolated.\"\n}\n\n\nif (sum(is.na(data_cor$Diameter)) &gt; 0 && isTRUE(params$print)) {\n  illustration &lt;- sample(\n    subset(data_cor, is.na(Diameter))$IdStem,\n    min(stem_missing, 12)\n  )\n  subset(data_cor, IdStem %in% illustration) |&gt;\n    separate(IdTree, c(NA, NA, NA, \"IdTree\"), sep = \"_\") |&gt;\n    mutate(label = paste0(\n      \"Plot: \", Plot, \"_\", Subplot,\n      \", treeID: \", IdTree, \"\\n Species: \", ScientificName\n    )) |&gt;\n    ggplot(aes(x = Year, y = diameter_cor)) +\n    geom_point(aes(col = is.na(diameter_cor))) +\n    labs(x = \"Census year\", y = \"Diameter (cm)\", col = \"Interpolated\") +\n    scale_color_manual(values = c(\"black\", \"red\")) +\n    facet_wrap(~label, scales = \"free\") +\n    theme_classic() +\n    theme(legend.position = \"bottom\")\n}\n\n\n\n\n\n\n\n\nWarning\n\n\n\nNo missing DBH values were interpolated.\n\n\nBelow there is another way to verify it.\n\n\nCode\npps %&gt;%\n  group_by(UPA, p23_cdparcela, cod_indiv) %&gt;%\n  summarise(\n    Years = paste(sort(unique(p23_cdmedicao)), collapse = \", \"),\n    DBH_measured = any(!is.na(diametrocm)),\n    Missing_measurement = any(is.na(diametrocm)),\n    .groups = \"drop\"\n  ) %&gt;%\n  filter(DBH_measured & Missing_measurement) %&gt;%\n  kbl(\n    caption = \"Individuals with DBH measured in some years and missing in others, by UPA and plot.\"\n  ) %&gt;%\n  kable_classic(full_width = FALSE)\n\n\n\nIndividuals with DBH measured in some years and missing in others, by UPA and plot.\n\n\nUPA\np23_cdparcela\ncod_indiv\nYears\nDBH_measured\nMissing_measurement",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html#substitute-excessive-dbh-changes-from-bioforest-package",
    "href": "12_harmonizing_pps_data.html#substitute-excessive-dbh-changes-from-bioforest-package",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "2.8 Substitute excessive DBH changes (from Bioforest package)",
    "text": "2.8 Substitute excessive DBH changes (from Bioforest package)\nGrowth and productivity measurements are very sensitive to large changes in DBH, for example when the measurement height is changed. To mitigate this problem, we replace excessive DBH changes with the average growth value of similar trees (without changing the DBH values).\nThis poses two challenges: 1. what can be considered an ‘excessive’ DBH change and 2. how to define ‘similar’ trees.\n\n\nCode\ndata_cor &lt;- data_cor |&gt;\n  group_by(IdStem) |&gt;\n  arrange(Year,\n          .by_group = TRUE) |&gt;\n  mutate(\n    prev_year   = lag(Year),\n    diff_year   = Year - prev_year,\n    diam_growth = (diameter_cor - lag(diameter_cor)) / diff_year\n  ) |&gt;\n  ungroup()\n\n\nHere we defined ‘similar’ trees by first grouping them by genus and size (DBH), assuming that these two factors are among the main drivers of tree growth. We ranked genera by median DBH growth and divided them into four groups of increasing median DBH growth, with similar numbers of individual measurements per group.\n\n\nCode\ngenus_groups &lt;- data_cor %&gt;%\n  filter(!is.na(Genus)) %&gt;%\n  # get median growth (excluding negative values) per genus\n  group_by(Genus) %&gt;%\n  mutate(med_growth = median(diam_growth[diam_growth &gt;= 0], na.rm = TRUE)) %&gt;%\n  ungroup() %&gt;%\n  # create quantile bins with equal number of individuals\n  mutate(gen_group = ntile(med_growth, 4)) %&gt;%\n  group_by(Genus, med_growth) %&gt;%\n  # summarize back to species level\n  summarise(gen_group = first(gen_group), .groups = \"drop\")\n\n\n\n\nCode\nif (any(!is.na(genus_groups$med_growth))) {\n  genus_groups |&gt;\n    subset(!is.na(gen_group) & !is.na(Genus)) |&gt;\n    group_by(gen_group) |&gt;\n    summarise(\n      range = paste(\n        paste(round(range(med_growth), 2), collapse = \" - \"),\n        \"cm/yr\"\n      ),\n      genus = paste(Genus, collapse = \", \")\n    ) |&gt;\n    select(range, genus) |&gt;\n    t() |&gt;\n    knitr::kable(\n      col.names = paste(\n        \"Group\", seq_len(length(unique(drop_na(genus_groups)$gen_group)))\n      ),\n      row.names = FALSE\n    )\n}\n\n\n\n\n\n\n\n\n\n\n\nGroup 1\nGroup 2\nGroup 3\nGroup 4\n\n\n\n\n0 - 0.2 cm/yr\n0.2 - 0.2 cm/yr\n0.2 - 0.2 cm/yr\n0.23 - 0.77 cm/yr\n\n\nAndira, Aspidosperma, Astronium, Bagassa, Bertholletia, Buchenavia, Castilla, Cedrelinga, Chrysophyllum, Clarisia, Couma, Dinizia, Eschweilera, Guarea, Handroanthus, Huberodendron, Lacistema, Laetia, Licania, Martiodendron, NI, Naucleopsis, Ni, Oxandra, Rinorea, Robrichia, Roupala, Schizolobium, Sterculia, Vitex\nErisma, Minquartia, Pouteria, Pseudolmedia, Virola\nOcotea, Protium\nAldina, Allantoma, Anacardium, Aniba, Bowdichia, Brosimum, Cariniana, Caryocar, Cecropia, Cedrela, Ceiba, Coccoloba, Copaifera, Couratari, Diplotropis, Dipteryx, Duckesia, Endopleura, Enterolobium, Goupia, Hevea, Hymenaea, Hymenolobium, Hymenopus, Jacaranda, Lecythis, Manilkara, Mezilaurus, Osteophloeum, Parkia, Peltogyne, Qualea, Ruizterania, Sextonia, Simarouba, Tachigali, Terminalia, Thyrsodium, Tovomita, Vatairea, Vochysia, Zygia\n\n\n\n\n\nWe then split each genus group into 5 quantiles of DBH: this results in 20 groups of DBH growth measures based on both genus-level growth rates and size (DBH).\nOutliers are defined here as the 0.5% lowest DBH growth values (all groups combined) and the 0.5% highest DBH growth values per group. These outliers in DBH growth were replaced by the mean growth of their group.\n\n\nCode\ndata_cor &lt;- data_cor |&gt;\n  left_join(genus_groups, \n            by = \"Genus\") |&gt;\n  group_by(gen_group) |&gt;\n  mutate(diam_group = paste(gen_group, ntile(diameter_cor, 5), sep = \"_\")) |&gt;\n  # lower diameter growth threshold is the same for all species and sizes\n  ungroup() |&gt;\n  mutate(\n    dgrowth_lower = quantile(diam_growth, 0.005, na.rm = TRUE),\n    # define general upper quantile for unidentified individuals\n    dgrowth_upper = quantile(diam_growth, 0.995, na.rm = TRUE)\n  ) |&gt;\n  # upper diameter growth threshold defined by species and size\n  group_by(diam_group) |&gt;\n  mutate(dgrowth_upper = ifelse(!is.na(gen_group),\n    quantile(diam_growth, 0.995, na.rm = TRUE),\n    dgrowth_upper\n  )) |&gt;\n  # define outlier values\n  mutate(outlier = !is.na(diam_growth) &\n    (diam_growth &lt; dgrowth_lower | diam_growth &gt; dgrowth_upper)) |&gt; # nolint\n  # estimate average growth by group\n  mutate(average_growth = mean(diam_growth[!outlier], na.rm = TRUE)) |&gt;\n  ungroup() |&gt;\n  # substitute diameter growth\n  mutate(diam_growth_cor = ifelse(outlier, average_growth, diam_growth))\n\n\n\n\nCode\nif (sum(data_cor$outlier) &gt; 0) {\n  text &lt;- paste(\n    \"This graph shows all outlier DBH growth values (in cm/yr),\",\n    \"as well as the lower and upper bounds of 'acceptable' DBH\",\n    \"growth (in red) and the average DBH growth with which outlier\",\n    \"values are replaced (blue), as a function of tree DBH and\",\n    \"genus groups.\"\n  )\n} else {\n  text &lt;- paste(\n    \"There were no diameter growth values to correct, as no stem\",\n    \"was measured more than once.\"\n  )\n}\n\n\n\nThis graph shows all outlier DBH growth values (in cm/yr), as well as the lower and upper bounds of ‘acceptable’ DBH growth (in red) and the average DBH growth with which outlier values are replaced (blue), as a function of tree DBH and genus groups.\n\n\n\nCode\nif (sum(data_cor$outlier) &gt; 0 && isTRUE(params$print)) {\n  data_thresh &lt;- data_cor |&gt;\n    subset(!is.na(gen_group)) |&gt;\n    group_by(gen_group, diam_group) |&gt;\n    summarise(\n      diam_min = min(diameter_cor),\n      diam_max = max(diameter_cor),\n      dgrowth_upper = unique(dgrowth_upper),\n      dgrowth_lower = unique(dgrowth_lower),\n      average_growth = unique(average_growth)\n    ) |&gt;\n    pivot_longer(cols = c(\"diam_max\", \"diam_min\"))\n  data_cor |&gt;\n    subset(outlier) |&gt;\n    ggplot(aes(x = diameter_cor, y = diam_growth)) +\n    geom_point() +\n    geom_line(data = data_thresh, aes(x = value, y = dgrowth_upper), col = 2) +\n    geom_line(data = data_thresh, aes(x = value, y = dgrowth_lower), col = 2) +\n    geom_line(data = data_thresh, aes(x = value, y = average_growth), col = 4) +\n    labs(x = \"Diameter (cm)\", y = \"Diameter growth (cm/yr)\") +\n    ylim(-5, 10) +\n    facet_wrap(~ paste(\"Genus group\", gen_group)) +\n    scale_x_log10() +\n    theme_classic()\n}\n\n\n\n\n\n\n\n\n\n\n\nCode\nif (sum(data_cor$outlier) &gt; 0) {\n  text &lt;- paste(\n    \"The graph below shows a subset of trees with outlier DBH\",\n    \"growth values; the top panels show the DBH growth values and\",\n    \"the bottom panels show the corresponding DBH values (one\",\n    \"column per tree). The red dots are the outlier DBH growth\",\n    \"values, which were then replaced by the average growth values\",\n    \"for their group (species x DBH). DBH values were not replaced.\"\n  )\n} else {\n  text &lt;- \"\"\n}\n\n\n\nThe graph below shows a subset of trees with outlier DBH growth values; the top panels show the DBH growth values and the bottom panels show the corresponding DBH values (one column per tree). The red dots are the outlier DBH growth values, which were then replaced by the average growth values for their group (species x DBH). DBH values were not replaced.\n\n\n\nCode\nif (sum(data_cor$outlier) &gt; 0 && isTRUE(params$print)) {\n  id_cor &lt;-\n    data_cor |&gt;\n    subset(outlier) |&gt;\n    group_by(gen_group) |&gt;\n    summarise(id = sample(unique(IdStem), min(2, length(unique(IdStem)))))\n\n  labs_diam &lt;- c(\n    diam_growth = \"Diameter growth rate (cm/yr)\",\n    diameter_cor = \"Diameter (cm)\"\n  )\n  data_cor |&gt;\n    subset(IdStem %in% id_cor$id) |&gt;\n    separate(IdStem, c(NA, NA, NA, \"IdStem\"), sep = \"_\") |&gt;\n    mutate(label = paste0(\n      \"Plot: \", Plot, \"_\", Subplot,\n      \"\\ntreeID: \", IdStem, \"\\n\", ScientificName\n    )) |&gt;\n    pivot_longer(cols = c(\"diam_growth\", \"diameter_cor\")) |&gt;\n    ggplot(aes(x = Year)) +\n    geom_point(aes(y = value, col = outlier)) +\n    labs(col = \"Outlier DBH growth?\", y = NULL) +\n    scale_color_manual(values = c(\"black\", \"red\")) +\n    facet_grid(name ~ label,\n      scales = \"free\", switch = \"y\",\n      labeller = labeller(name = labs_diam)\n    ) +\n    theme_bw() +\n    theme(\n      legend.position = \"bottom\", strip.placement = \"outside\",\n      strip.background.y = element_blank()\n    )\n}\n\n\n\n\n\n\n\n\n\nCode\n# Write final file\nwrite.csv(data_cor,\n          file = \"./output/pps/harmonized_pps.csv\")",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html#taxonomic-diversity",
    "href": "12_harmonizing_pps_data.html#taxonomic-diversity",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "5.1 Taxonomic Diversity",
    "text": "5.1 Taxonomic Diversity\nTo evaluate taxonomic diversity, we used functions from the entropart package in R (Marcon et al., 2020). We estimated all these indices at both species and genus level.\nWe quantified taxonomic diversity using Hill numbers, a family of diversity measures that account for both species richness and evenness.\n\n5.1.1 Species Richness\nDiversity of Order q = 0: Species richness, which counts all species equally, regardless of their abundance.\n\n\n5.1.2 Shannon Diversity\nDiversity of Order q = 1: Shannon diversity, calculated as the exponential of Shannon entropy, which gives proportional weight to species based on their relative abundances. This index balances sensitivity to both common and rare species.\n\n\n5.1.3 Simpson Diversity\nDiversity of Order q = 2: Simpson diversity, calculated as the inverse of the Simpson index, which emphasizes dominant species and is less sensitive to rare taxa.\n\n\n5.1.4 Evenness\nEvenness reflects how uniformly individuals are distributed among the observed species. It was derived by dividing the observed diversity (for a given value of q) by the theoretical maximum diversity for the same number of species. Values closer to 1 indicate communities where individuals are more evenly distributed across species, while lower values indicate dominance by a few species.\n\n\n5.1.5 Coverage\nSample coverage estimates the proportion of individuals in a community that belong to species already detected in the sample. It provides an indication of sampling completeness, with values approaching 1 suggesting that most of the community has been captured and that further sampling is unlikely to yield many additional species.\nThe following figures represent all the above mentioned indices at the species and genus level. The y axis shows the different census years, while the x-axis shows the value of the indices. The different coloured lines represent the plots.\n\n\nCode\nrm(list = setdiff(ls(), c(\"data_cor\", \"params\")))\ndata_aggr &lt;- c()\n\n\n\n\nCode\n# for each census year, add information on previous and next census years\ndata_year &lt;- data_cor |&gt;\n  ungroup() |&gt;\n  select(Site, Plot, Year) |&gt;\n  unique() |&gt;\n  drop_na() |&gt;\n  arrange(Site, Plot, Year) |&gt;\n  group_by(Site, Plot) |&gt;\n  mutate(\n    prev_census = c(NA, Year[-length(Year)]),\n    next_census = c(Year[-1], NA)\n  ) |&gt;\n  ungroup()\n\n# add information on each tree's recruitment and mortality years\ndata_cor &lt;- data_cor |&gt;\n  left_join(data_year) |&gt;\n  mutate(\n    recr_year = min(Year),\n    mort_year = max(Year), .by = IdStem\n  )\n\n\n\n\nCode\n# Calculate neutral diversity indices per plot and year\n\n# species\nneutral_div_sp &lt;- data_cor %&gt;%\n  subset(!is.na(Species)) %&gt;%\n  group_by(UMF, Site, Year = Year, ScientificName) %&gt;%\n  summarise(count = n(), .groups = \"drop\") %&gt;%\n  group_by(UMF, Site, Year) %&gt;%\n  summarise(\n    diversity_q0_sp = Diversity(count,\n      q = 0, SampleCoverage = 0.8,\n      Correction = \"None\"\n    ),\n    diversity_q1_sp = Diversity(count,\n      q = 1, SampleCoverage = 0.8,\n      Correction = \"None\"\n    ),\n    diversity_q2_sp = Diversity(count,\n      q = 2, SampleCoverage = 0.8,\n      Correction = \"None\"\n    ),\n    evenness_sp = Shannon(count, SampleCoverage = 0.8, Correction = \"None\") /\n      log(n_distinct(ScientificName)),\n    coverage_sp = Coverage(count)\n  ) %&gt;%\n  pivot_longer(\n    cols = contains(\"_sp\"),\n    names_to = \"variable\",\n    values_to = \"value\"\n  )\n\n# genera\nneutral_div_gen &lt;- data_cor %&gt;%\n  subset(!is.na(Genus)) %&gt;%\n  group_by(UMF, Site, Year = Year, genus = Genus) %&gt;%\n  summarise(count = n(), .groups = \"drop\") %&gt;%\n  group_by(UMF, Site, Year) %&gt;%\n  summarise(\n    diversity_q0_gen = Diversity(count,\n      q = 0, SampleCoverage = 0.9,\n      Correction = \"None\"\n    ),\n    diversity_q1_gen = Diversity(count,\n      q = 1, SampleCoverage = 0.9,\n      Correction = \"None\"\n    ),\n    diversity_q2_gen = Diversity(count,\n      q = 2, SampleCoverage = 0.9,\n      Correction = \"None\"\n    ),\n    evenness_gen = Shannon(count, SampleCoverage = 0.9, Correction = \"None\") /\n      log(n_distinct(genus)),\n    coverage_gen = Coverage(count)\n  ) %&gt;%\n  pivot_longer(\n    cols = contains(\"_gen\"),\n    names_to = \"variable\",\n    values_to = \"value\"\n  )\n\n# Add to main dataframe with aggregatd data\ndata_aggr &lt;- data_aggr %&gt;%\n  rbind(neutral_div_sp) %&gt;%\n  rbind(neutral_div_gen)\n\n\n\n\nCode\naggr_fig &lt;- function(data, vars_names, title_fig = NULL) {\n  g &lt;- data %&gt;%\n    subset(variable %in% names(var_names)) %&gt;%\n    ggplot(aes(x = Year, \n               y = value, \n               color = paste(UMF,Site))) +\n#    geom_boxplot(aes(x = Year,\n#                     y = value,\n#                     group = Year),\n#    inherit.aes = FALSE,\n#    alpha = 0.2,\n#    width = 0.5\n#  ) +\n  geom_line(alpha = 0.8) +\n  facet_wrap(~ variable, \n             scales = \"free_y\",\n             labeller = labeller(variable = var_names)) +\n    labs(\n      title = title_fig,\n      x = NULL, y = NULL, color = NULL\n    ) +\n  theme_minimal()\n    if (length(var_names) == 5) {\n    g + theme(legend.position = c(0.82, 0.17),\n              legend.text = element_text(size = 6),\n              legend.title = element_text(size = 7)) +\n        guides(color=guide_legend(ncol=2))\n  } else {\n    g\n  }\n}\n\n\n\n\nCode\n# Plot temporal trajectories of different indices across plots\nif (isTRUE(params$print)) {\n  var_names &lt;- c(\n    coverage = \"Coverage\",\n    diversity_q0 = \"Richness\",\n    diversity_q1 = \"Shannon Diversity\",\n    diversity_q2 = \"Simpson Diversity\",\n    evenness = \"Evenness\"\n  )\n\n  data_aggr %&gt;%\n    subset(variable %in% neutral_div_sp$variable) %&gt;%\n    mutate(variable = factor(gsub(\"_sp\", \"\", variable),\n      levels = c(\n        paste0(\"diversity_q\", 0:2),\n        \"evenness\", \"coverage\"\n      )\n    )) %&gt;%\n    aggr_fig(var_names,\n      title_fig = paste(\n        \"Diversity Indices Across Plots and Years\",\n        \"(Species level)\"\n      )\n    )\n\n  data_aggr %&gt;%\n    subset(variable %in% neutral_div_gen$variable) %&gt;%\n    mutate(variable = factor(gsub(\"_gen\", \"\", variable),\n      levels = c(\n        paste0(\"diversity_q\", 0:2),\n        \"evenness\", \"coverage\"\n      )\n    )) %&gt;%\n    aggr_fig(var_names,\n      title_fig = paste(\n        \"Diversity Indices Across APUs and Years\",\n        \"(Genus level)\"\n      )\n    )\n}",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "13_merge_if100_romaneio.html",
    "href": "13_merge_if100_romaneio.html",
    "title": "3  Merging IF100 + logbook data",
    "section": "",
    "text": "3.1 Introduction\nThis script merges data from Commercial Forest Inventories (IF100) and logbooks. The objective is to enrich the IF100 tables with information from the logbooks on log volumes measured after tree felling.\nIF100 and logbook data were obtained from Ibama and the Brazilian Forest Service. For each Annual Production Unit (APU), there is one XLS (or XLSX) file containing IF100 data and one XLS (or XLSX) file containing the corresponding logbook records.",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Merging IF100 + logbook data</span>"
    ]
  },
  {
    "objectID": "13_merge_if100_romaneio.html#setup",
    "href": "13_merge_if100_romaneio.html#setup",
    "title": "3  Merging IF100 + logbook data",
    "section": "3.2 Setup",
    "text": "3.2 Setup\n\n\nCode\nlibrary(dplyr)\nlibrary(readxl)\nlibrary(ggplot2)\nlibrary(stringr)\nlibrary(kableExtra)\nlibrary(florabr)",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Merging IF100 + logbook data</span>"
    ]
  },
  {
    "objectID": "13_merge_if100_romaneio.html#if100-and-logbooks-information",
    "href": "13_merge_if100_romaneio.html#if100-and-logbooks-information",
    "title": "3  Merging IF100 + logbook data",
    "section": "3.3 IF100 and logbooks information",
    "text": "3.3 IF100 and logbooks information\n\n3.3.1 IF100\nIF100 are commercial forest inventories carried out one year before exploitation. All commercial species trees with DBH above 40 cm have their diameter and commercial height estimated. Species are also identified by a parataxonomist.\nThe diameter is measured by wrapping a diameter tape around the tree trunk at a height of 1.3 meters above the ground. Trees with buttresses or other irregularities in the trunk have their diameter measured just above the buttress, or estimated based on the projection of a regular trunk section at 1.3 meters above the ground.\nCommercial height is measured by visual estimation, aiming to determine the height between the ground and the first branching of the trunk.\nSpecies identification is carried out by a trained parataxonomist, based on prior botanical identification of the most common species present in the forest.\nExcept for one APU, all trees in the IF100 dataset have a pair of geographic coordinates (long/lat).\nIF100 tables have also a categoria column, indicating whether the tree is a Remanescente (will remain in the area), a Explorar (selected for harvesting) or a Substituta (can be harvested if the Explorar tree can’t be cut).\nMore information about IF100 procedures can be found in the Sustainable Forest Management Plan approved by IBAMA for Madeflona’s Forest Concession (https://www.gov.br/florestal/pt-br/assuntos/concessoes-e-monitoramento/concessoes-florestais-em-andamento/floresta-nacional-do-jamari-ro-2/floresta-nacional-do-jamari-ro-1).\nIF100 and logbook data from all Forest Concessions were gathered by Oliveira, Santos, and Chaves (2024).\n\n\n3.3.2 Logbook\nAfter the trees are felled, their stems are sectioned and skidded to the log yard. At the yard, the volume of each log section is estimated using the Smalian method. For this purpose, two diameter measurements are taken at the base and two at the top of each log section, in addition to its length. Each tree has a unique identification code, and each log section from the same tree is assigned a letter code (A, B, C, and so on). All measurements are recorded in the logbook (romaneio).\n\n\n3.3.3 Loading IF100\nWe will use complete IF100 from Madeflona, then subset it to the APUs studied in this project.\nColumn DAP is in meters, so we will multiply it by 100 to convert to cm.\n\n\nCode\nif100_madeflona &lt;- read_excel(\"data/if100/2022_MADEFLONA_Por árvore_Alvaro.xlsx\")\n\nupas_selecionadas &lt;- read.csv(\"data/if100/lista_upas_pesquisa.csv\")\n\nif100_upas &lt;- if100_madeflona %&gt;%\n  tidyr::separate(UMF,\n           into = c(\"flona\", \"umf\"),\n           sep = \" \",\n           remove = FALSE) %&gt;%\n  filter(flona == \"JAMARI\") %&gt;%\n  mutate(DAP = (CAP / pi ) * 100) %&gt;%\n  mutate(flona = str_to_title(flona)) %&gt;%\n  rename(num_arvore = Árvore) %&gt;%\n  mutate(umf = as.numeric(umf)) %&gt;%\n  rename(upa = UPA) %&gt;%\n  mutate(upa = as.numeric(sub(\"UPA\", \n                              \"\",\n                              upa))) %&gt;%\n  semi_join(upas_selecionadas, \n            by = c(\"umf\", \"upa\"))\n\n\nWe will harmonize scientific names using ‘check_names’ function of the florabr package. check_names need input names So we will remove any “cf.” from the names, and also any words in parentheses. Then we will extract only genus and epithet (with get_binomial). Some species can’t be corrected with check_names. We will have to correct them mannualy.\n\n\nCode\n###########################################################################################\n\n# Clean scientific names: \n  # 1. Remove \"cf.\"\n  # 2. Remove anything under parentheses.\n  if100_upas$nome_corrigido &lt;- trimws(\n                                  gsub(\"\\\\s*cf\\\\.\\\\s*|\\\\([^)]*\\\\)\",\n                                       \" \",\n                                       if100_upas$`Nome científico`,\n                                       ignore.case = T\n                                       )\n                                     )\n  \n  # Get the binomial name (epithet + genus)\n  \n  if100_upas$nome_corrigido &lt;-  get_binomial(if100_upas$nome_corrigido)\n\nif (!file.exists(\"data/taxo/if100_florabr_taxo.rds\")) {\n   \n  \n  \n  # Check names with florabr\n  \n  floraBR &lt;- load_florabr(\"C:/Gustavo/Doutorado/Dados/Taxo_databases/florabr\")\n\n   res_florabr &lt;- check_names(data = floraBR,\n                                     max_distance = 0.1,\n                                     species = if100_upas$nome_corrigido,\n                                     parallel = T,\n                                     ncores = 12,\n                                     progress_bar = T\n                                       )\n   \n   # Resolve some species mannualy\n\n   write.csv(res_florabr$input_name[res_florabr$Spelling == \"Not_found\"],\n             file = \"data/taxo/manually_corrected_species_if100.csv\")\n              \n   # Hymenaea capanema\n   # https://repositorio.ufms.br/bitstream/123456789/2579/1/LUCAS%20TJHIO%20CESAR%20PESTANA.pdf\n   res_florabr$acceptedName[res_florabr$input_name == \"Hymenaea capanema\"] &lt;- \"Hymenaea courbaril\"\n   \n   # Pouteria pachycarpa\n   # https://lpf.florestal.gov.br/pt-br/?option=com_madeirasbrasileiras&view=especieestudada&especieestudadaid=206\n   res_florabr$acceptedName[res_florabr$input_name == \"Pouteria pachycarpa\"] &lt;- \"Chrysophyllum lucentifolium\"\n   \n   # Peltogyne pophyrocardia\n   # https://www.scielo.br/j/aa/a/94Ch8c533SxxM9mZzNvvKFx/?format=pdf&lang=pt\n   res_florabr$acceptedName[res_florabr$input_name == \"Peltogyne pophyrocardia\"] &lt;- \"Peltogyne porphyrocardia\"\n   \n   # Planchonella pachycarpa\n   # https://reflora.jbrj.gov.br/reflora/herbarioVirtual/ConsultaPublicoHVUC/ConsultaPublicoHVUC.do?idTestemunho=5524739\n   res_florabr$acceptedName[res_florabr$input_name == \"Planchonella pachycarpa\"] &lt;- \"Planchonella pachycarpa\"\n   \n   # A identificar \n   # Non identified species\n   res_florabr$acceptedName[res_florabr$input_name == \"A identificar\"] &lt;- \"NI\"\n   \n   \n  saveRDS(res_florabr, \"data/taxo/if100_florabr_taxo.rds\")\n                                                } else {\n   res_florabr &lt;- readRDS(\"data/taxo/if100_florabr_taxo.rds\")\n                                                       }\n   \nres_florabr_unique &lt;- res_florabr %&gt;%\n  distinct(input_name, .keep_all = TRUE) \n\nif100_upas &lt;- if100_upas %&gt;%\n  left_join(\n    res_florabr_unique %&gt;%\n      select(input_name, acceptedName),\n    by = c(\"nome_corrigido\" = \"input_name\")\n  ) %&gt;%\n  mutate(\n    nome_florabr = case_when(\n      # keep name when second word is \"sp.\", since florabr assign a random name in these cases\n      str_detect(nome_corrigido, \"^\\\\S+\\\\s+sp\\\\.$\") ~ nome_corrigido,\n      TRUE ~ acceptedName\n    )\n  ) %&gt;%\n  select(-acceptedName)\n\n\n\n###########################################################################################\n\n# \n# res_taxo &lt;- correctTaxo(if100_upas$`Nome científico`,\n#                         useCache = F)\n# \n# if100_upas$nome_corrigido &lt;- paste(res_taxo$genusCorrected, \n#                                    res_taxo$speciesCorrected)\n\n###########################################################################################\n\n# if (!file.exists(\"data/taxo/worldflora_taxo.rds\")) {\n#   WFO.remember() \n#   res_wflora &lt;- WorldFlora:::WFO.match(spec.data = if100_upas$`Nome científico`,\n#                                        WFO.data = WFO.data,\n#                                        counter = 10000,\n#                                        verbose = T)\n#   saveRDS(res_wflora, \"data/taxo/worldflora_taxo.rds\")\n#                                                 } else {\n#   res_wflora &lt;- readRDS(\"data/taxo/worldflora_taxo.rds\")\n#                                                       }\n\n\nsp &lt;- read.csv(\"data/taxo/manually_corrected_species_if100.csv\",\nstringsAsFactors = FALSE)\n\ntext &lt;- {\nspecies &lt;- sp$x\nspecies &lt;- species[!is.na(species)]\n\nif (length(species) &gt; 0) {\npaste(\n\"Species corrected manually (n =\",\nlength(species),\n\"):\",\npaste(species, collapse = \", \")\n)\n} else {\n\"No species required manual correction.\"\n}\n}\n\n\n\n\n\n\n\n\nWarning\n\n\n\nSpecies corrected manually (n = 5 ): Hymenaea capanema, Pouteria pachycarpa, Peltogyne pophyrocardia, Planchonella pachycarpa, A identificar\n\n\n\n\n3.3.4 Loading Logbooks\nWe already have our study areas logbooks. As we are interested only in the log total volume information from the logbook, we will sum up the sections volumes of the same tree. Some trees have tora, that is the main trunk, and also have toretes, which are branches big enough to have commercial value, or segments of the trunk after the first bifurcation.\n\n\nCode\nromaneio &lt;- read.csv(file = \"data/if100/romaneio_upas_pesquisa.csv\")\n\nromaneio_voltotal &lt;- romaneio %&gt;%\n                          group_by(codigo,\n                                   num_arvore,\n                                   produto) %&gt;%\n                          summarise(\"Volume\" = sum(volume),\n                                    \"comprimento\" = sum(comprimento))\n\n\n`summarise()` has grouped output by 'codigo', 'num_arvore'. You can override\nusing the `.groups` argument.\n\n\nCode\nvol_wide &lt;- romaneio_voltotal %&gt;%\n  tidyr::pivot_wider(names_from = produto, \n                     values_from = Volume, \n                     values_fill = 0)\n\ndf_final &lt;- vol_wide %&gt;%\n  mutate(id_arvore = paste(codigo, \n                           num_arvore)) %&gt;%\n  mutate(\n  comprim_torete = ifelse(Tora == 0, \n                          comprimento, \n                          NA),\n  comprimento = ifelse(Torete == 0, \n                       comprimento, \n                       NA)\n  ) %&gt;%\n  group_by(codigo, \n           num_arvore) %&gt;%\n  summarise(\n    vol_tora = sum(Tora, \n                   na.rm = TRUE),\n    vol_torete = sum(Torete, \n                     na.rm = TRUE),\n    arvore = sum(Árvore, \n                 na.rm = TRUE),\n    comprim_tora = mean(comprimento, \n                        na.rm = TRUE),\n    comprim_torete = mean(comprim_torete, \n                          na.rm = TRUE),\n    .groups = \"drop\"\n  )",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Merging IF100 + logbook data</span>"
    ]
  },
  {
    "objectID": "13_merge_if100_romaneio.html#merging-if100-and-logbook-tables",
    "href": "13_merge_if100_romaneio.html#merging-if100-and-logbook-tables",
    "title": "3  Merging IF100 + logbook data",
    "section": "3.4 Merging IF100 and logbook tables",
    "text": "3.4 Merging IF100 and logbook tables\nWe will use the tree unique identifier to merge data from the different datasets.\n\n\nCode\nif100_upas$codigo &lt;- paste0(if100_upas$flona,\n                       \"_UMF_\",\n                       if100_upas$umf,\n                       \"_UPA_\",\n                       if100_upas$upa)\nif100_com_romaneio &lt;- if100_upas %&gt;%\n                          left_join(df_final, \n                                    by = c(\"codigo\",\n                                           \"num_arvore\"))\n\nwrite.csv(if100_com_romaneio,\n           \"output/if100/if100_romaneio_madeflona.csv\")\n\n\nLet’s take a look at the data.\n\n\nCode\nggplot(if100_com_romaneio, \n       aes(x = DAP)) +\n  geom_histogram(\n    binwidth = 10,\n    fill = \"forestgreen\",\n    color = \"white\"\n  )+\n  scale_x_continuous(\n    breaks = seq(0, max(if100_com_romaneio$DAP,\n                        na.rm = TRUE), \n                 by = 10)\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.y = element_text(angle = 90)\n  ) +\n  labs(\n    x = \"DBH (cm)\",\n    y = \"Number of trees\",\n    title = paste0(\"Diameter distribution of the \",\n                   nrow(if100_com_romaneio),\n                   \" trees\")\n  )\n\n\n\n\n\n\n\n\n\nCode\nggplot(if100_com_romaneio, \n       aes(x = Altura)) +\n  geom_histogram(\n    binwidth = 5,\n    fill = \"forestgreen\",\n    color = \"white\"\n  )+\n  scale_x_continuous(\n    breaks = seq(0, max(if100_com_romaneio$Altura,\n                        na.rm = TRUE), \n                 by = 5)\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.y = element_text(angle = 90)\n  ) +\n  labs(\n    x = \"Commercial height (m)\",\n    y = \"Number of trees\",\n    title = paste0(\"Commercial height distribution of the \",\n                   nrow(if100_com_romaneio),\n                   \" trees\")\n  )\n\n\n\n\n\n\n\n\n\nCode\nif100_com_romaneio %&gt;%\n  group_by(nome_florabr) %&gt;%\n  summarise(\"Number of trees\" = n(),\n            \"Total volume (m³)\" = sum(Volume),\n            .groups = \"drop\") %&gt;%\n  arrange(desc(`Number of trees`)) %&gt;%\n  slice_head(n = 15) %&gt;%\n  kbl(\n    caption = \"Top 15 species with more individuals\",\n    align = c(\"l\",\n              \"r\")\n  ) %&gt;%\n  kable_classic(full_width = FALSE)\n\n\n\nTop 15 species with more individuals\n\n\nnome_florabr\nNumber of trees\nTotal volume (m³)\n\n\n\n\nPeltogyne lecointei\n12913\n35348.940\n\n\nNI\n12024\n31615.093\n\n\nTachigali paniculata\n6236\n19508.294\n\n\nClarisia racemosa\n5036\n14362.124\n\n\nAstronium lecointei\n4125\n21250.972\n\n\nCouratari guianensis\n3214\n23421.251\n\n\nHymenolobium excelsum\n2840\n15588.518\n\n\nDinizia excelsa\n2625\n30746.081\n\n\nBrosimum rubescens\n2586\n9896.106\n\n\nBertholletia excelsa\n2548\n34877.206\n\n\nAllantoma lineata\n2393\n13455.234\n\n\nParkia decussata\n2295\n6041.836\n\n\nCopaifera multijuga\n2012\n4473.362\n\n\nCaryocar glabrum\n1973\n7738.574\n\n\nCopaifera duckei\n1951\n5060.719\n\n\n\n\n\n\n\n\n\nOliveira, Gustavo Bediaga, Robson Cruz Santos, and José Humberto Chaves. 2024. “Produção Madeireira Nas Concessões Florestais Federais Da Amazônia.” Gestão Da Informação Ambiental, 170–82. https://www.ibama.gov.br/sophia/cnia/periodico/trajetoriasperspectivas4.pdf.",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Merging IF100 + logbook data</span>"
    ]
  },
  {
    "objectID": "21_wood_density_databases.html",
    "href": "21_wood_density_databases.html",
    "title": "4  Comparing wood density databases",
    "section": "",
    "text": "4.1 Introduction\nThis script compares biomass estimates derived from different wood density databases. We use the Global Wood Database (Chave et al. 2009), available through the BIOMASS package, and the Brazilian Woods Database (https://lpf.florestal.gov.br/en-us/brazilian-woods) from Brazilian Forest Service.",
    "crumbs": [
      "Data Exploration",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Comparing wood density databases</span>"
    ]
  },
  {
    "objectID": "31_tree_height_from_lidar.html",
    "href": "31_tree_height_from_lidar.html",
    "title": "6  Workflow to extract tree height from Lidar CHM",
    "section": "",
    "text": "6.1 Introduction\nThis is a pilot script to extract tree heights from a Canopy Height Model (CHM) generated from LiDAR-derived point clouds in a forest management area. Two CHMs are used: one from the year before harvesting (2015) and one from the year after harvesting (2017). Data from the Commercial Forest Inventory of the area are also incorporated (generated by the Chapter 3 script).\nThe goal is to identify the crowns of harvested trees and obtain their heights from the CHM metrics. To ensure transparency and reproducibility, outputs will be generated at each processing step, allowing one to clearly see how the final results were obtained.",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "31_tree_height_from_lidar.html#working-directories",
    "href": "31_tree_height_from_lidar.html#working-directories",
    "title": "6  Workflow to extract tree height from Lidar CHM",
    "section": "6.4 Working directories",
    "text": "6.4 Working directories\nFirst we set our working directories: the main one, the output, the location of CHMs, and the location of Forest Inventory.\n\n\nCode\nlid.antes &lt;- \"data/chm/JAM01_2015_chm_lspikefree.tif\"\n\nlid.depois &lt;- \"data/chm/JAM02_2017_chm_lspikefree.tif\"\n\nif100_pesquisa &lt;- \"output/if100/if100_romaneio_madeflona.csv\"",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "31_tree_height_from_lidar.html#parameters",
    "href": "31_tree_height_from_lidar.html#parameters",
    "title": "6  Workflow to extract tree height from Lidar CHM",
    "section": "6.5 Parameters",
    "text": "6.5 Parameters\nThen we set the script parameters.\nlim_inf = Percentage points threshold to be considered as a gap. When subtracting two CHMs the output difference can be full of noises (a branch that broke or moved for example). Setting a threshold ensures we will select only the large differences.\npol_area = Minimum area to be considered as a gap (m2).\nprojection = Projection of spatial data.\nbuffer_size = Buffer size around each tree to avoid confusing very close trees and also to identify the associated gap.\npercentil = Percentile used to extract maximum height in the identified canopy area.\nupa.piloto = Annual Production Unit used in this test.\numf = Forest Management Unit used in this test.\n\n\nCode\nlim_inf &lt;- 0.05\n\npol_area &lt;- 25\n\nprojection &lt;- \"EPSG:31980\"\n\nbuffer_size &lt;- 20\n\npercentil &lt;- 0.95\n\nupa.piloto &lt;- \"6\"\n\numf &lt;- \"1\"",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "31_tree_height_from_lidar.html#chm-processing",
    "href": "31_tree_height_from_lidar.html#chm-processing",
    "title": "6  Workflow to extract tree height from Lidar CHM",
    "section": "6.8 CHM processing",
    "text": "6.8 CHM processing\nLoad the CHMs and assign the projection.\n\n\nCode\nr1 &lt;- rast(lid.antes)\nr2 &lt;- rast(lid.depois)\n\ncrs(r1) &lt;- projection\ncrs(r2) &lt;- projection\n\n\nClip the CHMs intersection area.\n\n\nCode\next_intersect &lt;- terra::intersect(ext(r1), ext(r2))\n\nr1_crop &lt;- crop(r1, \n                ext_intersect)\nr2_crop &lt;- crop(r2, \n                ext_intersect)\n\n\nSubtract CHM after exploitation from CHM before exploitation and keep only valid pixels.\n\n\nCode\ndiff_raster &lt;- r2_crop - r1_crop\n\ndiff_raster &lt;- mask(diff_raster, \n                    (!is.na(r1_crop) & !is.na(r2_crop)))\n\n\nVisualize the result.\n\n\nCode\nplot(diff_raster, \n     main = \"Subtracted raster (r2 - r1)\")\n\n\n\n\n\n\n\n\n\nKeep only the higher differences between the two CHMs, to ensure that are really gaps from the exploitation, using the threshold defined before (lim_inf).\n\n\nCode\nq1 &lt;- quantile(values(diff_raster), \n               probs = lim_inf, \n               na.rm = TRUE)\n\nr_low &lt;- diff_raster\nr_low[diff_raster &gt; q1] &lt;- NA\nr_low[!is.na(r_low)] &lt;- 1\n\n\nVisualize the filtered result\n\n\nCode\nplot(r_low)\n\n\n\n\n\n\n\n\n\nConvert the result to polygons, project them, calculate area and filter them using the minimum area defined before (pol_area).\n\n\nCode\nr_low_patches &lt;- patches(r_low, directions = 8)\npoly_low &lt;- as.polygons(r_low_patches, \n                        dissolve = T, \n                        na.rm = TRUE)\n\ncrs(poly_low) &lt;- projection\n\npoly_low$area_m2 &lt;- expanse(poly_low, \n                            unit = \"m\")\n\npoly_filtrado &lt;- poly_low[poly_low$area_m2 &gt; pol_area, ]\n\n\nVisualizing the results.\nThe original raster (r2 - r1).\n\n\nCode\nplot(diff_raster, \n     main = \"Original Raster\")\n\n\n\n\n\n\n\n\n\nAll the gaps.\n\n\nCode\nplot(diff_raster, \n     main = \"All gaps\")\nplot(poly_low, \n     border = \"red\",\n     add = T)\n\n\n\n\n\n\n\n\n\nThe filtered gaps (area &gt; 25 m2).\n\n\nCode\nplot(diff_raster, \n     main = \"Filtered gaps\")\nplot(poly_filtrado,\n      add = T,\n      border = \"orange\")",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "31_tree_height_from_lidar.html#forest-inventory",
    "href": "31_tree_height_from_lidar.html#forest-inventory",
    "title": "6  Workflow to extract tree height from Lidar CHM",
    "section": "6.9 Forest Inventory",
    "text": "6.9 Forest Inventory\nLoad the Commercial Forest Inventory, subset it to the pilot APU, and filter it to include only the harvested trees. Then convert it to a spatial vector, project it to the defined CRS and clip it using raster the extent.\n\n\nCode\nif100_romaneio &lt;- read.csv(if100_pesquisa)\n\nif100_upa &lt;- subset(if100_romaneio,\n                    codigo == paste0(\"Jamari_\",\n                                     \"UMF_\",\n                                     umf,\n                                     \"_UPA_\",\n                                     upa.piloto))\n\nif100_upa &lt;- if100_upa[!is.na(if100_upa$vol_tora), ]\n\nif100_upa$id_arv &lt;- paste0(if100_upa$codigo,\n                              \"_arv_\",\n                              if100_upa$num_arvore)\n\nif100_pts &lt;- vect(if100_upa, \n                  geom = c(\"Longitude\", \n                           \"Latitude\"),\n                  keepgeom = TRUE,\n                  crs = \"EPSG:4674\")\n\ncrs(if100_pts) &lt;- \"EPSG:4674\"\n\nif100_pts &lt;- project(if100_pts, \n                     projection)\n\nif100_pts &lt;- crop(if100_pts, \n                  diff_raster)\n\n\nPlot the filtered gaps and the exploited trees.\n\n\nCode\nplot(poly_filtrado)\nplot(if100_pts,\n     add = T,\n     col = \"red\")\n\n\n\n\n\n\n\n\n\nCreate an ID for each tree and generate a buffer around them using the buffer size defined earlier. The buffer is intended to prevent confusion between trees that are too close, which could lead to selecting the wrong crown.\n\n\nCode\nif100_pts$ID &lt;- 1:nrow(if100_pts)\n\nbuffer_if100 &lt;- buffer(if100_pts,\n                       width = buffer_size)\n\nplot(buffer_if100)\n\n\n\n\n\n\n\n\n\nRemove the buffers that touch each other so that only isolated trees remain.\n\n\nCode\ntoca &lt;- relate(buffer_if100, \n               buffer_if100, \n               \"overlaps\")\n\ndiag(toca) &lt;- FALSE\n\ntocam_outros &lt;- apply(toca, 1, any)\n\nb_isolados &lt;- buffer_if100[!tocam_outros]\n\nplot(buffer_if100)\nplot(b_isolados,\n     add= T,\n     col = \"red\")\n\n\n\n\n\n\n\n\n\nSelect the gaps that intersect with the tree buffers. Sometimes more than one gap intersects the same tree buffer, so we will select the gap whose boundary is closest to the tree.\n\n\nCode\npts_sel &lt;- if100_pts[ if100_pts$id_arv %in% b_isolados$id_arv , ]\n\nsel &lt;- relate(poly_filtrado, \n              b_isolados, \n              \"intersects\")\n\nlista_copas &lt;- apply(sel, \n                     2, \n                     function(x) which(x))\n\nidx_mantidos &lt;- c()\n\nfor (i in seq_along(lista_copas)) {\n  \n  copas_idx &lt;- lista_copas[[i]]\n  \n  if (length(copas_idx) == 0) next\n  \n  if (length(copas_idx) == 1) {\n    idx_mantidos &lt;- c(idx_mantidos, \n                      copas_idx)\n    next\n  }\n  \n  distancias &lt;- distance(\n    pts_sel[i, ],\n    poly_filtrado[copas_idx, ]\n  )\n  \n\n  idx_melhor &lt;- copas_idx[ which.min(distancias) ]\n  idx_mantidos &lt;- c(idx_mantidos, \n                    idx_melhor)\n}\n\n\nidx_mantidos &lt;- unique(idx_mantidos)\n\npol_copas_sel &lt;- poly_filtrado[idx_mantidos, ]\n\n\nVisualize the results. Gray polygons are the gaps, blue polygons are the buffers and red are the gaps that intersects the buffers.\n\n\nCode\nplot(poly_filtrado, \n     border = \"gray\") \nplot(b_isolados, \n     border = \"blue\", \n     add = TRUE) \nplot(pol_copas_sel, \n     border = \"red\", \n     add = TRUE)\n\n\n\n\n\n\n\n\n\nRelate each gap to its intersecting crown so that every gap receives a tree ID.\n\n\nCode\nm &lt;- relate(pol_copas_sel, b_isolados, \"intersects\")\n\nidx &lt;- apply(m, 1, function(x) ifelse(any(x), which(x)[1], NA))\n\npol_copas_sel$ID_B &lt;- b_isolados$ID[idx]\n\n\nVisualize the results. Gaps are in blue, buffers in red. Each gap has an tree ID.\n\n\nCode\nplot(pol_copas_sel, \n     col = \"lightblue\", \n     border = \"gray\") \nplot(b_isolados, \n     border = \"red\", \n     add = TRUE) \ntext(pol_copas_sel, \n     \"ID_B\", \n     cex = 0.6)",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "31_tree_height_from_lidar.html#extracting-heights",
    "href": "31_tree_height_from_lidar.html#extracting-heights",
    "title": "6  Workflow to extract tree height from Lidar CHM",
    "section": "6.10 Extracting heights",
    "text": "6.10 Extracting heights\nExtract height values from the pre-harvest CHM using the delimited gaps. Use the maximum height based on the previously defined percentile to avoid outliers and points that do not represent the actual tree height (such as an emerging branch, for example).\n\n\nCode\nvalores &lt;- terra::extract(r1, \n                          pol_copas_sel)\n\nvalores &lt;- na.omit(valores)\n\ncolnames(valores) &lt;- c(\"id_pol\", \"z\")\n\nstats &lt;- valores %&gt;%\n  group_by(id_pol) %&gt;%\n  summarise(z_max = quantile(z, \n                             percentil, \n                             na.rm = TRUE))\n\npol_copas_sel$z_max &lt;- stats$z_max\n\n\nAdd the tree height column to the Forest Inventory table.\n\n\nCode\nif100_pts_df &lt;- as.data.frame(if100_pts)\npol_copas_sel_df &lt;- as.data.frame(pol_copas_sel)\n\nif100_pts_z &lt;- left_join(if100_pts_df, \n                         pol_copas_sel_df, \n                         by = c(\"ID\" = \"ID_B\"))",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "31_tree_height_from_lidar.html#results",
    "href": "31_tree_height_from_lidar.html#results",
    "title": "6  Workflow to extract tree height from Lidar CHM",
    "section": "6.11 Results",
    "text": "6.11 Results\nVoilà. Final data frame has the tree total height obtained with Lidar.\nLet`s write it down, and may the analysis begin.\n\n\nCode\nwrite.csv(if100_pts_z,\n          file = paste0(\"output/tree_height/\",\n                        \"UMF_\",\n                        umf,\n                        \"_UPA_\",\n                        upa.piloto,\n                        \"_if100_pts_z_PILOTO.csv\"))",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "31_tree_height_from_lidar.html#graphics",
    "href": "31_tree_height_from_lidar.html#graphics",
    "title": "6  Workflow to extract tree height from Lidar CHM",
    "section": "6.12 Graphics",
    "text": "6.12 Graphics\nSome plots to see the relations between total height (obtained by Lidar) and commercial height (from the forest inventory) and log lenght (from the logbook)\n\n\nCode\nlibrary(ggplot2)\nggplot(if100_pts_z, \n       aes(x = comprim_tora, \n           y = z_max)) +\n  geom_point(alpha = 0.7, \n             aes(color = nome_florabr)) +\n  geom_smooth(method = \"lm\", \n              se = FALSE, \n              color = \"black\",\n              formula = 'y ~ 0 + x') +\n  theme_minimal() +\n  labs(\n    title = \"Log lenght x Total height\",\n    x = \"Log lenght (m)\",\n    y = \"Total height (m)\",\n    color = \"Species\"\n  ) +\n  theme(\n    plot.title = element_text(hjust = 0.5, \n                              size = 14, \n                              face = \"bold\"),\n    legend.title = element_text(face = \"bold\")\n  ) +\n  geom_abline() +\n  ggpubr::stat_regline_equation(formula = 'y ~ 0 + x')\n\n\n\n\n\n\n\n\n\nCode\nggplot(if100_pts_z, \n       aes(x = Altura, \n           y = z_max)) +\n  geom_point(alpha = 0.7, \n             aes(color = nome_florabr)) +\n  geom_smooth(method = \"lm\", \n              se = FALSE, \n              color = \"black\",\n              formula = 'y ~ 0 + x') +\n  theme_minimal() +\n  labs(\n    title = \"Commercial height x Total height\",\n    x = \"Commercial height (m)\",\n    y = \"Total height (m)\",\n    color = \"Species\"\n  ) +\n  theme(\n    plot.title = element_text(hjust = 0.5, \n                              size = 14, \n                              face = \"bold\"),\n    legend.title = element_text(face = \"bold\")\n  ) +\n  geom_abline() +\n  ggpubr::stat_regline_equation(formula = 'y ~ 0 + x')\n\n\n\n\n\n\n\n\n\nCode\nggplot(if100_pts_z, \n       aes(x = comprim_tora, \n           y = Altura)) +\n  geom_point(alpha = 0.7, \n             aes(color = nome_florabr)) +\n  geom_smooth(method = \"lm\", \n              se = FALSE, \n              color = \"black\",\n              formula = 'y ~ 0 + x') +\n  theme_minimal() +\n  labs(\n    title = \"Log lenght x Commercial height\",\n    x = \"Log lenght (m)\",\n    y = \"Commercial height (m)\",\n    color = \"Species\"\n  ) +\n  theme(\n    plot.title = element_text(hjust = 0.5, \n                              size = 14, \n                              face = \"bold\"),\n    legend.title = element_text(face = \"bold\")\n  ) +\n  geom_abline() +\n  ggpubr::stat_regline_equation(formula = 'y ~ 0 + x')\n\n\n\n\n\n\n\n\n\n\n\n\n\nFischer, Fabian Jörg, Toby Jackson, Grégoire Vincent, and Tommaso Jucker. 2024. “Robust Characterisation of Forest Structure from Airborne Laser Scanning—a Systematic Assessment and Sample Workflow for Ecologists.” Methods in Ecology and Evolution 15 (October): 1873–88. https://doi.org/10.1111/2041-210X.14416.",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "32_tree_height_from_lidar_all_apus.html",
    "href": "32_tree_height_from_lidar_all_apus.html",
    "title": "7  Workflow to extract tree height from Lidar CHM",
    "section": "",
    "text": "7.1 Introduction\nThis is the final script to extract tree heights from Canopy Height Models (CHMs) generated from LiDAR-derived point clouds in a forest management area. Two CHMs will be used: one from the year before harvesting and one from the year after. The paths to the CHMs for each area are provided in a table.\nData from the Forest Inventory of the area are also incorporated (from Chapter 3). The goal is to identify the crowns of harvested trees and obtain their heights from the CHM metrics. Step-by-step processing of the workflow can be found in the Chapter 6 script.",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "32_tree_height_from_lidar_all_apus.html#parameters",
    "href": "32_tree_height_from_lidar_all_apus.html#parameters",
    "title": "7  Workflow to extract tree height from Lidar CHM",
    "section": "7.4 Parameters",
    "text": "7.4 Parameters\nThen we set the script parameters.\nlim_inf = Percentage points threshold to be considered as a gap. When subtracting two CHMs the output difference can be full of noises (a branch that broke or moved for example). Setting a threshold ensures we will select only the large differences.\npol_area = Minimum area to be considered as a gap (m2).\nprojection = Projection of spatial data.\nbuffer_size = Buffer size around each tree to avoid confusing very close trees and also to identify the associated gap.\npercentil = Percentile used to extract maximum height in the identified canopy area.\n\n\nCode\nlim_inf &lt;- 0.05\n\npol_area &lt;- 25\n\nprojection &lt;- \"EPSG:31980\"\n\nbuffer_size &lt;- 20\n\npercentil &lt;- 0.95",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "32_tree_height_from_lidar_all_apus.html#chm-processing",
    "href": "32_tree_height_from_lidar_all_apus.html#chm-processing",
    "title": "7  Workflow to extract tree height from Lidar CHM",
    "section": "7.7 CHM processing",
    "text": "7.7 CHM processing\nRead the table with the file path of each CHM before and after exploitation for each APU. Read the commercial forest inventory merged with logbook records in the 13_merge_if100_romaneio.qmd script.\n\n\nCode\nchm_list &lt;- read.csv(\"data/chm/APUs_CHMs.csv\")\n\nchm_list &lt;-chm_list[chm_list$before_exploit != \"\", ]\n\nif100_romaneio &lt;- read.csv(\"output/if100/if100_romaneio_madeflona.csv\")\n\nif100_romaneio$id_arv &lt;- paste0(if100_romaneio$codigo,\n                                \"_arv_\",\n                                if100_romaneio$num_arvore)\n\n\nLet’s loop it\n\n\nCode\nfor (i in 1:length(chm_list)) {\n  \nupa &lt;- chm_list$apu[i]\n  \numf &lt;- chm_list$fmu[i]\n  \nlid.antes &lt;- chm_list$before_exploit[i]\n  \nlid.depois &lt;- chm_list$after_exploit[i]\n\nstopifnot(file.exists(lid.antes))\n\nstopifnot(file.exists(lid.depois))\n\nr1 &lt;- rast(lid.antes)\nr2 &lt;- rast(lid.depois)\n\nif (crs(r1) != projection) r1 &lt;- project(r1, projection)\nif (crs(r2) != projection) r2 &lt;- project(r2, projection)\n  \next_intersect &lt;- terra::intersect(ext(r1), ext(r2))\n\nr1_crop &lt;- crop(r1, \n                ext_intersect)\nr2_crop &lt;- crop(r2, \n                ext_intersect)\n\ndiff_raster &lt;- r2_crop - r1_crop\n\ndiff_raster &lt;- mask(diff_raster, \n                    (!is.na(r1_crop) & !is.na(r2_crop)))\n  \nq1 &lt;- quantile(values(diff_raster), \n               probs = lim_inf, \n               na.rm = TRUE)\n\nr_low &lt;- diff_raster\nr_low[diff_raster &gt; q1] &lt;- NA\nr_low[!is.na(r_low)] &lt;- 1\n\nr_low_patches &lt;- patches(r_low, directions = 8)\npoly_low &lt;- as.polygons(r_low_patches, \n                        dissolve = T, \n                        na.rm = TRUE)\n\ncrs(poly_low) &lt;- projection\n\npoly_low$area_m2 &lt;- expanse(poly_low, \n                            unit = \"m\")\n\npoly_filtrado &lt;- poly_low[poly_low$area_m2 &gt; pol_area, ]\n\n\nupa.umf &lt;- paste0(\"Jamari_\",\n                  \"UMF_\",\n                  umf,\n                  \"_UPA_\",\n                  upa)\n\n\nif100_upa &lt;- if100_romaneio %&gt;%\n                  filter(codigo == upa.umf)\n \nif (all(is.na(if100_upa$vol_tora))) {\n                                      message(\"Volume de tora igual a zero na iteração \", i)\n                                      next\n                                    }\n\nif100_upa &lt;- if100_upa[!is.na(if100_upa$vol_tora), ]\n\nif100_pts &lt;- vect(if100_upa, \n                  geom = c(\"Longitude\",\n                           \"Latitude\"),\n                  keepgeom = TRUE,\n                  crs = \"EPSG:4674\")\n\ncrs(if100_pts) &lt;- \"EPSG:4674\"\n\nif100_pts &lt;- project(if100_pts, \n                     projection)\n\nif100_pts &lt;- crop(if100_pts, \n                  diff_raster)\n\nif100_pts$ID &lt;- 1:nrow(if100_pts)\n\nbuffer_if100 &lt;- buffer(if100_pts,\n                       width = buffer_size)\n\ntoca &lt;- relate(buffer_if100, \n               buffer_if100, \n               \"overlaps\")\n\ndiag(toca) &lt;- FALSE\n\ntocam_outros &lt;- apply(toca, 1, any)\n\nb_isolados &lt;- buffer_if100[!tocam_outros]\n\npts_sel &lt;- if100_pts[ if100_pts$id_arv %in% b_isolados$id_arv , ]\n\nsel &lt;- relate(poly_filtrado, \n              b_isolados, \n              \"intersects\")\n\nlista_copas &lt;- apply(sel, \n                     2, \n                     function(x) which(x))\n\nidx_mantidos &lt;- c()\n\nfor (o in seq_along(lista_copas)) {\n  \n  copas_idx &lt;- lista_copas[[o]]\n  \n  if (length(copas_idx) == 0) next\n  \n  if (length(copas_idx) == 1) {\n    idx_mantidos &lt;- c(idx_mantidos, \n                      copas_idx)\n    next\n  }\n  \n  distancias &lt;- distance(\n    pts_sel[o, ],\n    poly_filtrado[copas_idx, ]\n  )\n  \n\n  idx_melhor &lt;- copas_idx[ which.min(distancias) ]\n  idx_mantidos &lt;- c(idx_mantidos, \n                    idx_melhor)\n}\n\n\nidx_mantidos &lt;- unique(idx_mantidos)\n\nidx_mantidos &lt;- idx_mantidos[!is.na(idx_mantidos)]\n\nif (length(idx_mantidos) == 0){\n                                message(\"Pulando iteração \", i, \": idx_mantidos é NA\")\n                                next\n                              }\n\npol_copas_sel &lt;- poly_filtrado[idx_mantidos, ]\n\n\nm &lt;- relate(pol_copas_sel, b_isolados, \"intersects\")\n\nidx &lt;- apply(m, \n             1, \n             function(x) ifelse(any(x), \n                                which(x)[1], \n                                NA))\n\npol_copas_sel$ID_B &lt;- b_isolados$ID[idx]\n\n\nvalores &lt;- terra::extract(r1, \n                          pol_copas_sel)\n\nvalores &lt;- na.omit(valores)\n\ncolnames(valores) &lt;- c(\"id_pol\", \"z\")\n\nstats &lt;- valores %&gt;%\n  group_by(id_pol) %&gt;%\n  summarise(z_lidar = quantile(z, \n                             percentil, \n                             na.rm = TRUE))\n\npol_copas_sel$z_lidar &lt;- stats$z_lidar\n\nif100_pts_df &lt;- as.data.frame(if100_pts)\npol_copas_sel_df &lt;- as.data.frame(pol_copas_sel)\n\nif100_pts_z &lt;- left_join(if100_pts_df, \n                         pol_copas_sel_df, \n                         by = c(\"ID\" = \"ID_B\"))\n\nwrite.csv(if100_pts_z,\n          file = paste0(\"output/tree_height/\",\n                        \"Jamari\",\n                        \"_FMU_\",\n                        umf,\n                        \"_APU_\",\n                        upa,\n                        \"_if100_pts_z.csv\"))\n\n}\n\n\nAnd now we merge all the outputs tables\n\n\nCode\nlist_csv &lt;- list.files(\"output/tree_height/\",\n                       \"*pts_z.csv$\",\n                       full.names = T)\n\nall_tables &lt;- do.call(rbind,\n                    lapply(list_csv,\n                           read.csv,\n                           stringsAsFactors = FALSE)\n                    )\n\nwrite.csv(all_tables,\n          file = \"output/tree_height/all_tables.csv\")\n\ntext &lt;- paste(sum(!is.na(all_tables$z_lidar)),\n              \" tree heights were estimated from LiDAR data.\")\n\n\n\n\n\n\n\n\nImportant\n\n\n\n798 tree heights were estimated from LiDAR data.\n\n\nLet’s take a look to the data distribution\n\n\nCode\nggplot(all_tables, aes(x = z_lidar)) +\n  geom_histogram(binwidth = 1, na.rm = TRUE,\n                 fill = \"steelblue\", color = \"black\") +\n  theme_minimal() +\n  labs(\n    title = paste0(sum(!is.na(all_tables$z_lidar)),\" Lidar heights\"),\n    x = \"LiDAR height (m)\",\n    y = \"Frequency\"\n  )\n\n\n\n\n\n\n\n\n\nCode\nggplot(all_tables, \n       aes(x = DAP, \n           y = z_lidar)) +\n  geom_point(alpha = 0.7, \n             aes(color = nome_florabr),\n             show.legend = F) +\n  geom_smooth(method = \"lm\", \n              se = FALSE, \n              color = \"black\"\n              ) +\n  scale_x_log10() +\n  scale_y_log10() +\n  theme_minimal() +\n  labs(\n    title = \"DBH x Lidar height\",\n    x = \"DBH (cm, log scale)\",\n    y = \"Lidar height (m, log scale)\"\n  ) +\n  theme(\n    plot.title = element_text(hjust = 0.5, \n                              size = 14, \n                              face = \"bold\"),\n    legend.title = element_text(face = \"bold\")\n  )\n\n\n\n\n\n\n\n\n\n\n\n\n\nFischer, Fabian Jörg, Toby Jackson, Grégoire Vincent, and Tommaso Jucker. 2024. “Robust Characterisation of Forest Structure from Airborne Laser Scanning—a Systematic Assessment and Sample Workflow for Ecologists.” Methods in Ecology and Evolution 15 (October): 1873–88. https://doi.org/10.1111/2041-210X.14416.",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "33_estimate_biomass.html",
    "href": "33_estimate_biomass.html",
    "title": "8  Estimate biomass with different total height estimations",
    "section": "",
    "text": "8.1 Introduction\nThis script estimates Above-Ground Biomass (AGB) for a given Annual Production Unit in the Jamari Forest Concession using two different total height estimates: one derived from LiDAR (see Chapter 7), and the other obtained via the rerieveH function from BIOMASS package (Réjou-Méchain et al. (2017)).\nWe also estimate biomass with only DBH using three different equations: Chave et al. (2014), Nogueira et al. (2008) and Melo et al. (2024).\nFinally, the results from these approaches are compared to assess the impact of height estimation and equation choice on biomass estimates.",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Estimate biomass with different total height estimations</span>"
    ]
  },
  {
    "objectID": "33_estimate_biomass.html#load-the-inventory",
    "href": "33_estimate_biomass.html#load-the-inventory",
    "title": "8  Estimate biomass with different total height estimations",
    "section": "8.5 Load the Inventory",
    "text": "8.5 Load the Inventory\nLet’s load the Commercial Forest Inventory with the different height estimations.\n\n\nCode\nif100 &lt;- read.csv(\"output/tree_height/all_tables.csv\")\n\n\nMaking sure what Annual Production Unit and Forest Management Unit we are working with.\n\n\nCode\nprint(paste0(if100$flona[1],\n             \" UMF \",\n             if100$umf[1],\n             \" UPA \",\n             if100$upa[1]))\n\n\n[1] \"Jamari UMF 1 UPA 10\"",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Estimate biomass with different total height estimations</span>"
    ]
  },
  {
    "objectID": "33_estimate_biomass.html#estimating-biomass-with-total-height",
    "href": "33_estimate_biomass.html#estimating-biomass-with-total-height",
    "title": "7  Estimate biomass with different total height estimations",
    "section": "13.1 Estimating biomass with total height",
    "text": "13.1 Estimating biomass with total height\nWe estimated only some of the commercial species tree height using Lidar. We will remove all trees without Lidar estimated height, so we can compare AGB estimates. We need a new taxo for the reduced data frame.\n\n\nCode\nif100.red &lt;- if100[!is.na(if100$z_lidar), ]\n\n#taxo.red &lt;- correctTaxo(genus=if100.red$genus,\n#                        species=if100.red$epithet,\n#                        useCache = F)\n\n\nThen we get the wood density of each species.\n\n\nCode\nw_density.red &lt;- getWoodDensity(genus = if100.red$genus,\n                                species = if100.red$epithet)\n\n\nCompute AGB with Chave et al. (2014) equation and Feldpausch et al. (2011) height.\n\n\nCode\nif100.red$AGB_chave_feld &lt;- computeAGB(D = if100.red$DAP,\n                                       WD = w_density.red$meanWD,\n                                       H = if100.red$altura_feld)\n# AGB = 0.0673 * (WD * H * D^2)^0.976\n\n\nCompute AGB with Chave et al. (2014) equation and Lidar height.\n\n\nCode\nif100.red$AGB_chave_lidar &lt;- computeAGB(D = if100.red$DAP,\n                                        WD = w_density.red$meanWD,\n                                        H = if100.red$z_lidar)\n# AGB = 0.0673 * (WD * H * D^2)^0.976\n\n\nNow let’s compare the different AGB estimates.\n\n\nCode\nggplot(if100.red, \n       aes(x = AGB_chave_feld, \n           y = AGB_chave_lidar)) +\n  geom_point(alpha = 0.7, \n             aes(color = nome_florabr)) +\n  geom_smooth(method = \"lm\", \n              se = FALSE, \n              color = \"black\",\n              formula = 'y ~ 0 + x') +\n  theme_minimal() +\n  labs(\n    title = \"AGB with Feldpausch height x AGB with Lidar height\",\n    x = \"Feldpausch AGB (Mg)\",\n    y = \"Lidar AGB (Mg)\",\n    color = \"Species\"\n  ) +\n  theme(\n    plot.title = element_text(hjust = 0.5, \n                              size = 14, \n                              face = \"bold\"),\n    legend.title = element_text(face = \"bold\")\n    ,legend.position=\"none\"\n  ) +\n  ggpubr::stat_regline_equation(formula = 'y ~ 0 + x')\n\n\n\n\n\n\n\n\n\nIs the difference between the biomass estimates different across the DBHs? Comparing AGB estimates with different heights estimates across DBHs.\n\n\nCode\nif100.red$diff_agbs_h &lt;- if100.red$AGB_chave_feld - if100.red$AGB_chave_lidar\n\nggplot(if100.red, \n       aes(x = DAP, \n           y = diff_agbs_h)) +\n  geom_point(alpha = 0.5, \n             aes(color = nome_florabr)) +\n  geom_hline(yintercept = 0, \n             linetype = \"dashed\") +\n  theme_minimal() +\n  theme(,legend.position=\"none\")+\n  labs(x = \"DAP\", y = \"Difference (AGB with H by Feldpausch − AGB with H by Lidar)\",\n       title = \"AGB estimations difference by DBH\")",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Estimate biomass with different total height estimations</span>"
    ]
  },
  {
    "objectID": "33_estimate_biomass.html#estimating-biomass-using-only-dbh",
    "href": "33_estimate_biomass.html#estimating-biomass-using-only-dbh",
    "title": "7  Estimate biomass with different total height estimations",
    "section": "13.2 Estimating biomass using only DBH",
    "text": "13.2 Estimating biomass using only DBH\nWe will use Chave et al. (2014), Nogueira et al. (2008) e Melo et al. (2024) equations to estimate AGB using only DBH.\nIt is important to point out that Nogueira et al. (2008) and Melo et al. (2024) uses only DBH, whereas Chave et al. (2014) uses, in addition to DBH, wood density and a variable representing environmental stress (see Réjou-Méchain et al. (2017) for the minor modification in Chave et al. (2014) equation used in BIOMASS).\n\n\nCode\nif100$AGB_chave_dbh &lt;- computeAGB(D = if100$DAP,\n                                  WD = w_density$meanWD,\n                                  coord = c(-62.99,\n                                            -9.11))\n# AGB =  exp(-2,024 - 0,896 * E + 0,920 * ln(WD) + 2,795 * ln(DAP) - 0,0461 * [ln(DAP)^2])\n\nif100$AGB_nog_dbh &lt;- (exp(-1.716 + 2.413 * log(if100$DAP))) / 1000\n# We have to divide results by 1000 because equation gives AGB in kg\n\nif100$AGB_melo_dbh &lt;- (0.064 * (if100$DAP^2.671) + 3.69) / 1000\n# We have to divide results by 1000 because equation gives AGB in kg\n\n\nTo plot the three equations results in the same graph, we must convert data to LONG format.\n\n\nCode\ndf_long &lt;- if100 |&gt;\n  pivot_longer(\n    cols = c(AGB_chave_dbh, AGB_nog_dbh, AGB_melo_dbh),\n    names_to = \"equation\",\n    values_to = \"biomass\"\n  )\n\n\nNow let’s plot them.\n\n\nCode\nggplot(df_long, \n       aes(x = DAP, \n           y = biomass, \n           color = equation)) +\n  geom_point(alpha = 0.3) +            # pontos opcionais\n  geom_smooth(method = \"lm\",\n              se = FALSE, \n              linewidth = 1.2,\n              formula = 'y ~ 0 + x') + # linhas das equações\n  theme_minimal() +\n  labs(\n    title = \"Biomass–DBH Relationships Derived from Multiple Allometric Models\",\n    x = \"DBH (cm)\",\n    y = \"Biomass (Mg)\",\n    color = \"Equation\"\n  )\n\n\n\n\n\n\n\n\n\nNow let’s compare the different AGB estimates.\n\n\nCode\nggplot(if100, \n       aes(x = AGB_chave_dbh, \n           y = AGB_nog_dbh)) +\n  geom_point(alpha = 0.7, \n             aes(color = nome_florabr)) +\n  geom_smooth(method = \"lm\", \n              se = FALSE, \n              color = \"black\",\n              formula = 'y ~ 0 + x') +\n  theme_minimal() +\n  labs(\n    title = \"AGB Chave eq. (DBH) x AGB Nogueira eq. (DBH)\",\n    x = \"Chave eq AGB (Mg)\",\n    y = \"Nogueira eq AGB (Mg)\",\n    color = \"Species\"\n  ) +\n  theme(\n    plot.title = element_text(hjust = 0.5, \n                              size = 14, \n                              face = \"bold\"),\n    legend.title = element_text(face = \"bold\")\n    ,legend.position=\"none\"\n  ) +\n  ggpubr::stat_regline_equation(formula = 'y ~ 0 + x')\n\n\n\n\n\n\n\n\n\nIs the difference between the biomass estimates different across the DBHs? Comparing Chave et al. (2014) x Nogueira et al. (2008) equations estimates across DBHs.\n\n\nCode\nif100$diff_agbs &lt;- if100$AGB_chave_dbh - if100$AGB_nog_dbh\n\nggplot(if100, \n       aes(x = DAP, \n           y = diff_agbs)) +\n  geom_point(alpha = 0.5, \n             aes(color = nome_florabr)) +\n  geom_hline(yintercept = 0, \n             linetype = \"dashed\") +\n  theme_minimal() +\n  theme(legend.position=\"none\")+\n  labs(x = \"DAP\", y = \"Difference (Chave − Nogueira)\",\n       title = \"AGB estimations difference by DBH\")",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Estimate biomass with different total height estimations</span>"
    ]
  },
  {
    "objectID": "33_estimate_biomass.html#comparing-biomass-estimates-using-only-dbh-and-using-dbh-height",
    "href": "33_estimate_biomass.html#comparing-biomass-estimates-using-only-dbh-and-using-dbh-height",
    "title": "8  Estimate biomass with different total height estimations",
    "section": "8.9 Comparing biomass estimates using only DBH and using DBH + Height",
    "text": "8.9 Comparing biomass estimates using only DBH and using DBH + Height\nComparing AGB estimate using only DBH and using DBH + height obtained by Lidar. We will use results from Chave et al. (2014) equations (with and without height).\nTo plot the equations results in the same graph, we must convert data to LONG format.\n\n\nCode\nif100.red &lt;- left_join(\n                      if100.red,\n                      if100 %&gt;% select(id_arv,\n                                       AGB_chave_dbh, \n                                       AGB_nog_dbh, \n                                       AGB_melo_dbh),\n                      by = \"id_arv\"\n                      )\n\n\nWarning in left_join(if100.red, if100 %&gt;% select(id_arv, AGB_chave_dbh, : Detected an unexpected many-to-many relationship between `x` and `y`.\nℹ Row 531 of `x` matches multiple rows in `y`.\nℹ Row 2661 of `y` matches multiple rows in `x`.\nℹ If a many-to-many relationship is expected, set `relationship =\n  \"many-to-many\"` to silence this warning.\n\n\nCode\nif100.red_long &lt;- if100.red |&gt;\n                  pivot_longer(\n                              cols = c(AGB_chave_dbh, \n                                       AGB_nog_dbh, \n                                       AGB_melo_dbh,\n                                       AGB_chave_feld,\n                                       AGB_chave_lidar),\n                              names_to = \"equation\",\n                              values_to = \"biomass\"\n                              )\n\n\nNow let’s plot\n\n\nCode\nggplot(if100.red_long, \n                aes(x = DAP, \n                    y = biomass, \n                    color = equation)) +\n  geom_point(alpha = 0.3) +            # pontos opcionais\n  geom_smooth(method = \"lm\",\n              se = FALSE, \n              linewidth = 1.2,\n              formula = 'y ~ 0 + x') + # linhas das equações\n  theme_minimal() +\n  labs(\n    title = \"Biomass–DBH Relationships Derived from Multiple Allometric Models\",\n    x = \"DBH (cm)\",\n    y = \"Biomass (Mg)\",\n    color = \"Equation\"\n  )\n\n\n\n\n\n\n\n\n\n\n\n\n\nChave, Jérôme, Maxime Réjou-Méchain, Alberto Búrquez, Emmanuel Chidumayo, Matthew S. Colgan, Welington B. C. Delitti, Alvaro Duque, et al. 2014. “Improved Allometric Models to Estimate the Aboveground Biomass of Tropical Trees.” Global Change Biology 20: 3177–90. https://doi.org/10.1111/gcb.12629.\n\n\nFeldpausch, T. R., L. Banin, O. L. Phillips, T. R. Baker, S. L. Lewis, C. A. Quesada, K. Affum-Baffoe, et al. 2011. “Height-Diameter Allometry of Tropical Forest Trees.” Biogeosciences 8: 1081–1106. https://doi.org/10.5194/bg-8-1081-2011.\n\n\nFischer, Fabian Jörg, Toby Jackson, Grégoire Vincent, and Tommaso Jucker. 2024. “Robust Characterisation of Forest Structure from Airborne Laser Scanning—a Systematic Assessment and Sample Workflow for Ecologists.” Methods in Ecology and Evolution 15 (October): 1873–88. https://doi.org/10.1111/2041-210X.14416.\n\n\nMelo, Antonio Willian Flores de, Adriano José Nogueira Lima, Marcus Vinicio Neves d’Oliveira, Joaquim dos Santos, I. Foster Brown, Eufran Ferreira do Amaral, Sonaira Souza da Silva, Igor Oliveira, Plínio Barbosa de Camargo, and Niro Higuchi. 2024. “To Improve Estimates of Neotropical Forest Carbon Stocks More Direct Measurements Are Needed: An Example from the Southwestern Amazon.” Forest Ecology and Management 570 (October). https://doi.org/10.1016/j.foreco.2024.122195.\n\n\nNogueira, Euler Melo, Philip Martin Fearnside, Bruce Walker Nelson, Reinaldo Imbrozio Barbosa, and Edwin Willem Hermanus Keizer. 2008. “Estimates of Forest Biomass in the Brazilian Amazon: New Allometric Equations and Adjustments to Biomass from Wood-Volume Inventories.” Forest Ecology and Management 256 (November): 1853–67. https://doi.org/10.1016/j.foreco.2008.07.022.\n\n\nRéjou-Méchain, Maxime, Ariane Tanguy, Camille Piponiot, Jérôme Chave, and Bruno Hérault. 2017. “Biomass: An r Package for Estimating Above-Ground Biomass and Its Uncertainty in Tropical Forests.” Methods in Ecology and Evolution 8 (September): 1163–67. https://doi.org/10.1111/2041-210X.12753.",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Estimate biomass with different total height estimations</span>"
    ]
  },
  {
    "objectID": "34_modelling_H.html",
    "href": "34_modelling_H.html",
    "title": "9  Modelling DBH x Height",
    "section": "",
    "text": "9.1 Introduction\nPermanent plot data lack total height, a critical variable for accurately estimating biomass. We obtained total heights for a subset of trees using LiDAR data (see Chapter 7). Additionally, we have other Forest Inventories conducted in the Jamari National Forest that include both DBH and total height.\nWe will use these data to model the DBH–Total Height relationship and derive a locally adjusted allometric equation to estimate the total height of trees in the permanent plot dataset. By combining total height with DBH, we expect to achieve more accurate biomass estimates for the permanent plots.\nThe modelling pipeline was developed by Sylvain Schmidt.",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Modelling DBH x Height</span>"
    ]
  },
  {
    "objectID": "99_references.html",
    "href": "99_references.html",
    "title": "References",
    "section": "",
    "text": "Chave, Jerome, David Coomes, Steven Jansen, Simon L. Lewis, Nathan G.\nSwenson, and Amy E. Zanne. 2009. “Towards a Worldwide Wood\nEconomics Spectrum.” Ecology Letters 12: 351–66. https://doi.org/10.1111/j.1461-0248.2009.01285.x.\n\n\nChave, Jérôme, Maxime Réjou-Méchain, Alberto Búrquez, Emmanuel\nChidumayo, Matthew S. Colgan, Welington B. C. Delitti, Alvaro Duque, et\nal. 2014. “Improved Allometric Models to Estimate the Aboveground\nBiomass of Tropical Trees.” Global Change Biology 20:\n3177–90. https://doi.org/10.1111/gcb.12629.\n\n\ndos-Santos, M. N., M. M. Keller, E. R. Pinage, and D. C. Morton. 2022.\n“Forest Inventory and Biophysical Measurements, Brazilian Amazon,\n2009-2018.” https://doi.org/10.3334/ORNLDAAC/2007.\n\n\nFeldpausch, T. R., L. Banin, O. L. Phillips, T. R. Baker, S. L. Lewis,\nC. A. Quesada, K. Affum-Baffoe, et al. 2011. “Height-Diameter\nAllometry of Tropical Forest Trees.” Biogeosciences 8:\n1081–1106. https://doi.org/10.5194/bg-8-1081-2011.\n\n\nFischer, Fabian Jörg, Toby Jackson, Grégoire Vincent, and Tommaso\nJucker. 2024. “Robust Characterisation of Forest Structure from\nAirborne Laser Scanning—a Systematic Assessment and Sample Workflow for\nEcologists.” Methods in Ecology and Evolution 15\n(October): 1873–88. https://doi.org/10.1111/2041-210X.14416.\n\n\nJucker, Tommaso, Fabian Jörg Fischer, Jérôme Chave, David A. Coomes,\nJohn Caspersen, Arshad Ali, Grace Jopaul Loubota Panzou, et al. 2022.\n“Tallo: A Global Tree Allometry and Crown Architecture\nDatabase.” Global Change Biology 28 (September):\n5254–68. https://doi.org/10.1111/gcb.16302.\n\n\nMelo, Antonio Willian Flores de, Adriano José Nogueira Lima, Marcus\nVinicio Neves d’Oliveira, Joaquim dos Santos, I. Foster Brown, Eufran\nFerreira do Amaral, Sonaira Souza da Silva, Igor Oliveira, Plínio\nBarbosa de Camargo, and Niro Higuchi. 2024. “To Improve Estimates\nof Neotropical Forest Carbon Stocks More Direct Measurements Are Needed:\nAn Example from the Southwestern Amazon.” Forest Ecology and\nManagement 570 (October). https://doi.org/10.1016/j.foreco.2024.122195.\n\n\nMolto, Q., B. Hérault, J. J. Boreux, M. Daullet, A. Rousteau, and V.\nRossi. 2014. “Predicting Tree Heights for Biomass Estimates in\nTropical Forests -a Test from French Guiana.”\nBiogeosciences 11 (June): 3121–30. https://doi.org/10.5194/bg-11-3121-2014.\n\n\nNatalino, José, Macedo Silva, José Do Carmo, Alves Lopes, Lia Cunha,\nOliveira Silvia, Maria Alves, et al. 2005. “Diretrizes Para\nInstalação e Medição de Parcelas Permanentes Em Florestas Naturais Da\nAmazônia Brasileira.”\n\n\nNogueira, Euler Melo, Philip Martin Fearnside, Bruce Walker Nelson,\nReinaldo Imbrozio Barbosa, and Edwin Willem Hermanus Keizer. 2008.\n“Estimates of Forest Biomass in the Brazilian Amazon: New\nAllometric Equations and Adjustments to Biomass from Wood-Volume\nInventories.” Forest Ecology and Management 256\n(November): 1853–67. https://doi.org/10.1016/j.foreco.2008.07.022.\n\n\nOliveira, Gustavo Bediaga, Robson Cruz Santos, and José Humberto Chaves.\n2024. “Produção Madeireira Nas Concessões Florestais Federais Da\nAmazônia.” Gestão Da Informação Ambiental, 170–82. https://www.ibama.gov.br/sophia/cnia/periodico/trajetoriasperspectivas4.pdf.\n\n\nRéjou-Méchain, Maxime, Ariane Tanguy, Camille Piponiot, Jérôme Chave,\nand Bruno Hérault. 2017. “Biomass: An r Package for Estimating\nAbove-Ground Biomass and Its Uncertainty in Tropical Forests.”\nMethods in Ecology and Evolution 8 (September): 1163–67. https://doi.org/10.1111/2041-210X.12753.",
    "crumbs": [
      "Appendices",
      "References"
    ]
  },
  {
    "objectID": "20_data_exploration.html",
    "href": "20_data_exploration.html",
    "title": "Data Exploration",
    "section": "",
    "text": "With all datasets harmonized, we proceed to explore and extract information to support subsequent analyses. Our primary focus is above-ground biomass, and we therefore investigate approaches to obtain the most accurate biomass estimates.",
    "crumbs": [
      "Data Exploration"
    ]
  },
  {
    "objectID": "30_data_analisys.html",
    "href": "30_data_analisys.html",
    "title": "Data Analisys",
    "section": "",
    "text": "We now proceed to the analysis. We estimate biomass using different approaches and develop a site-specific allometric equation, calibrated with data from additional forest inventories conducted in the Jamari National Forest.",
    "crumbs": [
      "Data Analisys"
    ]
  },
  {
    "objectID": "10_data_prep.html",
    "href": "10_data_prep.html",
    "title": "Data preparation",
    "section": "",
    "text": "The study area is located within the Forest Concession of the Jamari National Forest. We use data from permanent plots, commercial forest inventories, and airborne LiDAR surveys. In this section, we describe how these datasets were harmonized and corrected prior to analysis.",
    "crumbs": [
      "Data preparation"
    ]
  },
  {
    "objectID": "34_modelling_H.html#lecture",
    "href": "34_modelling_H.html#lecture",
    "title": "9  Modelling DBH x Height",
    "section": "9.2 Lecture",
    "text": "9.2 Lecture\n\nAbout tree height allometry: Molto et al. (2014)\nTALLO database: Jucker et al. (2022)\ncmdstanr installation: https://mc-stan.org/cmdstanr/articles/cmdstanr.html\nstan programming: https://mc-stan.org/",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Modelling DBH x Height</span>"
    ]
  },
  {
    "objectID": "34_modelling_H.html#setup",
    "href": "34_modelling_H.html#setup",
    "title": "9  Modelling DBH x Height",
    "section": "9.3 Setup",
    "text": "9.3 Setup\nYou only need the tidyverse package for table manipulation and figures preparation, cmdstanr, brms, and bayesplot for Bayesian statistics.\n\n\nCode\nlibrary(tidyverse)\nlibrary(cmdstanr)\nlibrary(brms)\nlibrary(bayesplot)",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Modelling DBH x Height</span>"
    ]
  },
  {
    "objectID": "34_modelling_H.html#data",
    "href": "34_modelling_H.html#data",
    "title": "9  Modelling DBH x Height",
    "section": "9.4 Data",
    "text": "9.4 Data\nData are tree hight and diameter from the TALLO database (Jucker et al. 2022) itself using dos-Santos et al. (2022) data for Jamari. Longitude and latitude are in degrees, so 1 degree is about 110 km at the equator, and we use a buffer of 10km. We have a total of 974 individuals and 134 species.\n\n\nCode\nlon &lt;- -62.99\nlat &lt;- -9.11\nbuffer &lt;- 10/110\ndata &lt;- read_csv(\"data/forest_inventory/tallo.csv\") %&gt;% \n  filter(longitude &gt;= lon-buffer, longitude &lt;= lon+buffer,\n          latitude &gt;= lat-buffer, latitude &lt;= lat+buffer) %&gt;% \n  mutate(species = paste(genus, species)) %&gt;% \n  select(tree_id, species, height_m, stem_diameter_cm)\nggplot(data, aes(stem_diameter_cm, height_m)) +\n  geom_point(aes(col = species), alpha = 0.25) +\n  theme_bw() +\n  geom_smooth(se = FALSE) +\n  scale_color_discrete(guide = \"none\") +\n  xlab(\"diameter (cm)\") + ylab(\"height (m)\") +\n  ggtitle(paste(nrow(data), \"individuals\"),\n          \n          paste(unique(data$species) %&gt;% length(),\n                \"species\"))\n\n\n\n\n\n\n\n\n\nLet’s see if data from dos-Santos et al. (2022) area the same. Filter only tree (type == “O”) and alive (dead == “A”).\n\n\nCode\ndos_santos &lt;- list.files(\"data/forest_inventory\",\n                          pattern = \"^JAM.*\\\\.csv$\",\n                          full.names = T)\n\ndos_santos_df &lt;- dos_santos %&gt;% \n                        purrr::map_df(~ read_csv(.x, \n                                      show_col_types = FALSE, \n                                      col_types = cols(.default = col_character()))) %&gt;%\n                               filter(type == \"O\" ,\n                                      dead == \"A\",\n                                      !is.na(transect))\n\nggplot(dos_santos_df, aes(as.numeric(DBH), as.numeric(Htot))) +\n  geom_point(aes(col = scientific_name), alpha = 0.25) +\n  theme_bw() +\n  geom_smooth(se = FALSE) +\n  scale_color_discrete(guide = \"none\") +\n  xlab(\"diameter (cm)\") + ylab(\"height (m)\") +\n  ggtitle(paste(nrow(dos_santos_df), \"individuals\"),\n          paste(unique(dos_santos_df$scientific_name) %&gt;% length(),\n                \"species\"))\n\n\n\n\n\n\n\n\n\nLet’s see Brazilian National Forest Inventory data on Flona de Jamari. We will load the full inventory from Rondônia state and then we filter only the four plots inside Flona de Jamari (plots RO_74, RO_75, RO_95, RO_96)\n\n\nCode\nifn_data &lt;- read.csv2(\"data/forest_inventory/IFN_DAP10_Rondônia_disp-set2025.csv\",\n                      dec = \",\")\n\nifn_data_jamari &lt;- subset(ifn_data,\n                          ua == \"RO_74\" | ua == \"RO_75\" | ua == \"RO_95\" | ua == \"RO_96\")\n\nggplot(ifn_data_jamari, aes(as.numeric(dap), ht)) +\n  geom_point(aes(col = scientific_name), alpha = 0.25) +\n  theme_bw() +\n  geom_smooth(se = FALSE) +\n  scale_color_discrete(guide = \"none\") +\n  xlab(\"diameter (cm)\") + ylab(\"height (m)\") +\n  ggtitle(paste(nrow(ifn_data_jamari), \"individuals\"),\n          paste(unique(ifn_data_jamari$scientific_name) %&gt;% length(),\n                \"species\"))\n\n\n\n\n\n\n\n\n\nMerging two datasets (dos-Santos et al. (2022) and IFN) in a standardized data frame.\n\n\nCode\ndf1_clean &lt;- dos_santos_df %&gt;%\n  select(scientific_name, DBH, Htot) %&gt;%\n  mutate(DBH = as.numeric(DBH),\n         Htot = as.numeric(Htot),\n         source = \"dos_santos\") %&gt;%\n  rename(\n    dbh = DBH,\n    total_height = Htot\n  )\n\ndf2_clean &lt;- ifn_data_jamari %&gt;%\n  select(scientific_name, dap, ht) %&gt;%\n  mutate(dap = as.numeric(dap),\n         source = \"IFN\") %&gt;%\n  rename(\n    dbh = dap,\n    total_height = ht\n  )\n\n\njam_for_inv &lt;- bind_rows(df1_clean, df2_clean)\n\n\nggplot(jam_for_inv, aes(dbh, total_height)) +\n  geom_point(aes(col = scientific_name), alpha = 0.25) +\n  theme_bw() +\n  geom_smooth(se = FALSE) +\n  scale_color_discrete(guide = \"none\") +\n  xlab(\"diameter (cm)\") + ylab(\"height (m)\") +\n  ggtitle(paste(nrow(jam_for_inv), \"individuals\"),\n          paste(unique(jam_for_inv$scientific_name) %&gt;% length(),\n                \"species\"))",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Modelling DBH x Height</span>"
    ]
  },
  {
    "objectID": "21_wood_density_databases.html#setup",
    "href": "21_wood_density_databases.html#setup",
    "title": "4  Comparing wood density databases",
    "section": "4.2 Setup",
    "text": "4.2 Setup\n\n\nCode\nlibrary(dplyr)\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(ggrepel)\nlibrary(readr)\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\nlibrary(BIOMASS)\nlibrary(kableExtra)",
    "crumbs": [
      "Data Exploration",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Comparing wood density databases</span>"
    ]
  },
  {
    "objectID": "21_wood_density_databases.html#comparing-different-wood-databases",
    "href": "21_wood_density_databases.html#comparing-different-wood-databases",
    "title": "4  Comparing wood density databases",
    "section": "4.3 Comparing different wood databases",
    "text": "4.3 Comparing different wood databases\nBWD has many samples collected in Jamari Forest, as we can see below. We obtained the basic wood density information (g/m³) and the sample collection location for each species from the BWD website. There is no specific coordinate for the sampling location; therefore, we assigned a central coordinate to each collection location in order to determine the geographic region of origin of the sample.\n\n\nCode\nbwd &lt;- read.csv(\"data/wood_density/tabela_densidade_coordenadas.csv\")\n\nbwd_clean &lt;- bwd %&gt;%\n  filter(!is.na(long), !is.na(lat))\n\npts_bwd &lt;- st_as_sf(\n  bwd_clean,\n  coords = c(\"long\", \"lat\"),\n  crs = 4326   # WGS84 (graus decimais)\n)\n\npts_bwd_count &lt;- pts_bwd %&gt;%\n  st_coordinates() %&gt;%\n  as.data.frame() %&gt;%\n  group_by(X, Y) %&gt;%\n  summarise(n = n()) %&gt;%\n  ungroup() %&gt;%\n  st_as_sf(coords = c(\"X\", \"Y\"), crs = st_crs(pts_bwd))\n\nbrasil &lt;- ne_countries(\n  scale = \"medium\",\n  country = \"Brazil\",\n  returnclass = \"sf\"\n)\n\nggplot() +\n  geom_sf(data = brasil, \n          fill = \"gray95\", \n          color = \"gray40\") +\n  geom_sf(data = pts_bwd_count, \n          aes(size = n), \n          color = \"red\", \n          alpha = 0.7) +\n  geom_text_repel(\n    data = pts_bwd_count,\n    aes(label = n, \n        geometry = geometry),\n    stat = \"sf_coordinates\",\n    size = 3,\n    min.segment.length = 0\n  ) +\n  scale_size_continuous(name = \"Number of samples\") +\n  coord_sf() +\n  theme_minimal() +\n  labs(\n    title = paste(\"Brazilian woods database samples locations (\",\n                  nrow(pts_bwd),\n                  \"samples ).\"),\n            x = \"Longitude\",\n            y = \"Latitude\"\n  )",
    "crumbs": [
      "Data Exploration",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Comparing wood density databases</span>"
    ]
  },
  {
    "objectID": "21_wood_density_databases.html#estimating-biomass-with-bwd",
    "href": "21_wood_density_databases.html#estimating-biomass-with-bwd",
    "title": "4  Comparing wood density databases",
    "section": "4.4 Estimating biomass with BWD",
    "text": "4.4 Estimating biomass with BWD\nWe will use permanent plots measurements from Jamari National Forest. The Wood density estimates presented here are only for species the species present in the permanent plots.\nIn BWD there are multiple samples for the same species. We calculated mean basic wood density for each species with multiple samples. Then we converted bwd table to BIOMASS wood density table format.\nWe retrieved wood density from Gobal Wood Database (Chave et al. 2009) using BIOMASS.\n\n\nCode\npps &lt;- read.csv(\"output/pps/tabelao_pps.csv\")\n\nmessage(\"Permanent plots of APUs: \\n\",paste(unique(paste(pps$UMF,\n                                                         pps$UPA)),\n                                                         collapse = \"\\n\"\n                                                         ))\n\n\nPermanent plots of APUs: \nUMF_I UPA_1\nUMF_I UPA_10\nUMF_I UPA_13\nUMF_I UPA_2\nUMF_I UPA_3\nUMF_I UPA_4\nUMF_I UPA_5\nUMF_I UPA_6\nUMF_I UPA_7\nUMF_I UPA_8\nUMF_I UPA_9\nUMF_IV UPA_15\n\n\nCode\nmessage(\"Years of measurement:\\n\",paste(unique(pps$p23_cdmedicao),\n                                         collapse = \"\\n\"))\n\n\nYears of measurement:\n2010\n2013\n2016\n2018\n2021\n2015\n2017\n2023\n2020\n2022\n2011\n2012\n2014\n2019\n\n\nCode\nbwd &lt;- bwd %&gt;%\n  group_by(nome_cientifico) %&gt;%\n  summarise(mean_wd = mean(densidade_basica), \n            .groups = \"drop\")\n\nbwd_biomass &lt;- bwd %&gt;%\n  tidyr::separate(\"nome_cientifico\",\n                  c(\"genero\",\"epiteto\"),\n                  \" \")\nnames(bwd_biomass) &lt;- c(\"genus\",\"species\",\"wd\")\n\ntaxo &lt;- data.frame(\n  genusCorrected   = pps$genero,\n  speciesCorrected = pps$epiteto,\n  stringsAsFactors = FALSE\n)\n\nw_density &lt;- getWoodDensity(genus = taxo$genusCorrected,\n                            species = taxo$speciesCorrected)\n\n\nThe reference dataset contains 16467 wood density values\n\n\nYour taxonomic table contains 104 taxa\n\n\nCode\ndensidades &lt;- bwd_biomass %&gt;%\n                  inner_join(w_density,\n                  by = c(\"genus\",\n                         \"species\")) %&gt;%\n                  select(genus,\n                         species,\n                         WD_global = meanWD,\n                         WD_brazil = wd)\n\ndensidades &lt;- unique(densidades)\n\nggplot(densidades, aes(x = WD_global, \n                       y = WD_brazil)) +\n  geom_point(alpha = 0.7) +\n  geom_abline(slope = 1, \n              intercept = 0, \n              linetype = \"dashed\") +\n  labs(\n    x = \"Global Wood density database\",\n    y = \"Brazilian Woods density database\",\n    title = paste(\"Comparison of wood density estimates for\",\n                  nrow(densidades),\n                  \"species between BWD and GWD\")\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nCode\ntext &lt;- paste(\"BWD has wood density of\",\n              length(unique(bwd$nome_cientifico)),\n              \"species.\\n\",\n              \"BWD and GWD share\", \n              nrow(densidades),\n              \"species in common.\")\n\n\n\n\n\n\n\n\nNote\n\n\n\nBWD has wood density of 275 species. BWD and GWD share 55 species in common.\n\n\nWe can use Bland-Altman graphic to see differences between wood density databases. I will highlight species that are out of limits of agreement.\n\n\nCode\ndensidades$mean_density &lt;- (densidades$WD_global + densidades$WD_brazil) / 2\ndensidades$diff_density &lt;- densidades$WD_global - densidades$WD_brazil\n\nbias &lt;- mean(densidades$diff_density, \n             na.rm = TRUE)\nsd_diff &lt;- sd(densidades$diff_density, \n              na.rm = TRUE)\n\nloa_inf &lt;- bias - 1.96 * sd_diff\nloa_sup &lt;- bias + 1.96 * sd_diff\n\ndensidades &lt;- densidades %&gt;%\n                 mutate(fora_loa = diff_density &lt; loa_inf | diff_density &gt; loa_sup)\n\ndensidades$especie &lt;- paste(densidades$genus,\n                            densidades$species,\n                            sep = \" \")\n\nggplot(densidades, aes(x = mean_density, \n                       y = diff_density,\n                       color = especie)) +\n  geom_point(alpha = 0.7) +\n  geom_hline(yintercept = mean(densidades$diff_density,\n                               na.rm = TRUE),\n             linetype = \"dashed\") +\n  geom_hline(yintercept = mean(densidades$diff_density,\n                               na.rm = TRUE) +\n                           1.96 * sd(densidades$diff_density,\n                                     na.rm = TRUE),\n             linetype = \"dotted\") +\n  geom_hline(yintercept = mean(densidades$diff_density,\n                               na.rm = TRUE) -\n                           1.96 * sd(densidades$diff_density,\n                                     na.rm = TRUE),\n             linetype = \"dotted\") +\n    geom_text_repel(\n    data = subset(densidades, fora_loa),\n    aes(label = especie),\n    size = 3,\n    show.legend = FALSE\n  ) +\n  labs(\n    x = \"Mean wood density\",\n    y = \"Difference between methods\",\n    title = \"Bland–Altman: wood density databases\"\n  ) +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\n\n\n\n\n\n\n\n\nLet’s see the difference in biomass estimation.\nTotal tree height was obtained using the retrieveH function from the BIOMASS package, based on the central coordinates of the Jamari National Forest (Flona de Jamari). Biomass was estimated using the computeAGB function from the BIOMASS package, using the total height derived from retrieveH and the two wood density databases (the Global Wood Density Database and the Brazilian Wood Density Database). The BWD does not provide estimates of basic wood density for all species. When species-level values are unavailable, estimates from Global Wood Database will be used.\nEach point represents one year of measurement for a plot. I will highlight plots with biomass estimation out of limits of agreement.\n\n\nCode\nw_density_BR &lt;- left_join(w_density, \n                          bwd_biomass, \n                          by = c(\"species\",\n                                 \"genus\"), \n                          multiple = \"any\") %&gt;% \n                \n                mutate(wd = ifelse(!is.na(wd), \n                                   wd, \n                                   meanWD)) %&gt;% \n                select(family, \n                       genus, \n                       species, \n                       wd)\n\n\naltura &lt;- retrieveH(D = pps$diametrocm,\n                    coord = c(-62.99,\n                                   -9.11\n                                   ))\n\n\npps$altura &lt;- altura$H\n\npps$AGB_Global &lt;- computeAGB(D = pps$diametrocm,\n                             WD = w_density$meanWD,\n                             H = pps$altura)\n\npps$AGB_Brazilian &lt;- computeAGB(D = pps$diametrocm,\n                                WD = w_density_BR$wd,\n                                H = pps$altura)\n\npps$plot &lt;- paste(pps$UMF,pps$UPA,\n                  \"plot\",\n                  pps$p23_cdparcela,\n                  pps$p23_cdmedicao)\n\n\npps_plots &lt;- pps %&gt;% \n              group_by(plot,\n                       p23_cdmedicao) %&gt;% \n              summarise(\"AGB_Global\" = sum(AGB_Global),\n                        \"AGB_Brazilian\" = sum(AGB_Brazilian))\n\npps_plots$mean_density &lt;- (pps_plots$AGB_Global + pps_plots$AGB_Brazilian) / 2\npps_plots$diff_density &lt;- pps_plots$AGB_Global - pps_plots$AGB_Brazilian\n\nbias &lt;- mean(pps_plots$diff_density, \n             na.rm = TRUE)\nsd_diff &lt;- sd(pps_plots$diff_density, \n              na.rm = TRUE)\n\nloa_inf &lt;- bias - 1.96 * sd_diff\nloa_sup &lt;- bias + 1.96 * sd_diff\n\npps_plots &lt;- pps_plots %&gt;%\n            mutate(fora_loa = diff_density &lt; loa_inf | diff_density &gt; loa_sup)\n\n\nggplot(pps_plots, aes(x = mean_density, \n                      y = diff_density,\n                      color = plot)) +\n  geom_point(alpha = 0.7) +\n  geom_hline(yintercept = mean(pps_plots$diff_density,\n                               na.rm = TRUE),\n             linetype = \"dashed\") +\n  geom_hline(yintercept = mean(pps_plots$diff_density,\n                               na.rm = TRUE) +\n                           1.96 * sd(pps_plots$diff_density,\n                                     na.rm = TRUE),\n             linetype = \"dotted\") +\n  geom_hline(yintercept = mean(pps_plots$diff_density,\n                               na.rm = TRUE) -\n                           1.96 * sd(pps_plots$diff_density,\n                                     na.rm = TRUE),\n             linetype = \"dotted\") +\n    geom_text_repel(\n    data = subset(pps_plots, \n                  fora_loa),\n    aes(label = plot),\n    size = 3,\n    show.legend = FALSE\n  ) +\n  labs(\n    x = \"Mean plot AGB\",\n    y = \"Difference between methods\",\n    title = \"Bland-Altman: Plot AGB estimates with different wood density databases\"\n  ) +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\n\n\n\n\n\n\n\n\nCode\ndif_AGBs &lt;- pps_plots %&gt;%\n  mutate(\n    diff = abs(AGB_Global - AGB_Brazilian),\n    diff_perc = (diff / AGB_Global) * 100\n  ) %&gt;%\n  select(plot, AGB_Global, AGB_Brazilian, diff, diff_perc) %&gt;%\n  arrange(desc(diff_perc)) %&gt;%\n  mutate(diff_perc = round(diff_perc, 2))\n\n\n  kable(dif_AGBs,\n    caption = \"Absolute and relative difference between AGBs\",\n    col.names = c(\"Plot\", \"AGB Global\", \"AGB Brazilian\", \"Difference\", \"Difference (%)\")\n  ) %&gt;%\n  kable_styling(full_width = FALSE, position = \"center\") %&gt;%\n    kableExtra::scroll_box(height = \"400px\", width = \"100%\")\n\n\n\n\nAbsolute and relative difference between AGBs\n\n\nPlot\nAGB Global\nAGB Brazilian\nDifference\nDifference (%)\n\n\n\n\nUMF_I UPA_2 plot 8 2011\n49.78417\n45.76349\n4.0206756\n8.08\n\n\nUMF_I UPA_2 plot 8 2013\n55.63526\n51.35464\n4.2806251\n7.69\n\n\nUMF_I UPA_2 plot 8 2016\n61.40135\n56.92133\n4.4800279\n7.30\n\n\nUMF_I UPA_5 plot 9 2019\n109.08370\n101.74244\n7.3412640\n6.73\n\n\nUMF_I UPA_2 plot 8 2021\n73.91046\n69.07685\n4.8336139\n6.54\n\n\nUMF_I UPA_7 plot 4 2020\n88.43654\n93.77966\n5.3431237\n6.04\n\n\nUMF_I UPA_7 plot 4 2019\n88.39637\n93.73296\n5.3365841\n6.04\n\n\nUMF_I UPA_5 plot 9 2013\n111.49535\n104.78220\n6.7131586\n6.02\n\n\nUMF_I UPA_5 plot 9 2015\n112.98623\n106.31004\n6.6761913\n5.91\n\n\nUMF_I UPA_8 plot 1 2017\n124.77302\n117.94769\n6.8253253\n5.47\n\n\nUMF_I UPA_9 plot 1 2017\n124.77302\n117.94769\n6.8253253\n5.47\n\n\nUMF_I UPA_8 plot 1 2019\n126.01309\n119.18066\n6.8324362\n5.42\n\n\nUMF_I UPA_9 plot 1 2019\n126.01309\n119.18066\n6.8324362\n5.42\n\n\nUMF_I UPA_4 plot 9 2012\n140.66985\n133.49095\n7.1788979\n5.10\n\n\nUMF_I UPA_6 plot 1 2014\n175.80782\n166.87583\n8.9319891\n5.08\n\n\nUMF_I UPA_10 plot 4 2023\n62.14742\n65.22646\n3.0790489\n4.95\n\n\nUMF_I UPA_4 plot 9 2014\n143.46225\n136.38440\n7.0778559\n4.93\n\n\nUMF_I UPA_2 plot 2 2016\n71.63603\n75.05387\n3.4178394\n4.77\n\n\nUMF_I UPA_1 plot 5 2010\n55.47410\n58.11771\n2.6436094\n4.77\n\n\nUMF_I UPA_2 plot 2 2021\n80.44123\n84.21434\n3.7731018\n4.69\n\n\nUMF_I UPA_5 plot 8 2019\n99.86790\n104.50618\n4.6382782\n4.64\n\n\nUMF_I UPA_10 plot 4 2015\n63.31582\n66.16888\n2.8530553\n4.51\n\n\nUMF_I UPA_10 plot 4 2017\n65.12840\n68.05299\n2.9245835\n4.49\n\n\nUMF_I UPA_10 plot 3 2015\n56.63193\n59.12236\n2.4904342\n4.40\n\n\nUMF_I UPA_10 plot 3 2017\n58.55062\n61.02998\n2.4793597\n4.23\n\n\nUMF_I UPA_13 plot 3 2020\n62.05757\n64.55164\n2.4940658\n4.02\n\n\nUMF_I UPA_13 plot 3 2022\n64.53398\n67.12730\n2.5933256\n4.02\n\n\nUMF_I UPA_5 plot 8 2013\n94.08163\n97.77032\n3.6886900\n3.92\n\n\nUMF_I UPA_5 plot 8 2015\n96.84418\n100.61929\n3.7751154\n3.90\n\n\nUMF_I UPA_6 plot 1 2016\n131.47873\n126.41455\n5.0641793\n3.85\n\n\nUMF_I UPA_2 plot 1 2011\n98.18137\n94.53309\n3.6482772\n3.72\n\n\nUMF_I UPA_2 plot 1 2016\n108.69576\n104.71439\n3.9813761\n3.66\n\n\nUMF_I UPA_2 plot 1 2021\n121.96488\n117.51318\n4.4516999\n3.65\n\n\nUMF_I UPA_2 plot 1 2013\n105.35751\n101.52762\n3.8298872\n3.64\n\n\nUMF_I UPA_5 plot 3 2019\n48.23569\n49.90397\n1.6682865\n3.46\n\n\nUMF_I UPA_6 plot 9 2014\n67.70705\n70.03345\n2.3264038\n3.44\n\n\nUMF_I UPA_8 plot 4 2017\n78.54076\n75.87703\n2.6637348\n3.39\n\n\nUMF_I UPA_9 plot 4 2017\n78.54076\n75.87703\n2.6637348\n3.39\n\n\nUMF_I UPA_6 plot 9 2016\n71.71043\n74.10109\n2.3906627\n3.33\n\n\nUMF_I UPA_8 plot 4 2019\n80.51725\n77.86603\n2.6512117\n3.29\n\n\nUMF_I UPA_9 plot 4 2019\n80.51725\n77.86603\n2.6512117\n3.29\n\n\nUMF_I UPA_5 plot 7 2019\n41.30085\n42.60685\n1.3060015\n3.16\n\n\nUMF_I UPA_8 plot 6 2019\n92.84010\n95.71768\n2.8775724\n3.10\n\n\nUMF_I UPA_9 plot 6 2019\n92.84010\n95.71768\n2.8775724\n3.10\n\n\nUMF_IV UPA_15 plot 3 2020\n50.75750\n52.32646\n1.5689553\n3.09\n\n\nUMF_I UPA_8 plot 6 2017\n89.49599\n92.23748\n2.7414901\n3.06\n\n\nUMF_I UPA_9 plot 6 2017\n89.49599\n92.23748\n2.7414901\n3.06\n\n\nUMF_IV UPA_15 plot 3 2022\n52.16722\n53.76304\n1.5958216\n3.06\n\n\nUMF_I UPA_4 plot 3 2012\n40.24498\n41.46130\n1.2163188\n3.02\n\n\nUMF_I UPA_7 plot 2 2020\n46.42593\n47.78968\n1.3637562\n2.94\n\n\nUMF_I UPA_1 plot 5 2013\n60.07885\n61.83601\n1.7571584\n2.92\n\n\nUMF_I UPA_6 plot 1 2020\n117.53119\n114.16292\n3.3682747\n2.87\n\n\nUMF_I UPA_4 plot 3 2014\n43.32220\n44.56010\n1.2378913\n2.86\n\n\nUMF_I UPA_4 plot 7 2012\n83.91347\n81.52543\n2.3880359\n2.85\n\n\nUMF_I UPA_1 plot 1 2010\n141.59067\n137.59897\n3.9916962\n2.82\n\n\nUMF_I UPA_7 plot 2 2019\n46.62393\n47.92261\n1.2986812\n2.79\n\n\nUMF_I UPA_10 plot 5 2015\n38.72413\n37.64722\n1.0769117\n2.78\n\n\nUMF_I UPA_1 plot 6 2010\n65.29853\n67.08520\n1.7866696\n2.74\n\n\nUMF_I UPA_5 plot 7 2015\n70.60840\n72.53069\n1.9222901\n2.72\n\n\nUMF_I UPA_1 plot 1 2013\n148.99734\n144.96700\n4.0303350\n2.70\n\n\nUMF_I UPA_4 plot 7 2014\n87.17371\n84.84377\n2.3299357\n2.67\n\n\nUMF_I UPA_5 plot 7 2013\n68.70582\n70.53507\n1.8292548\n2.66\n\n\nUMF_I UPA_3 plot 6 2012\n69.67803\n67.83784\n1.8401950\n2.64\n\n\nUMF_I UPA_10 plot 5 2017\n40.46484\n39.40227\n1.0625623\n2.63\n\n\nUMF_I UPA_13 plot 2 2022\n70.29663\n72.12250\n1.8258754\n2.60\n\n\nUMF_I UPA_3 plot 6 2013\n73.11365\n71.21718\n1.8964629\n2.59\n\n\nUMF_I UPA_3 plot 6 2023\n77.08552\n75.09241\n1.9931084\n2.59\n\n\nUMF_I UPA_4 plot 3 2018\n48.82881\n50.08417\n1.2553580\n2.57\n\n\nUMF_I UPA_13 plot 2 2020\n68.37757\n70.09773\n1.7201612\n2.52\n\n\nUMF_I UPA_3 plot 6 2017\n73.11969\n71.28398\n1.8357061\n2.51\n\n\nUMF_I UPA_4 plot 5 2018\n78.34285\n80.30077\n1.9579185\n2.50\n\n\nUMF_I UPA_6 plot 9 2020\n65.41002\n67.04035\n1.6303362\n2.49\n\n\nUMF_I UPA_1 plot 4 2010\n78.28289\n80.22775\n1.9448626\n2.48\n\n\nUMF_I UPA_4 plot 3 2023\n53.59144\n54.91902\n1.3275800\n2.48\n\n\nUMF_I UPA_4 plot 5 2014\n71.53291\n73.28962\n1.7567086\n2.46\n\n\nUMF_I UPA_4 plot 7 2018\n93.20928\n90.92654\n2.2827417\n2.45\n\n\nUMF_I UPA_5 plot 3 2015\n63.98371\n65.54751\n1.5638015\n2.44\n\n\nUMF_I UPA_2 plot 2 2011\n138.44420\n141.81538\n3.3711764\n2.44\n\n\nUMF_I UPA_4 plot 5 2012\n68.39018\n70.05366\n1.6634802\n2.43\n\n\nUMF_I UPA_1 plot 3 2016\n103.81550\n106.34005\n2.5245486\n2.43\n\n\nUMF_I UPA_1 plot 4 2018\n73.86184\n75.63370\n1.7718551\n2.40\n\n\nUMF_I UPA_6 plot 3 2020\n56.57611\n57.92632\n1.3502119\n2.39\n\n\nUMF_I UPA_2 plot 2 2013\n144.59019\n147.97494\n3.3847444\n2.34\n\n\nUMF_I UPA_1 plot 4 2021\n74.88661\n76.63932\n1.7527131\n2.34\n\n\nUMF_I UPA_5 plot 3 2013\n61.97244\n63.41857\n1.4461294\n2.33\n\n\nUMF_I UPA_3 plot 7 2023\n89.55115\n87.47834\n2.0728058\n2.31\n\n\nUMF_I UPA_3 plot 7 2017\n83.44802\n81.54640\n1.9016255\n2.28\n\n\nUMF_I UPA_4 plot 9 2023\n64.19795\n62.73879\n1.4591629\n2.27\n\n\nUMF_I UPA_1 plot 2 2010\n53.79504\n55.01628\n1.2212372\n2.27\n\n\nUMF_I UPA_1 plot 8 2021\n61.87745\n63.27444\n1.3969969\n2.26\n\n\nUMF_I UPA_3 plot 8 2023\n83.69963\n85.58468\n1.8850439\n2.25\n\n\nUMF_I UPA_8 plot 5 2019\n34.47048\n35.23482\n0.7643388\n2.22\n\n\nUMF_I UPA_9 plot 5 2019\n34.47048\n35.23482\n0.7643388\n2.22\n\n\nUMF_I UPA_1 plot 3 2010\n99.65737\n101.84870\n2.1913247\n2.20\n\n\nUMF_I UPA_1 plot 8 2016\n56.88342\n58.12381\n1.2403869\n2.18\n\n\nUMF_I UPA_1 plot 8 2018\n59.28152\n60.56873\n1.2872083\n2.17\n\n\nUMF_I UPA_3 plot 4 2023\n79.33470\n77.61907\n1.7156268\n2.16\n\n\nUMF_I UPA_1 plot 3 2013\n105.75754\n108.03683\n2.2792864\n2.16\n\n\nUMF_I UPA_4 plot 6 2018\n62.57151\n63.91201\n1.3404997\n2.14\n\n\nUMF_I UPA_1 plot 4 2016\n76.24741\n77.87986\n1.6324443\n2.14\n\n\nUMF_I UPA_1 plot 9 2010\n90.62348\n92.55793\n1.9344442\n2.13\n\n\nUMF_I UPA_3 plot 7 2012\n82.01588\n80.26592\n1.7499671\n2.13\n\n\nUMF_I UPA_3 plot 7 2013\n85.42467\n83.60381\n1.8208562\n2.13\n\n\nUMF_I UPA_1 plot 3 2018\n105.37675\n107.62059\n2.2438437\n2.13\n\n\nUMF_I UPA_1 plot 3 2021\n110.20383\n112.51870\n2.3148729\n2.10\n\n\nUMF_I UPA_3 plot 4 2017\n77.02731\n75.41305\n1.6142586\n2.10\n\n\nUMF_I UPA_8 plot 3 2017\n91.84758\n93.75445\n1.9068729\n2.08\n\n\nUMF_I UPA_9 plot 3 2017\n91.84758\n93.75445\n1.9068729\n2.08\n\n\nUMF_I UPA_8 plot 3 2019\n93.68835\n95.62978\n1.9414310\n2.07\n\n\nUMF_I UPA_9 plot 3 2019\n93.68835\n95.62978\n1.9414310\n2.07\n\n\nUMF_I UPA_4 plot 7 2023\n85.31005\n83.55186\n1.7581920\n2.06\n\n\nUMF_I UPA_8 plot 5 2017\n30.83416\n31.46883\n0.6346720\n2.06\n\n\nUMF_I UPA_9 plot 5 2017\n30.83416\n31.46883\n0.6346720\n2.06\n\n\nUMF_I UPA_13 plot 6 2022\n86.40409\n88.18142\n1.7773310\n2.06\n\n\nUMF_I UPA_13 plot 6 2020\n84.81513\n86.55165\n1.7365152\n2.05\n\n\nUMF_I UPA_3 plot 1 2017\n93.58411\n91.68251\n1.9015995\n2.03\n\n\nUMF_I UPA_4 plot 5 2023\n82.27265\n83.93260\n1.6599519\n2.02\n\n\nUMF_I UPA_6 plot 7 2020\n64.48849\n65.78338\n1.2948954\n2.01\n\n\nUMF_I UPA_3 plot 1 2013\n92.12634\n90.34460\n1.7817429\n1.93\n\n\nUMF_I UPA_2 plot 6 2021\n88.92697\n87.20792\n1.7190527\n1.93\n\n\nUMF_I UPA_3 plot 1 2012\n89.74763\n88.01856\n1.7290652\n1.93\n\n\nUMF_I UPA_3 plot 1 2023\n98.74674\n96.84718\n1.8995586\n1.92\n\n\nUMF_I UPA_4 plot 8 2023\n62.91237\n64.11419\n1.2018205\n1.91\n\n\nUMF_I UPA_1 plot 4 2013\n84.71152\n86.32938\n1.6178511\n1.91\n\n\nUMF_I UPA_2 plot 6 2013\n72.39286\n71.01508\n1.3777797\n1.90\n\n\nUMF_I UPA_2 plot 6 2016\n79.88236\n78.36775\n1.5146101\n1.90\n\n\nUMF_I UPA_7 plot 3 2020\n37.75361\n38.46851\n0.7148984\n1.89\n\n\nUMF_I UPA_7 plot 3 2019\n37.58997\n38.30057\n0.7106029\n1.89\n\n\nUMF_I UPA_1 plot 6 2018\n79.22584\n77.73220\n1.4936418\n1.89\n\n\nUMF_I UPA_7 plot 6 2020\n76.84243\n78.26924\n1.4268055\n1.86\n\n\nUMF_I UPA_7 plot 6 2019\n76.45739\n77.87579\n1.4183963\n1.86\n\n\nUMF_I UPA_6 plot 4 2020\n55.27042\n56.29516\n1.0247416\n1.85\n\n\nUMF_I UPA_4 plot 6 2014\n57.15729\n58.20641\n1.0491145\n1.84\n\n\nUMF_I UPA_6 plot 8 2014\n80.01950\n81.47478\n1.4552807\n1.82\n\n\nUMF_I UPA_2 plot 4 2011\n96.16023\n94.41840\n1.7418342\n1.81\n\n\nUMF_I UPA_2 plot 6 2011\n66.75033\n65.54787\n1.2024664\n1.80\n\n\nUMF_I UPA_2 plot 4 2013\n100.56273\n98.77820\n1.7845297\n1.77\n\n\nUMF_I UPA_1 plot 9 2021\n108.15476\n110.06666\n1.9118998\n1.77\n\n\nUMF_I UPA_4 plot 6 2012\n53.90106\n54.85001\n0.9489575\n1.76\n\n\nUMF_I UPA_10 plot 8 2015\n76.60485\n77.95310\n1.3482513\n1.76\n\n\nUMF_I UPA_1 plot 6 2016\n77.12099\n75.76869\n1.3523052\n1.75\n\n\nUMF_I UPA_10 plot 8 2017\n78.26024\n79.62969\n1.3694572\n1.75\n\n\nUMF_I UPA_1 plot 9 2018\n103.01691\n104.81830\n1.8013842\n1.75\n\n\nUMF_I UPA_6 plot 8 2016\n82.73919\n84.18556\n1.4463757\n1.75\n\n\nUMF_I UPA_3 plot 2 2023\n87.55731\n86.05718\n1.5001349\n1.71\n\n\nUMF_I UPA_4 plot 9 2018\n63.08077\n62.01486\n1.0659035\n1.69\n\n\nUMF_I UPA_3 plot 8 2012\n76.48495\n77.77480\n1.2898512\n1.69\n\n\nUMF_I UPA_4 plot 8 2018\n61.43267\n62.45680\n1.0241310\n1.67\n\n\nUMF_I UPA_3 plot 2 2017\n84.48085\n83.08389\n1.3969600\n1.65\n\n\nUMF_I UPA_1 plot 2 2016\n65.67454\n66.75800\n1.0834597\n1.65\n\n\nUMF_I UPA_1 plot 9 2013\n95.79155\n97.35707\n1.5655202\n1.63\n\n\nUMF_I UPA_5 plot 5 2015\n64.84191\n65.89449\n1.0525843\n1.62\n\n\nUMF_I UPA_5 plot 5 2013\n63.19198\n64.21549\n1.0235017\n1.62\n\n\nUMF_I UPA_5 plot 10 2015\n69.19741\n70.31497\n1.1175542\n1.62\n\n\nUMF_I UPA_2 plot 7 2016\n70.90359\n69.76314\n1.1404425\n1.61\n\n\nUMF_I UPA_3 plot 8 2013\n79.42413\n80.69837\n1.2742404\n1.60\n\n\nUMF_I UPA_13 plot 1 2022\n78.01820\n79.26652\n1.2483240\n1.60\n\n\nUMF_I UPA_4 plot 6 2023\n64.34666\n65.37483\n1.0281715\n1.60\n\n\nUMF_I UPA_1 plot 2 2021\n67.56413\n68.64286\n1.0787234\n1.60\n\n\nUMF_I UPA_13 plot 5 2020\n45.56140\n46.28546\n0.7240602\n1.59\n\n\nUMF_I UPA_13 plot 8 2022\n52.23611\n53.06279\n0.8266777\n1.58\n\n\nUMF_I UPA_5 plot 10 2013\n66.57363\n67.62568\n1.0520450\n1.58\n\n\nUMF_I UPA_13 plot 1 2020\n76.25764\n77.45406\n1.1964251\n1.57\n\n\nUMF_I UPA_1 plot 6 2013\n71.46023\n70.34148\n1.1187464\n1.57\n\n\nUMF_I UPA_13 plot 5 2022\n47.39914\n48.13703\n0.7378831\n1.56\n\n\nUMF_I UPA_4 plot 4 2014\n59.50858\n60.43472\n0.9261397\n1.56\n\n\nUMF_I UPA_13 plot 8 2020\n50.98947\n51.78075\n0.7912733\n1.55\n\n\nUMF_I UPA_3 plot 8 2017\n81.09508\n82.33227\n1.2371862\n1.53\n\n\nUMF_I UPA_4 plot 4 2012\n56.87086\n57.73384\n0.8629793\n1.52\n\n\nUMF_I UPA_5 plot 10 2019\n72.95890\n74.05974\n1.1008397\n1.51\n\n\nUMF_I UPA_10 plot 8 2023\n73.56025\n74.66892\n1.1086706\n1.51\n\n\nUMF_I UPA_1 plot 9 2016\n104.66734\n106.23096\n1.5636226\n1.49\n\n\nUMF_I UPA_2 plot 3 2016\n70.50813\n69.46436\n1.0437755\n1.48\n\n\nUMF_I UPA_2 plot 7 2021\n76.13251\n75.00818\n1.1243280\n1.48\n\n\nUMF_IV UPA_15 plot 2 2022\n98.74045\n97.28317\n1.4572871\n1.48\n\n\nUMF_IV UPA_15 plot 2 2020\n97.45259\n96.01660\n1.4359886\n1.47\n\n\nUMF_I UPA_1 plot 2 2018\n68.20128\n69.20472\n1.0034468\n1.47\n\n\nUMF_I UPA_2 plot 3 2021\n81.37186\n80.18205\n1.1898072\n1.46\n\n\nUMF_I UPA_2 plot 3 2013\n69.79904\n68.78026\n1.0187847\n1.46\n\n\nUMF_I UPA_1 plot 2 2013\n61.88458\n62.78657\n0.9019917\n1.46\n\n\nUMF_I UPA_6 plot 7 2016\n68.70774\n69.70901\n1.0012759\n1.46\n\n\nUMF_I UPA_2 plot 7 2013\n70.89011\n69.85988\n1.0302270\n1.45\n\n\nUMF_I UPA_6 plot 7 2014\n67.47663\n68.44021\n0.9635778\n1.43\n\n\nUMF_I UPA_5 plot 1 2019\n90.86566\n92.16302\n1.2973597\n1.43\n\n\nUMF_I UPA_2 plot 7 2011\n65.49202\n64.56168\n0.9303363\n1.42\n\n\nUMF_I UPA_6 plot 4 2016\n62.23487\n63.11545\n0.8805732\n1.41\n\n\nUMF_I UPA_6 plot 4 2014\n57.61442\n58.41779\n0.8033667\n1.39\n\n\nUMF_I UPA_10 plot 7 2017\n64.17284\n65.06394\n0.8910982\n1.39\n\n\nUMF_I UPA_4 plot 4 2018\n65.74774\n66.65737\n0.9096273\n1.38\n\n\nUMF_I UPA_2 plot 3 2011\n61.81673\n60.96325\n0.8534875\n1.38\n\n\nUMF_I UPA_10 plot 7 2015\n62.10232\n62.94780\n0.8454744\n1.36\n\n\nUMF_I UPA_10 plot 7 2023\n66.00121\n66.89919\n0.8979759\n1.36\n\n\nUMF_I UPA_3 plot 4 2013\n88.96555\n87.76129\n1.2042664\n1.35\n\n\nUMF_IV UPA_15 plot 4 2020\n49.51833\n48.84890\n0.6694356\n1.35\n\n\nUMF_I UPA_5 plot 4 2019\n57.98692\n58.76763\n0.7807015\n1.35\n\n\nUMF_I UPA_3 plot 4 2012\n86.21513\n85.06654\n1.1485848\n1.33\n\n\nUMF_I UPA_4 plot 8 2014\n60.99722\n61.79394\n0.7967169\n1.31\n\n\nUMF_I UPA_5 plot 1 2015\n96.62997\n97.86797\n1.2379950\n1.28\n\n\nUMF_IV UPA_15 plot 4 2022\n51.02614\n50.37884\n0.6472966\n1.27\n\n\nUMF_I UPA_4 plot 1 2014\n99.55331\n100.78863\n1.2353146\n1.24\n\n\nUMF_I UPA_4 plot 8 2012\n56.95336\n57.65442\n0.7010619\n1.23\n\n\nUMF_I UPA_5 plot 1 2013\n94.39891\n95.55004\n1.1511343\n1.22\n\n\nUMF_I UPA_13 plot 4 2022\n82.50755\n83.49894\n0.9913893\n1.20\n\n\nUMF_I UPA_13 plot 4 2020\n80.37445\n81.33181\n0.9573547\n1.19\n\n\nUMF_I UPA_4 plot 1 2012\n96.85337\n98.00653\n1.1531593\n1.19\n\n\nUMF_I UPA_10 plot 3 2023\n53.80592\n54.44106\n0.6351407\n1.18\n\n\nUMF_I UPA_6 plot 2 2020\n43.71303\n44.20093\n0.4879055\n1.12\n\n\nUMF_I UPA_10 plot 2 2023\n63.50069\n62.79932\n0.7013696\n1.10\n\n\nUMF_I UPA_6 plot 3 2016\n68.01510\n68.74598\n0.7308836\n1.07\n\n\nUMF_I UPA_3 plot 5 2012\n46.09271\n45.59783\n0.4948804\n1.07\n\n\nUMF_I UPA_3 plot 2 2013\n90.47815\n89.51823\n0.9599262\n1.06\n\n\nUMF_I UPA_5 plot 4 2013\n68.88582\n69.60691\n0.7210914\n1.05\n\n\nUMF_I UPA_3 plot 2 2012\n86.64463\n85.74108\n0.9035441\n1.04\n\n\nUMF_I UPA_5 plot 4 2015\n70.69376\n71.42920\n0.7354401\n1.04\n\n\nUMF_I UPA_1 plot 10 2010\n78.02907\n78.83287\n0.8038040\n1.03\n\n\nUMF_I UPA_3 plot 5 2013\n48.58948\n48.10361\n0.4858700\n1.00\n\n\nUMF_I UPA_7 plot 1 2020\n44.15510\n44.58483\n0.4297336\n0.97\n\n\nUMF_I UPA_7 plot 1 2019\n43.97294\n44.39937\n0.4264318\n0.97\n\n\nUMF_I UPA_6 plot 10 2016\n42.77583\n43.18735\n0.4115190\n0.96\n\n\nUMF_I UPA_7 plot 7 2019\n71.38729\n70.71808\n0.6692170\n0.94\n\n\nUMF_I UPA_10 plot 5 2023\n39.22463\n38.85817\n0.3664532\n0.93\n\n\nUMF_I UPA_6 plot 10 2014\n38.23924\n38.59431\n0.3550766\n0.93\n\n\nUMF_I UPA_7 plot 7 2020\n71.77288\n71.10683\n0.6660560\n0.93\n\n\nUMF_I UPA_6 plot 8 2020\n64.27557\n64.86683\n0.5912558\n0.92\n\n\nUMF_IV UPA_15 plot 1 2020\n85.66747\n84.89497\n0.7725050\n0.90\n\n\nUMF_I UPA_4 plot 4 2023\n63.04084\n63.60904\n0.5682029\n0.90\n\n\nUMF_I UPA_2 plot 4 2021\n77.42662\n76.74579\n0.6808313\n0.88\n\n\nUMF_I UPA_6 plot 3 2014\n66.90394\n67.49047\n0.5865315\n0.88\n\n\nUMF_IV UPA_15 plot 1 2022\n87.35465\n86.59366\n0.7609898\n0.87\n\n\nUMF_I UPA_3 plot 3 2013\n84.61047\n83.87583\n0.7346432\n0.87\n\n\nUMF_I UPA_1 plot 6 2021\n64.89678\n65.45626\n0.5594741\n0.86\n\n\nUMF_I UPA_1 plot 5 2021\n52.16414\n51.71444\n0.4496935\n0.86\n\n\nUMF_I UPA_3 plot 5 2017\n50.05510\n49.62707\n0.4280239\n0.86\n\n\nUMF_I UPA_3 plot 3 2012\n81.53275\n80.83752\n0.6952286\n0.85\n\n\nUMF_I UPA_3 plot 5 2023\n51.86898\n51.42948\n0.4395053\n0.85\n\n\nUMF_I UPA_7 plot 8 2020\n89.54130\n90.29225\n0.7509533\n0.84\n\n\nUMF_I UPA_7 plot 8 2019\n89.34384\n90.09226\n0.7484156\n0.84\n\n\nUMF_I UPA_3 plot 3 2017\n82.47439\n81.78563\n0.6887610\n0.84\n\n\nUMF_I UPA_3 plot 3 2023\n87.47240\n86.75832\n0.7140807\n0.82\n\n\nUMF_I UPA_8 plot 7 2019\n58.83860\n59.30061\n0.4620051\n0.79\n\n\nUMF_I UPA_9 plot 7 2019\n58.83860\n59.30061\n0.4620051\n0.79\n\n\nUMF_I UPA_5 plot 6 2013\n65.40087\n64.90076\n0.5001170\n0.76\n\n\nUMF_I UPA_6 plot 2 2014\n42.16957\n41.85613\n0.3134444\n0.74\n\n\nUMF_I UPA_6 plot 5 2014\n74.23097\n73.68984\n0.5411267\n0.73\n\n\nUMF_I UPA_5 plot 6 2015\n67.84900\n67.36446\n0.4845461\n0.71\n\n\nUMF_I UPA_1 plot 5 2018\n49.43925\n49.08748\n0.3517625\n0.71\n\n\nUMF_I UPA_5 plot 5 2019\n45.13145\n45.45032\n0.3188698\n0.71\n\n\nUMF_I UPA_13 plot 7 2022\n79.77982\n80.33656\n0.5567359\n0.70\n\n\nUMF_I UPA_13 plot 7 2020\n77.39105\n77.91421\n0.5231639\n0.68\n\n\nUMF_I UPA_5 plot 6 2019\n67.57095\n67.12176\n0.4491889\n0.66\n\n\nUMF_I UPA_6 plot 5 2016\n73.14978\n72.66495\n0.4848302\n0.66\n\n\nUMF_I UPA_10 plot 1 2023\n84.99371\n85.53011\n0.5363965\n0.63\n\n\nUMF_I UPA_1 plot 7 2010\n48.37900\n48.68136\n0.3023567\n0.62\n\n\nUMF_I UPA_4 plot 10 2023\n116.53078\n115.80563\n0.7251568\n0.62\n\n\nUMF_I UPA_8 plot 7 2017\n55.68702\n56.03201\n0.3449874\n0.62\n\n\nUMF_I UPA_9 plot 7 2017\n55.68702\n56.03201\n0.3449874\n0.62\n\n\nUMF_I UPA_4 plot 2 2018\n54.00996\n54.34087\n0.3309095\n0.61\n\n\nUMF_I UPA_6 plot 2 2016\n44.53567\n44.26407\n0.2715974\n0.61\n\n\nUMF_I UPA_4 plot 10 2012\n112.79100\n112.10639\n0.6846067\n0.61\n\n\nUMF_I UPA_1 plot 10 2013\n85.05974\n85.56967\n0.5099252\n0.60\n\n\nUMF_I UPA_6 plot 5 2020\n83.75145\n83.27018\n0.4812609\n0.57\n\n\nUMF_I UPA_2 plot 9 2016\n95.03303\n94.53889\n0.4941441\n0.52\n\n\nUMF_I UPA_4 plot 10 2014\n116.95538\n116.35725\n0.5981315\n0.51\n\n\nUMF_I UPA_8 plot 2 2019\n56.53209\n56.81470\n0.2826127\n0.50\n\n\nUMF_I UPA_9 plot 2 2019\n56.53209\n56.81470\n0.2826127\n0.50\n\n\nUMF_I UPA_2 plot 4 2016\n63.55154\n63.23934\n0.3121983\n0.49\n\n\nUMF_I UPA_3 plot 9 2023\n78.08600\n77.71997\n0.3660287\n0.47\n\n\nUMF_I UPA_2 plot 9 2021\n112.67888\n112.15249\n0.5263914\n0.47\n\n\nUMF_I UPA_1 plot 10 2016\n93.31957\n93.75176\n0.4321846\n0.46\n\n\nUMF_I UPA_6 plot 10 2020\n49.06983\n49.29309\n0.2232562\n0.45\n\n\nUMF_I UPA_2 plot 5 2021\n104.99960\n104.53147\n0.4681390\n0.45\n\n\nUMF_I UPA_3 plot 10 2013\n71.59298\n71.27629\n0.3166953\n0.44\n\n\nUMF_I UPA_10 plot 1 2017\n91.30645\n91.70979\n0.4033415\n0.44\n\n\nUMF_I UPA_4 plot 2 2012\n108.80715\n108.32791\n0.4792397\n0.44\n\n\nUMF_I UPA_4 plot 10 2018\n110.48908\n110.00539\n0.4836951\n0.44\n\n\nUMF_I UPA_3 plot 9 2012\n81.29350\n81.64255\n0.3490532\n0.43\n\n\nUMF_I UPA_1 plot 10 2018\n94.52630\n94.93131\n0.4050089\n0.43\n\n\nUMF_I UPA_8 plot 2 2017\n53.73655\n53.96239\n0.2258434\n0.42\n\n\nUMF_I UPA_9 plot 2 2017\n53.73655\n53.96239\n0.2258434\n0.42\n\n\nUMF_I UPA_3 plot 9 2017\n82.17611\n82.51290\n0.3367915\n0.41\n\n\nUMF_I UPA_3 plot 10 2012\n68.93371\n68.65249\n0.2812111\n0.41\n\n\nUMF_I UPA_10 plot 1 2015\n88.26045\n88.61520\n0.3547438\n0.40\n\n\nUMF_I UPA_2 plot 5 2016\n92.29810\n91.94119\n0.3569125\n0.39\n\n\nUMF_I UPA_10 plot 6 2017\n75.02884\n74.74635\n0.2824919\n0.38\n\n\nUMF_I UPA_3 plot 9 2013\n83.69625\n84.00952\n0.3132760\n0.37\n\n\nUMF_I UPA_10 plot 6 2015\n72.87267\n72.60231\n0.2703594\n0.37\n\n\nUMF_I UPA_1 plot 1 2016\n68.44220\n68.69547\n0.2532788\n0.37\n\n\nUMF_I UPA_4 plot 2 2014\n111.15618\n110.77485\n0.3813256\n0.34\n\n\nUMF_I UPA_2 plot 5 2013\n82.59449\n82.32679\n0.2677017\n0.32\n\n\nUMF_I UPA_4 plot 1 2023\n99.61186\n99.91806\n0.3062021\n0.31\n\n\nUMF_I UPA_2 plot 9 2013\n84.28983\n84.03138\n0.2584545\n0.31\n\n\nUMF_I UPA_4 plot 2 2023\n55.26882\n55.43507\n0.1662474\n0.30\n\n\nUMF_I UPA_8 plot 8 2019\n62.52768\n62.69680\n0.1691232\n0.27\n\n\nUMF_I UPA_9 plot 8 2019\n62.52768\n62.69680\n0.1691232\n0.27\n\n\nUMF_I UPA_1 plot 1 2018\n71.14094\n71.33313\n0.1921936\n0.27\n\n\nUMF_I UPA_10 plot 2 2015\n53.74205\n53.88480\n0.1427504\n0.27\n\n\nUMF_I UPA_3 plot 10 2023\n71.49882\n71.68077\n0.1819545\n0.25\n\n\nUMF_I UPA_1 plot 7 2018\n58.71161\n58.56780\n0.1438099\n0.24\n\n\nUMF_I UPA_6 plot 6 2020\n49.78098\n49.90245\n0.1214775\n0.24\n\n\nUMF_I UPA_8 plot 8 2017\n60.54031\n60.67592\n0.1356164\n0.22\n\n\nUMF_I UPA_9 plot 8 2017\n60.54031\n60.67592\n0.1356164\n0.22\n\n\nUMF_I UPA_1 plot 7 2016\n57.77350\n57.65079\n0.1227096\n0.21\n\n\nUMF_I UPA_2 plot 9 2011\n74.85400\n74.71161\n0.1423887\n0.19\n\n\nUMF_I UPA_5 plot 2 2019\n94.52580\n94.35240\n0.1734021\n0.18\n\n\nUMF_I UPA_5 plot 2 2013\n89.07632\n88.91380\n0.1625188\n0.18\n\n\nUMF_I UPA_6 plot 6 2016\n78.62709\n78.75516\n0.1280660\n0.16\n\n\nUMF_I UPA_5 plot 2 2015\n90.92365\n90.77653\n0.1471140\n0.16\n\n\nUMF_I UPA_2 plot 10 2016\n83.98366\n83.85487\n0.1287838\n0.15\n\n\nUMF_I UPA_2 plot 10 2013\n77.00184\n76.89262\n0.1092198\n0.14\n\n\nUMF_I UPA_1 plot 5 2016\n47.68992\n47.75724\n0.0673127\n0.14\n\n\nUMF_I UPA_1 plot 1 2021\n76.89511\n77.00218\n0.1070777\n0.14\n\n\nUMF_I UPA_1 plot 7 2021\n61.43515\n61.35126\n0.0838844\n0.14\n\n\nUMF_I UPA_2 plot 5 2011\n72.96436\n72.87122\n0.0931383\n0.13\n\n\nUMF_I UPA_10 plot 2 2017\n56.43735\n56.50327\n0.0659212\n0.12\n\n\nUMF_I UPA_1 plot 8 2013\n69.36293\n69.28518\n0.0777496\n0.11\n\n\nUMF_I UPA_2 plot 10 2021\n97.49249\n97.38766\n0.1048290\n0.11\n\n\nUMF_I UPA_2 plot 10 2011\n68.19918\n68.13211\n0.0670619\n0.10\n\n\nUMF_I UPA_4 plot 1 2018\n94.11279\n94.20081\n0.0880225\n0.09\n\n\nUMF_I UPA_6 plot 6 2014\n77.67906\n77.74176\n0.0627007\n0.08\n\n\nUMF_I UPA_1 plot 10 2021\n99.37983\n99.45315\n0.0733164\n0.07\n\n\nUMF_I UPA_1 plot 7 2013\n55.56796\n55.52756\n0.0404060\n0.07\n\n\nUMF_I UPA_7 plot 5 2020\n52.46662\n52.49355\n0.0269255\n0.05\n\n\nUMF_I UPA_10 plot 6 2023\n71.15509\n71.17819\n0.0230965\n0.03\n\n\nUMF_I UPA_1 plot 8 2010\n62.20382\n62.18935\n0.0144732\n0.02\n\n\nUMF_I UPA_7 plot 5 2019\n52.01084\n52.01619\n0.0053426\n0.01\n\n\nUMF_I UPA_3 plot 10 2017\n67.96002\n67.96002\n0.0000056\n0.00\n\n\n\n\n\n\nCode\ntext &lt;- max(dif_AGBs$diff_perc)\n\n\n\n\n\n\n\n\nTipInsight\n\n\n\nWe can see as much as 8.08 % difference in biomass estimation due to the different wood density databases.\n\n\n\n\n\n\nChave, Jerome, David Coomes, Steven Jansen, Simon L. Lewis, Nathan G. Swenson, and Amy E. Zanne. 2009. “Towards a Worldwide Wood Economics Spectrum.” Ecology Letters 12: 351–66. https://doi.org/10.1111/j.1461-0248.2009.01285.x.",
    "crumbs": [
      "Data Exploration",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Comparing wood density databases</span>"
    ]
  },
  {
    "objectID": "31_tree_height_from_lidar.html#lecture",
    "href": "31_tree_height_from_lidar.html#lecture",
    "title": "6  Workflow to extract tree height from Lidar CHM",
    "section": "6.2 Lecture",
    "text": "6.2 Lecture\n\nCHM generation: Fischer et al. (2024).",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "31_tree_height_from_lidar.html#setup",
    "href": "31_tree_height_from_lidar.html#setup",
    "title": "6  Workflow to extract tree height from Lidar CHM",
    "section": "6.3 Setup",
    "text": "6.3 Setup\nYou need terra package to handle spatial data and dplyr to manipulate tabular data.\n\n\nCode\nlibrary(terra)\nlibrary(dplyr)",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "31_tree_height_from_lidar.html#data",
    "href": "31_tree_height_from_lidar.html#data",
    "title": "6  Workflow to extract tree height from Lidar CHM",
    "section": "6.6 Data",
    "text": "6.6 Data\nThe CHMs were generated by Fabian Fischer from Brazilian Forest Concessions Lidar data, using the method described in Fischer et al. (2024).\nCommercial inventories were obtained from Brazilian Forest Concessions.",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "31_tree_height_from_lidar.html#running-code",
    "href": "31_tree_height_from_lidar.html#running-code",
    "title": "6  Workflow to extract tree height from Lidar CHM",
    "section": "6.7 Running Code",
    "text": "6.7 Running Code",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "32_tree_height_from_lidar_all_apus.html#lecture",
    "href": "32_tree_height_from_lidar_all_apus.html#lecture",
    "title": "7  Workflow to extract tree height from Lidar CHM",
    "section": "7.2 Lecture",
    "text": "7.2 Lecture\n\nCHM generation: Fischer et al. (2024).",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "32_tree_height_from_lidar_all_apus.html#setup",
    "href": "32_tree_height_from_lidar_all_apus.html#setup",
    "title": "7  Workflow to extract tree height from Lidar CHM",
    "section": "7.3 Setup",
    "text": "7.3 Setup\nYou need terra package to handle spatial data and dplyr to manipulate tabular data.\n\n\nCode\nlibrary(terra)\nlibrary(dplyr)\nlibrary(ggplot2)",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "32_tree_height_from_lidar_all_apus.html#data",
    "href": "32_tree_height_from_lidar_all_apus.html#data",
    "title": "7  Workflow to extract tree height from Lidar CHM",
    "section": "7.5 Data",
    "text": "7.5 Data\nThe CHMs were generated by Fabian Fischer from Brazilian Forest Concessions Lidar data, using the method described in Fischer et al. (2024).\nCommercial inventories were obtained from Brazilian Forest Concessions.",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "32_tree_height_from_lidar_all_apus.html#running-code",
    "href": "32_tree_height_from_lidar_all_apus.html#running-code",
    "title": "7  Workflow to extract tree height from Lidar CHM",
    "section": "7.6 Running Code",
    "text": "7.6 Running Code",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Workflow to extract tree height from Lidar CHM</span>"
    ]
  },
  {
    "objectID": "33_estimate_biomass.html#lecture",
    "href": "33_estimate_biomass.html#lecture",
    "title": "8  Estimate biomass with different total height estimations",
    "section": "8.2 Lecture",
    "text": "8.2 Lecture\n\nCHM generation: Fischer et al. (2024).\nBIOMASS package: Réjou-Méchain et al. (2017).\nChave’s allometric equation: Chave et al. (2014).\nNogueira’s allometric equation: Nogueira et al. (2008).\nMelo’s allometric equation: Melo et al. (2024).",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Estimate biomass with different total height estimations</span>"
    ]
  },
  {
    "objectID": "33_estimate_biomass.html#setup",
    "href": "33_estimate_biomass.html#setup",
    "title": "8  Estimate biomass with different total height estimations",
    "section": "8.3 Setup",
    "text": "8.3 Setup\nYou need BIOMASS package to estimate the biomass, dplyr and tidyr to manipulate tabular data and ggplot to visualization.\n\n\nCode\nlibrary(BIOMASS) \nlibrary(dplyr) \nlibrary(tidyr) \nlibrary(ggplot2)",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Estimate biomass with different total height estimations</span>"
    ]
  },
  {
    "objectID": "33_estimate_biomass.html#allometric-equations-parameters",
    "href": "33_estimate_biomass.html#allometric-equations-parameters",
    "title": "8  Estimate biomass with different total height estimations",
    "section": "8.4 Allometric equations parameters",
    "text": "8.4 Allometric equations parameters\nSome parameters used to build the allometric equations used in this workflow. It is important to see if the allometric equation is suitable for the data.\n\n\nCode\nallo_equations &lt;- openxlsx::read.xlsx(\"data/allometric_eq/Equações alométricas.xlsx\",\n                                     rows = c(1, 3, 8, 20, 22),\n                                     cols = 1:7)\n\nallo_equations %&gt;%\n   kableExtra::kbl(caption = \"Allometric equations parameters\") %&gt;%\n   kableExtra::kable_classic(full_width = FALSE)\n\n\n\nAllometric equations parameters\n\n\nStudy\nRegion\nPhytophysiognomy\nNumber.of.measured.trees\nMinimum.DBH\nMaximum.DBH\nAGB.equation\n\n\n\n\nNogueira et al., 2008\nSouthern amazonia\nFOA\n300\n5\n124\nln(Dry weight)=-1.716 (±0.079) + 2.413 (±0.029) × ln(Diameter)\n\n\nMelo et al., 2024\nFloresta Estadual do Antimary\nFOA com palmeiras\n190\n5\n90\nDMtw = 0,064 * DBH2,671 + 3,69\n\n\nChave et al., 2014\nPantropical\n53 undisturbed and 5 secondary\n4004\n5\n212\nAGBest = 0,0673 x (q * D2 * H)0,976\n\n\nChave et al., 2014 without height, modified by Réjou-Méchain et al., 2017\n_\n_\n_\n_\n_\nAGB = exp(-2,024 - 0,896 * E + 0,920 * ln(WD) + 2,795 * ln(DAP) - 0,0461 * [ln(DAP)2])",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Estimate biomass with different total height estimations</span>"
    ]
  },
  {
    "objectID": "33_estimate_biomass.html#retrieving-height-from-biomass",
    "href": "33_estimate_biomass.html#retrieving-height-from-biomass",
    "title": "8  Estimate biomass with different total height estimations",
    "section": "8.6 Retrieving height from BIOMASS",
    "text": "8.6 Retrieving height from BIOMASS\nretriveH function in `BIOMASS package estimates tree total height using allometric equation from Feldpausch et al. (2011), based on the location of the trees. It uses a Weibull function to estimate height from the diameter of the tree, based on a large number of plots.\nThe coordinates in this script refer to Jamari National Forest.\n\n\nCode\naltura_feld &lt;- retrieveH(D = if100$DAP,\n                         coord = c(-62.99,\n                                   -9.11\n                                   ))\n\nif100$altura_feld &lt;- altura_feld$H\n\n\nSee relation between height from retrieveH and obtained with Lidar.\n\n\nCode\nggplot(if100, \n       aes(x = z_lidar, \n           y = altura_feld)) +\n  geom_point(alpha = 0.7, \n             aes(color = nome_florabr)\n             ) +\n  geom_smooth(method = \"lm\", \n              se = FALSE, \n              color = \"black\",\n              formula = 'y ~ 0 + x') +\n  theme_minimal() +\n  labs(\n    title = \"Lidar height x Feldpausch height\",\n    x = \"Lidar height (m)\",\n    y = \"Feldpausch height (m)\"\n#    ,color = \"Species\"\n  ) +\n  theme(\n    plot.title = element_text(hjust = 0.5, \n                              size = 14, \n                              face = \"bold\")\n    ,legend.position=\"none\"\n #   ,legend.title = element_text(face = \"bold\")\n  ) +\n  geom_abline() +\n  ggpubr::stat_regline_equation(formula = 'y ~ 0 + x')",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Estimate biomass with different total height estimations</span>"
    ]
  },
  {
    "objectID": "33_estimate_biomass.html#retrieving-wood-density",
    "href": "33_estimate_biomass.html#retrieving-wood-density",
    "title": "8  Estimate biomass with different total height estimations",
    "section": "8.7 Retrieving wood density",
    "text": "8.7 Retrieving wood density\nThen we correct scientific names in the table. For this we will use correctTaxo from BIOMASS. This function needs a “genus” and a “species” column.\n\n\nCode\n# \nif100 &lt;- if100 %&gt;% \n              separate(nome_florabr,\n                      into = c(\"genus\",\n                               \"epithet\"),\n                      sep = \" \",\n                      extra = \"merge\",\n                      remove = F)\n\n#taxo &lt;- correctTaxo(genus=if100$genus,\n#                    species=if100$epithet,\n#                    useCache = T)\n\nw_density &lt;- getWoodDensity(genus = if100$genus,\n                            species = if100$epithet)",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Estimate biomass with different total height estimations</span>"
    ]
  },
  {
    "objectID": "33_estimate_biomass.html#estimating-biomass",
    "href": "33_estimate_biomass.html#estimating-biomass",
    "title": "8  Estimate biomass with different total height estimations",
    "section": "8.8 Estimating biomass",
    "text": "8.8 Estimating biomass\n\n8.8.1 Estimating biomass with total height\nWe estimated only some of the commercial species tree height using Lidar. We will remove all trees without Lidar estimated height, so we can compare AGB estimates. We need a new taxo for the reduced data frame.\n\n\nCode\nif100.red &lt;- if100[!is.na(if100$z_lidar), ]\n\n#taxo.red &lt;- correctTaxo(genus=if100.red$genus,\n#                        species=if100.red$epithet,\n#                        useCache = F)\n\n\nThen we get the wood density of each species.\n\n\nCode\nw_density.red &lt;- getWoodDensity(genus = if100.red$genus,\n                                species = if100.red$epithet)\n\n\nCompute AGB with Chave et al. (2014) equation and Feldpausch et al. (2011) height.\n\n\nCode\nif100.red$AGB_chave_feld &lt;- computeAGB(D = if100.red$DAP,\n                                       WD = w_density.red$meanWD,\n                                       H = if100.red$altura_feld)\n# AGB = 0.0673 * (WD * H * D^2)^0.976\n\n\nCompute AGB with Chave et al. (2014) equation and Lidar height.\n\n\nCode\nif100.red$AGB_chave_lidar &lt;- computeAGB(D = if100.red$DAP,\n                                        WD = w_density.red$meanWD,\n                                        H = if100.red$z_lidar)\n# AGB = 0.0673 * (WD * H * D^2)^0.976\n\n\nNow let’s compare the different AGB estimates.\n\n\nCode\nggplot(if100.red, \n       aes(x = AGB_chave_feld, \n           y = AGB_chave_lidar)) +\n  geom_point(alpha = 0.7, \n             aes(color = nome_florabr)) +\n  geom_smooth(method = \"lm\", \n              se = FALSE, \n              color = \"black\",\n              formula = 'y ~ 0 + x') +\n  theme_minimal() +\n  labs(\n    title = \"AGB with Feldpausch height x AGB with Lidar height\",\n    x = \"Feldpausch AGB (Mg)\",\n    y = \"Lidar AGB (Mg)\",\n    color = \"Species\"\n  ) +\n  theme(\n    plot.title = element_text(hjust = 0.5, \n                              size = 14, \n                              face = \"bold\"),\n    legend.title = element_text(face = \"bold\")\n    ,legend.position=\"none\"\n  ) +\n  ggpubr::stat_regline_equation(formula = 'y ~ 0 + x')\n\n\n\n\n\n\n\n\n\nIs the difference between the biomass estimates different across the DBHs? Comparing AGB estimates with different heights estimates across DBHs.\n\n\nCode\nif100.red$diff_agbs_h &lt;- if100.red$AGB_chave_feld - if100.red$AGB_chave_lidar\n\nggplot(if100.red, \n       aes(x = DAP, \n           y = diff_agbs_h)) +\n  geom_point(alpha = 0.5, \n             aes(color = nome_florabr)) +\n  geom_hline(yintercept = 0, \n             linetype = \"dashed\") +\n  theme_minimal() +\n  theme(,legend.position=\"none\")+\n  labs(x = \"DAP\", y = \"Difference (AGB with H by Feldpausch − AGB with H by Lidar)\",\n       title = \"AGB estimations difference by DBH\")\n\n\n\n\n\n\n\n\n\n\n\n8.8.2 Estimating biomass using only DBH\nWe will use Chave et al. (2014), Nogueira et al. (2008) e Melo et al. (2024) equations to estimate AGB using only DBH.\nIt is important to point out that Nogueira et al. (2008) and Melo et al. (2024) uses only DBH, whereas Chave et al. (2014) uses, in addition to DBH, wood density and a variable representing environmental stress (see Réjou-Méchain et al. (2017) for the minor modification in Chave et al. (2014) equation used in BIOMASS).\n\n\nCode\nif100$AGB_chave_dbh &lt;- computeAGB(D = if100$DAP,\n                                  WD = w_density$meanWD,\n                                  coord = c(-62.99,\n                                            -9.11))\n# AGB =  exp(-2,024 - 0,896 * E + 0,920 * ln(WD) + 2,795 * ln(DAP) - 0,0461 * [ln(DAP)^2])\n\nif100$AGB_nog_dbh &lt;- (exp(-1.716 + 2.413 * log(if100$DAP))) / 1000\n# We have to divide results by 1000 because equation gives AGB in kg\n\nif100$AGB_melo_dbh &lt;- (0.064 * (if100$DAP^2.671) + 3.69) / 1000\n# We have to divide results by 1000 because equation gives AGB in kg\n\n\nTo plot the three equations results in the same graph, we must convert data to LONG format.\n\n\nCode\ndf_long &lt;- if100 |&gt;\n  pivot_longer(\n    cols = c(AGB_chave_dbh, AGB_nog_dbh, AGB_melo_dbh),\n    names_to = \"equation\",\n    values_to = \"biomass\"\n  )\n\n\nNow let’s plot them.\n\n\nCode\nggplot(df_long, \n       aes(x = DAP, \n           y = biomass, \n           color = equation)) +\n  geom_point(alpha = 0.3) +            # pontos opcionais\n  geom_smooth(method = \"lm\",\n              se = FALSE, \n              linewidth = 1.2,\n              formula = 'y ~ 0 + x') + # linhas das equações\n  theme_minimal() +\n  labs(\n    title = \"Biomass–DBH Relationships Derived from Multiple Allometric Models\",\n    x = \"DBH (cm)\",\n    y = \"Biomass (Mg)\",\n    color = \"Equation\"\n  )\n\n\n\n\n\n\n\n\n\nNow let’s compare the different AGB estimates.\n\n\nCode\nggplot(if100, \n       aes(x = AGB_chave_dbh, \n           y = AGB_nog_dbh)) +\n  geom_point(alpha = 0.7, \n             aes(color = nome_florabr)) +\n  geom_smooth(method = \"lm\", \n              se = FALSE, \n              color = \"black\",\n              formula = 'y ~ 0 + x') +\n  theme_minimal() +\n  labs(\n    title = \"AGB Chave eq. (DBH) x AGB Nogueira eq. (DBH)\",\n    x = \"Chave eq AGB (Mg)\",\n    y = \"Nogueira eq AGB (Mg)\",\n    color = \"Species\"\n  ) +\n  theme(\n    plot.title = element_text(hjust = 0.5, \n                              size = 14, \n                              face = \"bold\"),\n    legend.title = element_text(face = \"bold\")\n    ,legend.position=\"none\"\n  ) +\n  ggpubr::stat_regline_equation(formula = 'y ~ 0 + x')\n\n\n\n\n\n\n\n\n\nIs the difference between the biomass estimates different across the DBHs? Comparing Chave et al. (2014) x Nogueira et al. (2008) equations estimates across DBHs.\n\n\nCode\nif100$diff_agbs &lt;- if100$AGB_chave_dbh - if100$AGB_nog_dbh\n\nggplot(if100, \n       aes(x = DAP, \n           y = diff_agbs)) +\n  geom_point(alpha = 0.5, \n             aes(color = nome_florabr)) +\n  geom_hline(yintercept = 0, \n             linetype = \"dashed\") +\n  theme_minimal() +\n  theme(legend.position=\"none\")+\n  labs(x = \"DAP\", y = \"Difference (Chave − Nogueira)\",\n       title = \"AGB estimations difference by DBH\")",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Estimate biomass with different total height estimations</span>"
    ]
  },
  {
    "objectID": "34_modelling_H.html#model",
    "href": "34_modelling_H.html#model",
    "title": "9  Modelling DBH x Height",
    "section": "9.5 Model",
    "text": "9.5 Model\nWe model tree height \\(h\\) in function of tree diameter \\(d\\) as:\n\\[\nh \\sim logN( \\frac{h_{max}\\times d}{a + d} , \\sigma)\n\\]\nwith \\(h_{max}\\) the maximum tree height and \\(a\\).",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Modelling DBH x Height</span>"
    ]
  },
  {
    "objectID": "34_modelling_H.html#example-with-cmdstanr",
    "href": "34_modelling_H.html#example-with-cmdstanr",
    "title": "9  Modelling DBH x Height",
    "section": "9.6 Example with cmdstanr",
    "text": "9.6 Example with cmdstanr\n\n\nCode\nmdata &lt;- list(\n  N = nrow(jam_for_inv),\n  h = jam_for_inv$total_height,\n  d = jam_for_inv$dbh\n)\nmodel &lt;- cmdstan_model(\"gustavo.stan\")\nmodel\n\n\ndata {\n  int&lt;lower=0&gt; N;\n  vector[N] h;\n  vector[N] d;\n}\nparameters {\n  real&lt;lower=1, upper=100&gt; hmax;\n  real&lt;lower=0&gt; a;\n  real&lt;lower=0&gt; sigma;\n}\nmodel {\n  log(h) ~ normal(log(hmax*d ./ (a+d)), sigma);\n}\n\n\n\n\nCode\nfit &lt;- model$sample(data = mdata, parallel_chains = 4,\n                    show_messages = FALSE, show_exceptions = FALSE)\nfit\n\n\n variable   mean median   sd  mad     q5    q95 rhat ess_bulk ess_tail\n    lp__  880.18 880.48 1.27 1.01 877.63 881.56 1.00     1328     1702\n    hmax   41.81  41.75 1.52 1.52  39.46  44.39 1.01     1309     1398\n    a      26.25  26.23 1.63 1.65  23.70  29.00 1.00     1326     1390\n    sigma   0.37   0.37 0.01 0.01   0.36   0.38 1.00     1957     1654\n\n\n\n\nCode\nfit$draws(c(\"hmax\", \"a\")) %&gt;%\n  mcmc_hist()\n\n\n`stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n\n\n\n\n\n\n\n\n\n\n\nCode\nggplot(jam_for_inv, aes(dbh, total_height)) +\n  geom_point(col = \"lightgrey\") +\n  stat_function(fun = function(x) 54.50*x/(33.90+x)) +\n  theme_bw() +\n  xlab(\"diameter (cm)\") + ylab(\"height (m)\") +\n  ggtitle(paste(nrow(jam_for_inv), \"individuals\"),\n          paste(unique(jam_for_inv$scientific_name) %&gt;% length(),\n                \"species\"))",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Modelling DBH x Height</span>"
    ]
  },
  {
    "objectID": "34_modelling_H.html#example-with-brms",
    "href": "34_modelling_H.html#example-with-brms",
    "title": "9  Modelling DBH x Height",
    "section": "9.7 Example with brms",
    "text": "9.7 Example with brms\n\n\nCode\nfit &lt;- brm(bf(log(h) ~ log(hmax * d/ (a + d)),\n              hmax ~ 1, a ~ 1,\n              nl = TRUE),\n           prior = c(\n             prior(uniform(0, 100), lb = 10, nlpar = \"hmax\"),\n             prior(uniform(0, 100), lb = 0, nlpar = \"a\")\n             ),\n           data = mdata, chains = 4, cores = 4)\nfit\n\n\n\n\n\n\ndos-Santos, M. N., M. M. Keller, E. R. Pinage, and D. C. Morton. 2022. “Forest Inventory and Biophysical Measurements, Brazilian Amazon, 2009-2018.” https://doi.org/10.3334/ORNLDAAC/2007.\n\n\nJucker, Tommaso, Fabian Jörg Fischer, Jérôme Chave, David A. Coomes, John Caspersen, Arshad Ali, Grace Jopaul Loubota Panzou, et al. 2022. “Tallo: A Global Tree Allometry and Crown Architecture Database.” Global Change Biology 28 (September): 5254–68. https://doi.org/10.1111/gcb.16302.\n\n\nMolto, Q., B. Hérault, J. J. Boreux, M. Daullet, A. Rousteau, and V. Rossi. 2014. “Predicting Tree Heights for Biomass Estimates in Tropical Forests -a Test from French Guiana.” Biogeosciences 11 (June): 3121–30. https://doi.org/10.5194/bg-11-3121-2014.",
    "crumbs": [
      "Data Analisys",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Modelling DBH x Height</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html#check-data-consistency",
    "href": "12_harmonizing_pps_data.html#check-data-consistency",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "2.5 Check data consistency",
    "text": "2.5 Check data consistency\n\n2.5.1 Consistency of diameter measurements\n\n\n2.5.2 Missing (NA) and zeros DBH values\nWe have no zeros or NA values in our DBH records.\n\n\nCode\npps %&gt;%\n  group_by(UMF,UPA) %&gt;%\n  summarise(\n    `Zeros in diametrocm` = sum(diametrocm == 0, \n                                na.rm = TRUE),\n    `NA in diametrocm` = sum(is.na(diametrocm)),\n    `Total records` = n(),\n    .groups = \"drop\"\n  ) %&gt;%\n  kbl(\n    caption = \"Number of zero and NA values in diameter (cm) by UMF and UPA\"\n  ) %&gt;%\n  kable_classic(full_width = FALSE)\n\n\n\nNumber of zero and NA values in diameter (cm) by UMF and UPA\n\n\nUMF\nUPA\nZeros in diametrocm\nNA in diametrocm\nTotal records\n\n\n\n\nUMF_I\nUPA_1\n0\n0\n5708\n\n\nUMF_I\nUPA_10\n0\n0\n2894\n\n\nUMF_I\nUPA_13\n0\n0\n2194\n\n\nUMF_I\nUPA_2\n0\n0\n5400\n\n\nUMF_I\nUPA_3\n0\n0\n5327\n\n\nUMF_I\nUPA_4\n0\n0\n5738\n\n\nUMF_I\nUPA_5\n0\n0\n3680\n\n\nUMF_I\nUPA_6\n0\n0\n3680\n\n\nUMF_I\nUPA_7\n0\n0\n1884\n\n\nUMF_I\nUPA_8\n0\n0\n1845\n\n\nUMF_I\nUPA_9\n0\n0\n1845\n\n\nUMF_IV\nUPA_15\n0\n0\n895\n\n\n\n\n\n\n\n2.5.3 Check DBH cutoff\nWe have no diameter records below 10 cm.\n\n\nCode\npps %&gt;%\n  group_by(UMF,\n           UPA) %&gt;%\n  summarise(\n    `DBH below 10 cm` = sum(diametrocm &lt; 10, \n                            na.rm = TRUE),\n    `Total records`      = n(),\n    .groups = \"drop\"\n  ) %&gt;%\n  kbl(\n    caption = \"Number of diameter values below 10 cm by APU\"\n  ) %&gt;%\n  kable_classic(full_width = FALSE)\n\n\n\nNumber of diameter values below 10 cm by APU\n\n\nUMF\nUPA\nDBH below 10 cm\nTotal records\n\n\n\n\nUMF_I\nUPA_1\n0\n5708\n\n\nUMF_I\nUPA_10\n0\n2894\n\n\nUMF_I\nUPA_13\n0\n2194\n\n\nUMF_I\nUPA_2\n0\n5400\n\n\nUMF_I\nUPA_3\n0\n5327\n\n\nUMF_I\nUPA_4\n0\n5738\n\n\nUMF_I\nUPA_5\n0\n3680\n\n\nUMF_I\nUPA_6\n0\n3680\n\n\nUMF_I\nUPA_7\n0\n1884\n\n\nUMF_I\nUPA_8\n0\n1845\n\n\nUMF_I\nUPA_9\n0\n1845\n\n\nUMF_IV\nUPA_15\n0\n895\n\n\n\n\n\n\n\n2.5.4 Avoid duplicated measurements\nThrere are no duplicated records in this dataset.\n\n\nCode\npps %&gt;%\n  group_by(across(-cod_indiv)) %&gt;%\n  summarise(\n    n_ids = n_distinct(cod_indiv),\n    ids   = paste(unique(cod_indiv), \n                  collapse = \", \"),\n    .groups = \"drop\"\n  ) %&gt;%\n  filter(n_ids &gt; 1) %&gt;%\n  kbl(\n    caption = \"Duplicate records\",\n    align = \"l\"\n  ) %&gt;%\n  kable_classic(full_width = FALSE)\n\n\n\nDuplicate records\n\n\nX\np23_cdarea\np23_cdmedicao\np23_cdparcela\np23_cdsubparcela\np23_nrindividuo\np23_cdespecie\ngenero\nepiteto\np23_cdcif\ndiametromm\np23_lgmudancapdm\np23_cdtratamento\np23_cdiluminacao\nUPA\nUMF\ndiametrocm\nnome_pop\ncod_upa\nexploit_year\napu_area_ha\nauthorized_area_ha\ncutting_intens_m3_ha\nauthorized_vol_m3\nnome_corrigido\nnome_florabr\nn_ids\nids",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html#keep-only-live-trees",
    "href": "12_harmonizing_pps_data.html#keep-only-live-trees",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "2.6 Keep only live trees",
    "text": "2.6 Keep only live trees\n\n2.6.1 Remove dead trees\nWe will remove all records with column cd23_cif == 5, 6, 7, 8, 9 or 10.\n\n\nCode\npps %&gt;%\n  filter(p23_cdcif %in% 5:10) %&gt;%\n  count(UMF, \n        UPA, \n        name = \"Removed records\") %&gt;%\n  kbl(\n    caption = \"Dead trees (cd23_cif = 5–10) by APU\"\n  ) %&gt;%\n  kable_classic(full_width = FALSE)\n\n\n\nDead trees (cd23_cif = 5–10) by APU\n\n\nUMF\nUPA\nRemoved records\n\n\n\n\nUMF_I\nUPA_1\n286\n\n\nUMF_I\nUPA_10\n183\n\n\nUMF_I\nUPA_13\n58\n\n\nUMF_I\nUPA_2\n272\n\n\nUMF_I\nUPA_3\n281\n\n\nUMF_I\nUPA_4\n241\n\n\nUMF_I\nUPA_5\n239\n\n\nUMF_I\nUPA_6\n162\n\n\nUMF_I\nUPA_7\n94\n\n\nUMF_I\nUPA_8\n69\n\n\nUMF_I\nUPA_9\n69\n\n\nUMF_IV\nUPA_15\n79\n\n\n\n\n\nCode\npps_live &lt;- pps[!pps$p23_cdcif %in% 5:10, ]",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "12_harmonizing_pps_data.html#data-aggregation",
    "href": "12_harmonizing_pps_data.html#data-aggregation",
    "title": "2  Harmonizing Permanent Plots data",
    "section": "2.9 Data aggregation",
    "text": "2.9 Data aggregation\nTo visualize some variables of interest.\n\n2.9.1 Taxonomic Diversity\nTo evaluate taxonomic diversity, we used functions from the entropart package in R (Marcon et al., 2020). We estimated all these indices at both species and genus level.\nWe quantified taxonomic diversity using Hill numbers, a family of diversity measures that account for both species richness and evenness.\n\n2.9.1.1 Species Richness\nDiversity of Order q = 0: Species richness, which counts all species equally, regardless of their abundance.\n\n\n2.9.1.2 Shannon Diversity\nDiversity of Order q = 1: Shannon diversity, calculated as the exponential of Shannon entropy, which gives proportional weight to species based on their relative abundances. This index balances sensitivity to both common and rare species.\n\n\n2.9.1.3 Simpson Diversity\nDiversity of Order q = 2: Simpson diversity, calculated as the inverse of the Simpson index, which emphasizes dominant species and is less sensitive to rare taxa.\n\n\n2.9.1.4 Evenness\nEvenness reflects how uniformly individuals are distributed among the observed species. It was derived by dividing the observed diversity (for a given value of q) by the theoretical maximum diversity for the same number of species. Values closer to 1 indicate communities where individuals are more evenly distributed across species, while lower values indicate dominance by a few species.\n\n\n2.9.1.5 Coverage\nSample coverage estimates the proportion of individuals in a community that belong to species already detected in the sample. It provides an indication of sampling completeness, with values approaching 1 suggesting that most of the community has been captured and that further sampling is unlikely to yield many additional species.\nThe following figures represent all the above mentioned indices at the species and genus level. The y axis shows the different census years, while the x-axis shows the value of the indices. The different coloured lines represent the plots.\n\n\nCode\nrm(list = setdiff(ls(), c(\"data_cor\", \"params\")))\ndata_aggr &lt;- c()\n\n\n\n\nCode\n# for each census year, add information on previous and next census years\ndata_year &lt;- data_cor |&gt;\n  ungroup() |&gt;\n  select(Site, Plot, Year) |&gt;\n  unique() |&gt;\n  drop_na() |&gt;\n  arrange(Site, Plot, Year) |&gt;\n  group_by(Site, Plot) |&gt;\n  mutate(\n    prev_census = c(NA, Year[-length(Year)]),\n    next_census = c(Year[-1], NA)\n  ) |&gt;\n  ungroup()\n\n# add information on each tree's recruitment and mortality years\ndata_cor &lt;- data_cor |&gt;\n  left_join(data_year) |&gt;\n  mutate(\n    recr_year = min(Year),\n    mort_year = max(Year), .by = IdStem\n  )\n\n\n\n\nCode\n# Calculate neutral diversity indices per plot and year\n\n# species\nneutral_div_sp &lt;- data_cor %&gt;%\n  subset(!is.na(Species)) %&gt;%\n  group_by(UMF, Site, Year = Year, ScientificName) %&gt;%\n  summarise(count = n(), .groups = \"drop\") %&gt;%\n  group_by(UMF, Site, Year) %&gt;%\n  summarise(\n    diversity_q0_sp = Diversity(count,\n      q = 0, SampleCoverage = 0.8,\n      Correction = \"None\"\n    ),\n    diversity_q1_sp = Diversity(count,\n      q = 1, SampleCoverage = 0.8,\n      Correction = \"None\"\n    ),\n    diversity_q2_sp = Diversity(count,\n      q = 2, SampleCoverage = 0.8,\n      Correction = \"None\"\n    ),\n    evenness_sp = Shannon(count, SampleCoverage = 0.8, Correction = \"None\") /\n      log(n_distinct(ScientificName)),\n    coverage_sp = Coverage(count)\n  ) %&gt;%\n  pivot_longer(\n    cols = contains(\"_sp\"),\n    names_to = \"variable\",\n    values_to = \"value\"\n  )\n\n# genera\nneutral_div_gen &lt;- data_cor %&gt;%\n  subset(!is.na(Genus)) %&gt;%\n  group_by(UMF, Site, Year = Year, genus = Genus) %&gt;%\n  summarise(count = n(), .groups = \"drop\") %&gt;%\n  group_by(UMF, Site, Year) %&gt;%\n  summarise(\n    diversity_q0_gen = Diversity(count,\n      q = 0, SampleCoverage = 0.9,\n      Correction = \"None\"\n    ),\n    diversity_q1_gen = Diversity(count,\n      q = 1, SampleCoverage = 0.9,\n      Correction = \"None\"\n    ),\n    diversity_q2_gen = Diversity(count,\n      q = 2, SampleCoverage = 0.9,\n      Correction = \"None\"\n    ),\n    evenness_gen = Shannon(count, SampleCoverage = 0.9, Correction = \"None\") /\n      log(n_distinct(genus)),\n    coverage_gen = Coverage(count)\n  ) %&gt;%\n  pivot_longer(\n    cols = contains(\"_gen\"),\n    names_to = \"variable\",\n    values_to = \"value\"\n  )\n\n# Add to main dataframe with aggregatd data\ndata_aggr &lt;- data_aggr %&gt;%\n  rbind(neutral_div_sp) %&gt;%\n  rbind(neutral_div_gen)\n\n\n\n\nCode\naggr_fig &lt;- function(data, vars_names, title_fig = NULL) {\n  g &lt;- data %&gt;%\n    subset(variable %in% names(var_names)) %&gt;%\n    ggplot(aes(x = Year, \n               y = value, \n               color = paste(UMF,Site))) +\n#    geom_boxplot(aes(x = Year,\n#                     y = value,\n#                     group = Year),\n#    inherit.aes = FALSE,\n#    alpha = 0.2,\n#    width = 0.5\n#  ) +\n  geom_line(alpha = 0.8) +\n  facet_wrap(~ variable, \n             scales = \"free_y\",\n             labeller = labeller(variable = var_names)) +\n    labs(\n      title = title_fig,\n      x = NULL, y = NULL, color = NULL\n    ) +\n  theme_minimal()\n    if (length(var_names) == 5) {\n    g + theme(legend.position = c(0.82, 0.17),\n              legend.text = element_text(size = 6),\n              legend.title = element_text(size = 7)) +\n        guides(color=guide_legend(ncol=2))\n  } else {\n    g\n  }\n}\n\n\n\n\nCode\n# Plot temporal trajectories of different indices across plots\nif (isTRUE(params$print)) {\n  var_names &lt;- c(\n    coverage = \"Coverage\",\n    diversity_q0 = \"Richness\",\n    diversity_q1 = \"Shannon Diversity\",\n    diversity_q2 = \"Simpson Diversity\",\n    evenness = \"Evenness\"\n  )\n\n  data_aggr %&gt;%\n    subset(variable %in% neutral_div_sp$variable) %&gt;%\n    mutate(variable = factor(gsub(\"_sp\", \"\", variable),\n      levels = c(\n        paste0(\"diversity_q\", 0:2),\n        \"evenness\", \"coverage\"\n      )\n    )) %&gt;%\n    aggr_fig(var_names,\n      title_fig = paste(\n        \"Diversity Indices Across Plots and Years\",\n        \"(Species level)\"\n      )\n    )\n\n  data_aggr %&gt;%\n    subset(variable %in% neutral_div_gen$variable) %&gt;%\n    mutate(variable = factor(gsub(\"_gen\", \"\", variable),\n      levels = c(\n        paste0(\"diversity_q\", 0:2),\n        \"evenness\", \"coverage\"\n      )\n    )) %&gt;%\n    aggr_fig(var_names,\n      title_fig = paste(\n        \"Diversity Indices Across APUs and Years\",\n        \"(Genus level)\"\n      )\n    )\n}",
    "crumbs": [
      "Data preparation",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Harmonizing Permanent Plots data</span>"
    ]
  },
  {
    "objectID": "21_data_exploration.html",
    "href": "21_data_exploration.html",
    "title": "4  Exploring data",
    "section": "",
    "text": "4.1 Introduction\nThis script explores the relationships among ecological variables in our dataset. We use LiDAR-derived total height (Chapter 7), commercial height, and diameter at breast height (DBH) from the Commercial Forest Inventories (Chapter 3), as well as DBH from the Permanent Plots (Chapter 1).",
    "crumbs": [
      "Data Exploration",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Exploring data</span>"
    ]
  },
  {
    "objectID": "21_data_exploration.html#setup",
    "href": "21_data_exploration.html#setup",
    "title": "4  Exploring data",
    "section": "4.2 Setup",
    "text": "4.2 Setup\n\n\nCode\nlibrary(dplyr)\nlibrary(ggplot2)",
    "crumbs": [
      "Data Exploration",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Exploring data</span>"
    ]
  },
  {
    "objectID": "21_data_exploration.html#exploring-lidar-derived-height-relationships",
    "href": "21_data_exploration.html#exploring-lidar-derived-height-relationships",
    "title": "4  Exploring data",
    "section": "4.3 Exploring Lidar derived height relationships",
    "text": "4.3 Exploring Lidar derived height relationships\n\n4.3.1 Load data\n\n\nCode\nif100_lidar &lt;- read.csv(\"output/tree_height/all_tables.csv\")\n\nif100_lidar &lt;- if100_lidar[!is.na(if100_lidar$z_lidar),]\n\n\n\n\n4.3.2 Exploring data\n\n\nCode\nordem_especies &lt;- names(\n  sort(\n    tapply(if100_lidar$z_lidar,\n           if100_lidar$nome_florabr,\n           max),\n    decreasing = TRUE\n  ))\n\n\nif100_lidar$nome_florabr &lt;- factor(if100_lidar$nome_florabr,\n                                   levels = rev(ordem_especies))\n\nggplot(data = if100_lidar,\n   aes(x = nome_florabr,\n       y = z_lidar)) +\n  stat_summary(fun = max, \n               geom = \"col\",\n               fill = \"steelblue\") +\n  scale_y_continuous(breaks = seq(0, \n                                  max(if100_lidar$z_lidar), \n                                  by = 10)) +\n  coord_flip() +\n  theme_minimal() +\n  labs(\n    x = \"Species\",\n    y = \"Maximum Lidar derived height (m)\",\n    title = \"Maximum LiDAR-derived tree height by species\")\n\n\n\n\n\n\n\n\n\nCode\nmin_10_obs &lt;- if100_lidar %&gt;%\n  group_by(nome_florabr) %&gt;%\n  filter(n() &gt; 10) %&gt;%\n  ungroup()\n\n\nggplot(min_10_obs,\n       aes(x = DAP,\n           y = z_lidar)) +\n  geom_point(alpha = 0.6,\n             color = \"steelblue\") +\n  geom_smooth(method = \"lm\",\n              se = FALSE,\n              color = \"black\") +\n  facet_wrap(~ nome_florabr,\n             scales = \"free\") +\n  theme_minimal() +\n  labs(\n    x = \"DBH (cm)\",\n    y = \"Lidar derived Height (m)\",\n    title = \"DBH x Lidar derived Height relationship by species\",\n    subtitle = \"Only species with more than 10 samples\")\n\n\n`geom_smooth()` using formula = 'y ~ x'",
    "crumbs": [
      "Data Exploration",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Exploring data</span>"
    ]
  },
  {
    "objectID": "21_data_exploration.html#exploring-dbh-relationships",
    "href": "21_data_exploration.html#exploring-dbh-relationships",
    "title": "4  Exploring data",
    "section": "4.4 Exploring DBH relationships",
    "text": "4.4 Exploring DBH relationships\n\n4.4.1 Load data\n\n\nCode\nif100_romaneio &lt;- read.csv(\"output/if100/if100_romaneio_madeflona.csv\")\npps &lt;- read.csv(\"output/pps/tabelao_pps.csv\")\n\n\n\n\n4.4.2 Exploring data\nPreparing commercial forest inventories (IF100) data.\n\n\nCode\nmax_dap_if100 &lt;- tapply(if100_romaneio$DAP,\n                  if100_romaneio$nome_florabr,\n                  max)\n\nordem_especies_if100 &lt;- names(sort(max_dap_if100, decreasing = TRUE))\n\ntop20_species_if100 &lt;- ordem_especies_if100[1:30]\n\nhighest_dbh_if100 &lt;- if100_romaneio[if100_romaneio$nome_florabr %in% top20_species_if100, ]\n\nhighest_dbh_if100$nome_florabr &lt;- factor(highest_dbh_if100$nome_florabr,\n                                   levels = rev(top20_species_if100))\n\nif100_romaneio$nome_florabr &lt;- factor(if100_romaneio$nome_florabr,\n                                      levels = rev(ordem_especies_if100))\n\n\nPreparing Permanent Plots data.\n\n\nCode\nmax_dap_pps &lt;- tapply(pps$diametrocm,\n                  pps$nome_florabr,\n                  max)\n\nordem_especies_pps &lt;- names(sort(max_dap_pps, decreasing = TRUE))\n\ntop20_species_pps &lt;- ordem_especies_pps[1:30]\n\nhighest_dbh_pps &lt;- pps[pps$nome_florabr %in% top20_species_pps, ]\n\nhighest_dbh_pps$nome_florabr &lt;- factor(highest_dbh_pps$nome_florabr,\n                                   levels = rev(top20_species_pps))\n\npps$nome_florabr &lt;- factor(pps$nome_florabr,\n                                      levels = rev(ordem_especies_pps))\n\n\nVisualizing data.\n\n\nCode\nggplot(highest_dbh_if100, aes(x = nome_florabr, \n                        y = DAP)) +\n  stat_summary(fun = max, \n               geom = \"col\", \n               fill = \"steelblue\") +\n  scale_y_continuous(\n    breaks = seq(0, \n                 max(highest_dbh_if100$DAP), \n                 by = 50)\n  ) +\n  coord_flip() +\n  theme_minimal() +\n  labs(\n    x = \"Species\",\n    y = \"DBH (cm)\",\n    title = \"Maximum DBH by species\",\n    subtitle = \"Top 30 species with highest DBH - Forest Inventories\"\n  )\n\n\n\n\n\n\n\n\n\nCode\nggplot(highest_dbh_pps, aes(x = nome_florabr, \n                        y = diametrocm)) +\n  stat_summary(fun = max, \n               geom = \"col\", \n               fill = \"steelblue\") +\n  scale_y_continuous(\n    breaks = seq(0, \n                 max(highest_dbh_pps$diametrocm), \n                 by = 50)\n  ) +\n  coord_flip() +\n  theme_minimal() +\n  labs(\n    x = \"Species\",\n    y = \"DBH (cm)\",\n    title = \"Maximum DBH by species\",\n    subtitle = \"Top 30 species with highest DBH - Permanent Plots\"\n  )\n\n\n\n\n\n\n\n\n\nCode\nggplot(highest_dbh_if100, \n       aes(x = nome_florabr, \n           y = DAP)) +\n  geom_boxplot(fill = \"steelblue\", \n               color = \"black\") +\n  coord_flip() +\n  scale_y_continuous(\n    breaks = seq(0,\n                 max(highest_dbh_if100$DAP), \n                 by = 50)\n  ) +\n  theme_minimal() +\n  labs(\n    x = \"Species\",\n    y = \"DBH (cm)\",\n    title = \"DBH distribution by species\",\n    subtitle = \"Top 30 species with highest DBH - Forest Inventories\"\n  )\n\n\n\n\n\n\n\n\n\nCode\nggplot(highest_dbh_pps, aes(x = nome_florabr, \n                            y = diametrocm)) +\n  geom_boxplot(fill = \"steelblue\", \n               color = \"black\") +\n  coord_flip() +\n  scale_y_continuous(\n    breaks = seq(0,\n                 max(highest_dbh_pps$diametrocm), \n                 by = 50)\n  ) +\n  theme_minimal() +\n  labs(\n    x = \"Species\",\n    y = \"DBH (cm)\",\n    title = \"DBH distribution by species\",\n    subtitle = \"Top 30 species with highest DBH - Permanent Plots\"\n  )\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nImportant\n\n\n\nDinizia excelsa shows the greatest total height and DBH in the IF100 dataset, but ranks only fourth in DBH within the Permanent Plots. Bertholletia excelsa is a protected species in Brazil and therefore cannot be harvested; as a result, its height could not be estimated using the LiDAR-based methodology.\n\n\n\n\n4.4.3 DBH x Commercial height relationships\n\n\nCode\nggplot(if100_romaneio, aes(x = DAP, \n                           y = Altura, \n                           color = nome_florabr)) +\n  geom_point(alpha = 0.6, \n             size = 1.5) +\n  geom_smooth(\n    method = \"lm\",\n    se = TRUE,\n    color = \"black\",\n    linewidth = 1\n  ) +\n  theme_minimal() +\n  labs(\n    x = \"DBH (cm)\",\n    y = \"Commercial Height (m)\",\n    title = \"DBH x Commercial Height relationship by species\",\n    subtitle = \"Forest inventories\"\n  ) +\n  guides(color = \"none\")\n\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\n\n\n4.4.4 DBH x Commercial height relationships by APU\n\n\nCode\nggplot(if100_romaneio, aes(x = DAP, \n                           y = Altura, \n                           color = nome_florabr)) +\n  geom_point(alpha = 0.6, \n             size = 1.5) +\n  geom_smooth(\n    method = \"lm\",\n    se = TRUE,\n    color = \"black\",\n    linewidth = 1\n  ) +\n  facet_wrap(~ codigo) +\n  theme_minimal() +\n  labs(\n    x = \"DBH (cm)\",\n    y = \"Commercial Height (m)\",\n    title = \"DBH x Commercial Height relationship by APU\",\n    subtitle = \"Forest inventories\"\n  ) +\n  guides(color = \"none\")\n\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\n\n\n4.4.5 Permanent plots\nLet’s see permanent plots structures. We will use only the first measurement (before exploitation).\n\n\nCode\npps$cod_parcela &lt;- paste(pps$cod_upa,\n                             pps$p23_cdparcela,\n                             sep = \"_\")\n                          \n\nmean_dbh_plot_first_year &lt;- pps %&gt;%\n                              group_by(cod_parcela) %&gt;%\n                              filter(p23_cdmedicao == min(p23_cdmedicao)) %&gt;%\n                              mutate(cod_parcela_ano = paste(cod_parcela,\n                                                             p23_cdmedicao,\n                                                             sep=\"_\")) %&gt;%\n                              summarise(mean_DAP = mean(diametrocm, na.rm = TRUE))\n\nmax_plot &lt;- mean_dbh_plot_first_year[\n  which.max(mean_dbh_plot_first_year$mean_DAP), ]\n\nmin_plot &lt;- mean_dbh_plot_first_year[\n  which.min(mean_dbh_plot_first_year$mean_DAP), ]\n\n\n\nbinwidth_fd &lt;- 2 * IQR(mean_dbh_plot_first_year$mean_DAP,\n                       na.rm = TRUE) / length(mean_dbh_plot_first_year$mean_DAP)^(1/3)\n\nggplot(mean_dbh_plot_first_year, \n       aes(x = mean_DAP)) +\n  geom_histogram(binwidth = binwidth_fd,\n                 fill = \"steelblue\",\n                 color = \"white\") +\n  \n  geom_vline(xintercept = max_plot$mean_DAP,\n             linetype = \"dashed\",\n             color = \"darkred\") +\n  \n  geom_vline(xintercept = min_plot$mean_DAP,\n             linetype = \"dashed\",\n             color = \"darkgreen\") +\n  \n  annotate(\n    \"text\",\n    x = max_plot$mean_DAP,\n    y = Inf,\n    label = paste0(\"Max: \", max_plot$cod_parcela,\n                   \"\\n(\", round(max_plot$mean_DAP, \n                                1),\n                   \" cm)\"),\n    vjust = 2,\n    hjust = 1,\n    color = \"darkred\",\n    size = 3.5\n  ) +\n  \n  annotate(\n    \"text\",\n    x = min_plot$mean_DAP,\n    y = Inf,\n    label = paste0(\"Min: \", \n                   min_plot$cod_parcela,\n                   \"\\n(\", \n                   round(min_plot$mean_DAP, \n                         1),\n                   \" cm)\"),\n    vjust = 2,\n    hjust = 0,\n    color = \"darkgreen\",\n    size = 3.5\n  ) +\n  \n  theme_minimal() +\n  labs(\n    x = \"Mean DBH (cm)\",\n    y = \"Number of plots\",\n    title = \"Distribution of mean DBH across permanent plots\",\n    subtitle = \"Only measurement from the first year (before exploitation)\")\n\n\n\n\n\n\n\n\n\nCode\npps_classes &lt;- pps %&gt;%\n  #group_by(cod_upa) %&gt;%\n  mutate(\n    dbh_class = cut(\n      diametrocm,\n      breaks = seq(0, max(diametrocm, \n                          na.rm = TRUE) + 10, \n                   by = 10),\n      right = FALSE))\n\nggplot(pps_classes,\n       aes(x = diametrocm)) +\n  geom_histogram(\n    binwidth = 10,\n    fill = \"steelblue\",\n    color = \"white\") +\n  facet_wrap(~ cod_upa, scales = \"free_y\") +\n  theme_minimal() +\n  labs(x = \"DBH class (cm)\",\n       y = \"Number of individuals\",\n       title = \"Diameter class distribution by APU\",\n       subtitle = \"Class width = 10 cm\") +\n  theme(strip.text = element_text(size = 8),\n        axis.text.x = element_text(angle = 45, hjust = 1))\n\n\n\n\n\n\n\n\n\nCode\nggplot(pps_classes,\n       aes(x = diametrocm)) +\n  geom_histogram(\n    binwidth = 10,\n    fill = \"steelblue\",\n    color = \"white\") +\n  facet_wrap(~ cod_parcela, scales = \"fixed\") +\n  theme_minimal() +\n  labs(x = \"DBH class (cm)\",\n       y = \"Number of individuals\",\n       title = \"Diameter class distribution by plot\",\n       subtitle = \"Class width = 10 cm\") +\n  theme(axis.text.x = element_text(angle = 45,\n                                   hjust = 1,\n                                   size = 7),\n        strip.text.x = element_text(size = 5))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWarning\n\n\n\nWe can see most of the plots exhibit an “inverse J” distribution.\n\n\n\n\n4.4.6 Temporal dynamics\nNow let’s see mean DBH change along the years of measurement.\n\n\nCode\nmean_dbh_plot_first_year$class &lt;- cut(\n  mean_dbh_plot_first_year$mean_DAP,\n  breaks = quantile(mean_dbh_plot_first_year$mean_DAP,\n                    probs = seq(0, 1, 0.2),\n                    na.rm = TRUE),\n  include.lowest = TRUE)\n\nmean_dbh_plot_year &lt;- pps %&gt;%\n  group_by(cod_upa, cod_parcela, p23_cdmedicao, \n           exploit_year) %&gt;%\n  summarise(mean_dbh = mean(diametrocm, \n                            na.rm = TRUE),\n            .groups = \"drop\")\n\nanos &lt;- sort(unique(mean_dbh_plot_year$p23_cdmedicao))\n\nggplot(mean_dbh_plot_year,\n       aes(x = p23_cdmedicao,\n           y = mean_dbh,\n           group = cod_parcela)) +\n  geom_line(alpha = 0.6) +\n  geom_point(size = 1.5, \n             alpha = 0.8) +\n  \n  ## Ano de exploração\n  geom_vline(\n    aes(xintercept = exploit_year),\n    linetype = \"dashed\",\n    color = \"red\",\n    linewidth = 0.6) +\n  facet_wrap(~ cod_upa, \n             scales = \"free_x\") +\n  scale_x_continuous(\n    breaks = anos,\n    labels = anos) +\n  \n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, \n                                   hjust = 1)) +\n  labs(\n    x = \"Measurement year\",\n    y = \"Mean DBH (cm)\",\n    title = \"Temporal dynamics of mean DBH by permanent plot\",\n    subtitle = \"Dashed red line indicates exploitation year\")",
    "crumbs": [
      "Data Exploration",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Exploring data</span>"
    ]
  },
  {
    "objectID": "22_wood_density_databases.html",
    "href": "22_wood_density_databases.html",
    "title": "5  Comparing wood density databases",
    "section": "",
    "text": "5.1 Introduction\nThis script compares biomass estimates derived from different wood density databases. We use the Global Wood Database (Chave et al. 2009), available through the BIOMASS package, and the Brazilian Woods Database (https://lpf.florestal.gov.br/en-us/brazilian-woods) from Brazilian Forest Service.",
    "crumbs": [
      "Data Exploration",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Comparing wood density databases</span>"
    ]
  },
  {
    "objectID": "22_wood_density_databases.html#setup",
    "href": "22_wood_density_databases.html#setup",
    "title": "5  Comparing wood density databases",
    "section": "5.2 Setup",
    "text": "5.2 Setup\n\n\nCode\nlibrary(dplyr)\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(ggrepel)\nlibrary(readr)\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\nlibrary(BIOMASS)\nlibrary(kableExtra)",
    "crumbs": [
      "Data Exploration",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Comparing wood density databases</span>"
    ]
  },
  {
    "objectID": "22_wood_density_databases.html#comparing-different-wood-databases",
    "href": "22_wood_density_databases.html#comparing-different-wood-databases",
    "title": "5  Comparing wood density databases",
    "section": "5.3 Comparing different wood databases",
    "text": "5.3 Comparing different wood databases\nBWD has many samples collected in Jamari Forest, as we can see below. We obtained the basic wood density information (g/m³) and the sample collection location for each species from the BWD website. There is no specific coordinate for the sampling location; therefore, we assigned a central coordinate to each collection location in order to determine the geographic region of origin of the sample.\n\n\nCode\nbwd &lt;- read.csv(\"data/wood_density/tabela_densidade_coordenadas.csv\")\n\nbwd_clean &lt;- bwd %&gt;%\n  filter(!is.na(long), !is.na(lat))\n\npts_bwd &lt;- st_as_sf(\n  bwd_clean,\n  coords = c(\"long\", \"lat\"),\n  crs = 4326   # WGS84 (graus decimais)\n)\n\npts_bwd_count &lt;- pts_bwd %&gt;%\n  st_coordinates() %&gt;%\n  as.data.frame() %&gt;%\n  group_by(X, Y) %&gt;%\n  summarise(n = n()) %&gt;%\n  ungroup() %&gt;%\n  st_as_sf(coords = c(\"X\", \"Y\"), crs = st_crs(pts_bwd))\n\nbrasil &lt;- ne_countries(\n  scale = \"medium\",\n  country = \"Brazil\",\n  returnclass = \"sf\"\n)\n\nggplot() +\n  geom_sf(data = brasil, \n          fill = \"gray95\", \n          color = \"gray40\") +\n  geom_sf(data = pts_bwd_count, \n          aes(size = n), \n          color = \"red\", \n          alpha = 0.7) +\n  geom_text_repel(\n    data = pts_bwd_count,\n    aes(label = n, \n        geometry = geometry),\n    stat = \"sf_coordinates\",\n    size = 3,\n    min.segment.length = 0\n  ) +\n  scale_size_continuous(name = \"Number of samples\") +\n  coord_sf() +\n  theme_minimal() +\n  labs(\n    title = paste(\"Brazilian woods database samples locations (\",\n                  nrow(pts_bwd),\n                  \"samples ).\"),\n            x = \"Longitude\",\n            y = \"Latitude\"\n  )",
    "crumbs": [
      "Data Exploration",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Comparing wood density databases</span>"
    ]
  },
  {
    "objectID": "22_wood_density_databases.html#estimating-biomass-with-bwd",
    "href": "22_wood_density_databases.html#estimating-biomass-with-bwd",
    "title": "5  Comparing wood density databases",
    "section": "5.4 Estimating biomass with BWD",
    "text": "5.4 Estimating biomass with BWD\nWe will use permanent plots measurements from Jamari National Forest. The Wood density estimates presented here are only for species the species present in the permanent plots.\nIn BWD there are multiple samples for the same species. We calculated mean basic wood density for each species with multiple samples. Then we converted bwd table to BIOMASS wood density table format.\nWe retrieved wood density from Gobal Wood Database (Chave et al. 2009) using BIOMASS.\n\n\nCode\npps &lt;- read.csv(\"output/pps/tabelao_pps.csv\")\n\nmessage(\"Permanent plots of APUs: \\n\",paste(unique(paste(pps$UMF,\n                                                         pps$UPA)),\n                                                         collapse = \"\\n\"\n                                                         ))\n\n\nPermanent plots of APUs: \nUMF_I UPA_1\nUMF_I UPA_10\nUMF_I UPA_13\nUMF_I UPA_2\nUMF_I UPA_3\nUMF_I UPA_4\nUMF_I UPA_5\nUMF_I UPA_6\nUMF_I UPA_7\nUMF_I UPA_8\nUMF_I UPA_9\nUMF_IV UPA_15\n\n\nCode\nmessage(\"Years of measurement:\\n\",paste(unique(pps$p23_cdmedicao),\n                                         collapse = \"\\n\"))\n\n\nYears of measurement:\n2010\n2013\n2016\n2018\n2021\n2015\n2017\n2023\n2020\n2022\n2011\n2012\n2014\n2019\n\n\nCode\nbwd &lt;- bwd %&gt;%\n  group_by(nome_cientifico) %&gt;%\n  summarise(mean_wd = mean(densidade_basica), \n            .groups = \"drop\")\n\nbwd_biomass &lt;- bwd %&gt;%\n  tidyr::separate(\"nome_cientifico\",\n                  c(\"genero\",\"epiteto\"),\n                  \" \")\nnames(bwd_biomass) &lt;- c(\"genus\",\"species\",\"wd\")\n\ntaxo &lt;- data.frame(\n  genusCorrected   = pps$genero,\n  speciesCorrected = pps$epiteto,\n  stringsAsFactors = FALSE\n)\n\nw_density &lt;- getWoodDensity(genus = taxo$genusCorrected,\n                            species = taxo$speciesCorrected)\n\n\nThe reference dataset contains 16467 wood density values\n\n\nYour taxonomic table contains 104 taxa\n\n\nCode\ndensidades &lt;- bwd_biomass %&gt;%\n                  inner_join(w_density,\n                  by = c(\"genus\",\n                         \"species\")) %&gt;%\n                  select(genus,\n                         species,\n                         WD_global = meanWD,\n                         WD_brazil = wd)\n\ndensidades &lt;- unique(densidades)\n\nggplot(densidades, aes(x = WD_global, \n                       y = WD_brazil)) +\n  geom_point(alpha = 0.7) +\n  geom_abline(slope = 1, \n              intercept = 0, \n              linetype = \"dashed\") +\n  labs(\n    x = \"Global Wood density database\",\n    y = \"Brazilian Woods density database\",\n    title = paste(\"Comparison of wood density estimates for\",\n                  nrow(densidades),\n                  \"species between BWD and GWD\")\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nCode\ntext &lt;- paste(\"BWD has wood density of\",\n              length(unique(bwd$nome_cientifico)),\n              \"species.\",\n              \"BWD and GWD share\", \n              nrow(densidades),\n              \"species in common.\")\n\n\n\n\n\n\n\n\nNote\n\n\n\nBWD has wood density of 275 species. BWD and GWD share 55 species in common.\n\n\nWe can use Bland-Altman graphic to see differences between wood density databases. I will highlight species that are out of limits of agreement.\n\n\nCode\ndensidades$mean_density &lt;- (densidades$WD_global + densidades$WD_brazil) / 2\ndensidades$diff_density &lt;- densidades$WD_global - densidades$WD_brazil\n\nbias &lt;- mean(densidades$diff_density, \n             na.rm = TRUE)\nsd_diff &lt;- sd(densidades$diff_density, \n              na.rm = TRUE)\n\nloa_inf &lt;- bias - 1.96 * sd_diff\nloa_sup &lt;- bias + 1.96 * sd_diff\n\ndensidades &lt;- densidades %&gt;%\n                 mutate(fora_loa = diff_density &lt; loa_inf | diff_density &gt; loa_sup)\n\ndensidades$especie &lt;- paste(densidades$genus,\n                            densidades$species,\n                            sep = \" \")\n\nggplot(densidades, aes(x = mean_density, \n                       y = diff_density,\n                       color = especie)) +\n  geom_point(alpha = 0.7) +\n  geom_hline(yintercept = mean(densidades$diff_density,\n                               na.rm = TRUE),\n             linetype = \"dashed\") +\n  geom_hline(yintercept = mean(densidades$diff_density,\n                               na.rm = TRUE) +\n                           1.96 * sd(densidades$diff_density,\n                                     na.rm = TRUE),\n             linetype = \"dotted\") +\n  geom_hline(yintercept = mean(densidades$diff_density,\n                               na.rm = TRUE) -\n                           1.96 * sd(densidades$diff_density,\n                                     na.rm = TRUE),\n             linetype = \"dotted\") +\n    geom_text_repel(\n    data = subset(densidades, fora_loa),\n    aes(label = especie),\n    size = 3,\n    show.legend = FALSE\n  ) +\n  labs(\n    x = \"Mean wood density\",\n    y = \"Difference between methods\",\n    title = \"Bland–Altman: wood density databases\"\n  ) +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\n\n\n\n\n\n\n\n\nLet’s see the difference in biomass estimation.\nTotal tree height was obtained using the retrieveH function from the BIOMASS package, based on the central coordinates of the Jamari National Forest (Flona de Jamari). Biomass was estimated using the computeAGB function from the BIOMASS package, using the total height derived from retrieveH and the two wood density databases (the Global Wood Density Database and the Brazilian Wood Density Database). The BWD does not provide estimates of basic wood density for all species. When species-level values are unavailable, estimates from Global Wood Database will be used.\nEach point represents one year of measurement for a plot. I will highlight plots with biomass estimation out of limits of agreement.\n\n\nCode\nw_density_BR &lt;- left_join(w_density, \n                          bwd_biomass, \n                          by = c(\"species\",\n                                 \"genus\"), \n                          multiple = \"any\") %&gt;% \n                \n                mutate(wd = ifelse(!is.na(wd), \n                                   wd, \n                                   meanWD)) %&gt;% \n                select(family, \n                       genus, \n                       species, \n                       wd)\n\n\naltura &lt;- retrieveH(D = pps$diametrocm,\n                    coord = c(-62.99,\n                                   -9.11\n                                   ))\n\n\npps$altura &lt;- altura$H\n\npps$AGB_Global &lt;- computeAGB(D = pps$diametrocm,\n                             WD = w_density$meanWD,\n                             H = pps$altura)\n\npps$AGB_Brazilian &lt;- computeAGB(D = pps$diametrocm,\n                                WD = w_density_BR$wd,\n                                H = pps$altura)\n\npps$plot &lt;- paste(pps$UMF,pps$UPA,\n                  \"plot\",\n                  pps$p23_cdparcela,\n                  pps$p23_cdmedicao)\n\n\npps_plots &lt;- pps %&gt;% \n              group_by(plot,\n                       p23_cdmedicao) %&gt;% \n              summarise(\"AGB_Global\" = sum(AGB_Global),\n                        \"AGB_Brazilian\" = sum(AGB_Brazilian))\n\npps_plots$mean_density &lt;- (pps_plots$AGB_Global + pps_plots$AGB_Brazilian) / 2\npps_plots$diff_density &lt;- pps_plots$AGB_Global - pps_plots$AGB_Brazilian\n\nbias &lt;- mean(pps_plots$diff_density, \n             na.rm = TRUE)\nsd_diff &lt;- sd(pps_plots$diff_density, \n              na.rm = TRUE)\n\nloa_inf &lt;- bias - 1.96 * sd_diff\nloa_sup &lt;- bias + 1.96 * sd_diff\n\npps_plots &lt;- pps_plots %&gt;%\n            mutate(fora_loa = diff_density &lt; loa_inf | diff_density &gt; loa_sup)\n\n\nggplot(pps_plots, aes(x = mean_density, \n                      y = diff_density,\n                      color = plot)) +\n  geom_point(alpha = 0.7) +\n  geom_hline(yintercept = mean(pps_plots$diff_density,\n                               na.rm = TRUE),\n             linetype = \"dashed\") +\n  geom_hline(yintercept = mean(pps_plots$diff_density,\n                               na.rm = TRUE) +\n                           1.96 * sd(pps_plots$diff_density,\n                                     na.rm = TRUE),\n             linetype = \"dotted\") +\n  geom_hline(yintercept = mean(pps_plots$diff_density,\n                               na.rm = TRUE) -\n                           1.96 * sd(pps_plots$diff_density,\n                                     na.rm = TRUE),\n             linetype = \"dotted\") +\n    geom_text_repel(\n    data = subset(pps_plots, \n                  fora_loa),\n    aes(label = plot),\n    size = 3,\n    show.legend = FALSE\n  ) +\n  labs(\n    x = \"Mean plot AGB\",\n    y = \"Difference between methods\",\n    title = \"Bland-Altman: Plot AGB estimates with different wood density databases\"\n  ) +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\n\n\n\n\n\n\n\n\nCode\ndif_AGBs &lt;- pps_plots %&gt;%\n  mutate(\n    diff = abs(AGB_Global - AGB_Brazilian),\n    diff_perc = (diff / AGB_Global) * 100\n  ) %&gt;%\n  select(plot, AGB_Global, AGB_Brazilian, diff, diff_perc) %&gt;%\n  arrange(desc(diff_perc)) %&gt;%\n  mutate(diff_perc = round(diff_perc, 2))\n\n\n  kable(dif_AGBs,\n    caption = \"Absolute and relative difference between AGBs\",\n    col.names = c(\"Plot\", \"AGB Global\", \"AGB Brazilian\", \"Difference\", \"Difference (%)\")\n  ) %&gt;%\n  kable_styling(full_width = FALSE, position = \"center\") %&gt;%\n    kableExtra::scroll_box(height = \"400px\", width = \"100%\")\n\n\n\n\nAbsolute and relative difference between AGBs\n\n\nPlot\nAGB Global\nAGB Brazilian\nDifference\nDifference (%)\n\n\n\n\nUMF_I UPA_2 plot 8 2011\n49.78417\n45.76349\n4.0206756\n8.08\n\n\nUMF_I UPA_2 plot 8 2013\n55.63526\n51.35464\n4.2806251\n7.69\n\n\nUMF_I UPA_2 plot 8 2016\n61.40135\n56.92133\n4.4800279\n7.30\n\n\nUMF_I UPA_5 plot 9 2019\n109.08370\n101.74244\n7.3412640\n6.73\n\n\nUMF_I UPA_2 plot 8 2021\n73.91046\n69.07685\n4.8336139\n6.54\n\n\nUMF_I UPA_7 plot 4 2020\n88.43654\n93.77966\n5.3431237\n6.04\n\n\nUMF_I UPA_7 plot 4 2019\n88.39637\n93.73296\n5.3365841\n6.04\n\n\nUMF_I UPA_5 plot 9 2013\n111.49535\n104.78220\n6.7131586\n6.02\n\n\nUMF_I UPA_5 plot 9 2015\n112.98623\n106.31004\n6.6761913\n5.91\n\n\nUMF_I UPA_8 plot 1 2017\n124.77302\n117.94769\n6.8253253\n5.47\n\n\nUMF_I UPA_9 plot 1 2017\n124.77302\n117.94769\n6.8253253\n5.47\n\n\nUMF_I UPA_8 plot 1 2019\n126.01309\n119.18066\n6.8324362\n5.42\n\n\nUMF_I UPA_9 plot 1 2019\n126.01309\n119.18066\n6.8324362\n5.42\n\n\nUMF_I UPA_4 plot 9 2012\n140.66985\n133.49095\n7.1788979\n5.10\n\n\nUMF_I UPA_6 plot 1 2014\n175.80782\n166.87583\n8.9319891\n5.08\n\n\nUMF_I UPA_10 plot 4 2023\n62.14742\n65.22646\n3.0790489\n4.95\n\n\nUMF_I UPA_4 plot 9 2014\n143.46225\n136.38440\n7.0778559\n4.93\n\n\nUMF_I UPA_2 plot 2 2016\n71.63603\n75.05387\n3.4178394\n4.77\n\n\nUMF_I UPA_1 plot 5 2010\n55.47410\n58.11771\n2.6436094\n4.77\n\n\nUMF_I UPA_2 plot 2 2021\n80.44123\n84.21434\n3.7731018\n4.69\n\n\nUMF_I UPA_5 plot 8 2019\n99.86790\n104.50618\n4.6382782\n4.64\n\n\nUMF_I UPA_10 plot 4 2015\n63.31582\n66.16888\n2.8530553\n4.51\n\n\nUMF_I UPA_10 plot 4 2017\n65.12840\n68.05299\n2.9245835\n4.49\n\n\nUMF_I UPA_10 plot 3 2015\n56.63193\n59.12236\n2.4904342\n4.40\n\n\nUMF_I UPA_10 plot 3 2017\n58.55062\n61.02998\n2.4793597\n4.23\n\n\nUMF_I UPA_13 plot 3 2020\n62.05757\n64.55164\n2.4940658\n4.02\n\n\nUMF_I UPA_13 plot 3 2022\n64.53398\n67.12730\n2.5933256\n4.02\n\n\nUMF_I UPA_5 plot 8 2013\n94.08163\n97.77032\n3.6886900\n3.92\n\n\nUMF_I UPA_5 plot 8 2015\n96.84418\n100.61929\n3.7751154\n3.90\n\n\nUMF_I UPA_6 plot 1 2016\n131.47873\n126.41455\n5.0641793\n3.85\n\n\nUMF_I UPA_2 plot 1 2011\n98.18137\n94.53309\n3.6482772\n3.72\n\n\nUMF_I UPA_2 plot 1 2016\n108.69576\n104.71439\n3.9813761\n3.66\n\n\nUMF_I UPA_2 plot 1 2021\n121.96488\n117.51318\n4.4516999\n3.65\n\n\nUMF_I UPA_2 plot 1 2013\n105.35751\n101.52762\n3.8298872\n3.64\n\n\nUMF_I UPA_5 plot 3 2019\n48.23569\n49.90397\n1.6682865\n3.46\n\n\nUMF_I UPA_6 plot 9 2014\n67.70705\n70.03345\n2.3264038\n3.44\n\n\nUMF_I UPA_8 plot 4 2017\n78.54076\n75.87703\n2.6637348\n3.39\n\n\nUMF_I UPA_9 plot 4 2017\n78.54076\n75.87703\n2.6637348\n3.39\n\n\nUMF_I UPA_6 plot 9 2016\n71.71043\n74.10109\n2.3906627\n3.33\n\n\nUMF_I UPA_8 plot 4 2019\n80.51725\n77.86603\n2.6512117\n3.29\n\n\nUMF_I UPA_9 plot 4 2019\n80.51725\n77.86603\n2.6512117\n3.29\n\n\nUMF_I UPA_5 plot 7 2019\n41.30085\n42.60685\n1.3060015\n3.16\n\n\nUMF_I UPA_8 plot 6 2019\n92.84010\n95.71768\n2.8775724\n3.10\n\n\nUMF_I UPA_9 plot 6 2019\n92.84010\n95.71768\n2.8775724\n3.10\n\n\nUMF_IV UPA_15 plot 3 2020\n50.75750\n52.32646\n1.5689553\n3.09\n\n\nUMF_I UPA_8 plot 6 2017\n89.49599\n92.23748\n2.7414901\n3.06\n\n\nUMF_I UPA_9 plot 6 2017\n89.49599\n92.23748\n2.7414901\n3.06\n\n\nUMF_IV UPA_15 plot 3 2022\n52.16722\n53.76304\n1.5958216\n3.06\n\n\nUMF_I UPA_4 plot 3 2012\n40.24498\n41.46130\n1.2163188\n3.02\n\n\nUMF_I UPA_7 plot 2 2020\n46.42593\n47.78968\n1.3637562\n2.94\n\n\nUMF_I UPA_1 plot 5 2013\n60.07885\n61.83601\n1.7571584\n2.92\n\n\nUMF_I UPA_6 plot 1 2020\n117.53119\n114.16292\n3.3682747\n2.87\n\n\nUMF_I UPA_4 plot 3 2014\n43.32220\n44.56010\n1.2378913\n2.86\n\n\nUMF_I UPA_4 plot 7 2012\n83.91347\n81.52543\n2.3880359\n2.85\n\n\nUMF_I UPA_1 plot 1 2010\n141.59067\n137.59897\n3.9916962\n2.82\n\n\nUMF_I UPA_7 plot 2 2019\n46.62393\n47.92261\n1.2986812\n2.79\n\n\nUMF_I UPA_10 plot 5 2015\n38.72413\n37.64722\n1.0769117\n2.78\n\n\nUMF_I UPA_1 plot 6 2010\n65.29853\n67.08520\n1.7866696\n2.74\n\n\nUMF_I UPA_5 plot 7 2015\n70.60840\n72.53069\n1.9222901\n2.72\n\n\nUMF_I UPA_1 plot 1 2013\n148.99734\n144.96700\n4.0303350\n2.70\n\n\nUMF_I UPA_4 plot 7 2014\n87.17371\n84.84377\n2.3299357\n2.67\n\n\nUMF_I UPA_5 plot 7 2013\n68.70582\n70.53507\n1.8292548\n2.66\n\n\nUMF_I UPA_3 plot 6 2012\n69.67803\n67.83784\n1.8401950\n2.64\n\n\nUMF_I UPA_10 plot 5 2017\n40.46484\n39.40227\n1.0625623\n2.63\n\n\nUMF_I UPA_13 plot 2 2022\n70.29663\n72.12250\n1.8258754\n2.60\n\n\nUMF_I UPA_3 plot 6 2013\n73.11365\n71.21718\n1.8964629\n2.59\n\n\nUMF_I UPA_3 plot 6 2023\n77.08552\n75.09241\n1.9931084\n2.59\n\n\nUMF_I UPA_4 plot 3 2018\n48.82881\n50.08417\n1.2553580\n2.57\n\n\nUMF_I UPA_13 plot 2 2020\n68.37757\n70.09773\n1.7201612\n2.52\n\n\nUMF_I UPA_3 plot 6 2017\n73.11969\n71.28398\n1.8357061\n2.51\n\n\nUMF_I UPA_4 plot 5 2018\n78.34285\n80.30077\n1.9579185\n2.50\n\n\nUMF_I UPA_6 plot 9 2020\n65.41002\n67.04035\n1.6303362\n2.49\n\n\nUMF_I UPA_1 plot 4 2010\n78.28289\n80.22775\n1.9448626\n2.48\n\n\nUMF_I UPA_4 plot 3 2023\n53.59144\n54.91902\n1.3275800\n2.48\n\n\nUMF_I UPA_4 plot 5 2014\n71.53291\n73.28962\n1.7567086\n2.46\n\n\nUMF_I UPA_4 plot 7 2018\n93.20928\n90.92654\n2.2827417\n2.45\n\n\nUMF_I UPA_5 plot 3 2015\n63.98371\n65.54751\n1.5638015\n2.44\n\n\nUMF_I UPA_2 plot 2 2011\n138.44420\n141.81538\n3.3711764\n2.44\n\n\nUMF_I UPA_4 plot 5 2012\n68.39018\n70.05366\n1.6634802\n2.43\n\n\nUMF_I UPA_1 plot 3 2016\n103.81550\n106.34005\n2.5245486\n2.43\n\n\nUMF_I UPA_1 plot 4 2018\n73.86184\n75.63370\n1.7718551\n2.40\n\n\nUMF_I UPA_6 plot 3 2020\n56.57611\n57.92632\n1.3502119\n2.39\n\n\nUMF_I UPA_2 plot 2 2013\n144.59019\n147.97494\n3.3847444\n2.34\n\n\nUMF_I UPA_1 plot 4 2021\n74.88661\n76.63932\n1.7527131\n2.34\n\n\nUMF_I UPA_5 plot 3 2013\n61.97244\n63.41857\n1.4461294\n2.33\n\n\nUMF_I UPA_3 plot 7 2023\n89.55115\n87.47834\n2.0728058\n2.31\n\n\nUMF_I UPA_3 plot 7 2017\n83.44802\n81.54640\n1.9016255\n2.28\n\n\nUMF_I UPA_4 plot 9 2023\n64.19795\n62.73879\n1.4591629\n2.27\n\n\nUMF_I UPA_1 plot 2 2010\n53.79504\n55.01628\n1.2212372\n2.27\n\n\nUMF_I UPA_1 plot 8 2021\n61.87745\n63.27444\n1.3969969\n2.26\n\n\nUMF_I UPA_3 plot 8 2023\n83.69963\n85.58468\n1.8850439\n2.25\n\n\nUMF_I UPA_8 plot 5 2019\n34.47048\n35.23482\n0.7643388\n2.22\n\n\nUMF_I UPA_9 plot 5 2019\n34.47048\n35.23482\n0.7643388\n2.22\n\n\nUMF_I UPA_1 plot 3 2010\n99.65737\n101.84870\n2.1913247\n2.20\n\n\nUMF_I UPA_1 plot 8 2016\n56.88342\n58.12381\n1.2403869\n2.18\n\n\nUMF_I UPA_1 plot 8 2018\n59.28152\n60.56873\n1.2872083\n2.17\n\n\nUMF_I UPA_3 plot 4 2023\n79.33470\n77.61907\n1.7156268\n2.16\n\n\nUMF_I UPA_1 plot 3 2013\n105.75754\n108.03683\n2.2792864\n2.16\n\n\nUMF_I UPA_4 plot 6 2018\n62.57151\n63.91201\n1.3404997\n2.14\n\n\nUMF_I UPA_1 plot 4 2016\n76.24741\n77.87986\n1.6324443\n2.14\n\n\nUMF_I UPA_1 plot 9 2010\n90.62348\n92.55793\n1.9344442\n2.13\n\n\nUMF_I UPA_3 plot 7 2012\n82.01588\n80.26592\n1.7499671\n2.13\n\n\nUMF_I UPA_3 plot 7 2013\n85.42467\n83.60381\n1.8208562\n2.13\n\n\nUMF_I UPA_1 plot 3 2018\n105.37675\n107.62059\n2.2438437\n2.13\n\n\nUMF_I UPA_1 plot 3 2021\n110.20383\n112.51870\n2.3148729\n2.10\n\n\nUMF_I UPA_3 plot 4 2017\n77.02731\n75.41305\n1.6142586\n2.10\n\n\nUMF_I UPA_8 plot 3 2017\n91.84758\n93.75445\n1.9068729\n2.08\n\n\nUMF_I UPA_9 plot 3 2017\n91.84758\n93.75445\n1.9068729\n2.08\n\n\nUMF_I UPA_8 plot 3 2019\n93.68835\n95.62978\n1.9414310\n2.07\n\n\nUMF_I UPA_9 plot 3 2019\n93.68835\n95.62978\n1.9414310\n2.07\n\n\nUMF_I UPA_4 plot 7 2023\n85.31005\n83.55186\n1.7581920\n2.06\n\n\nUMF_I UPA_8 plot 5 2017\n30.83416\n31.46883\n0.6346720\n2.06\n\n\nUMF_I UPA_9 plot 5 2017\n30.83416\n31.46883\n0.6346720\n2.06\n\n\nUMF_I UPA_13 plot 6 2022\n86.40409\n88.18142\n1.7773310\n2.06\n\n\nUMF_I UPA_13 plot 6 2020\n84.81513\n86.55165\n1.7365152\n2.05\n\n\nUMF_I UPA_3 plot 1 2017\n93.58411\n91.68251\n1.9015995\n2.03\n\n\nUMF_I UPA_4 plot 5 2023\n82.27265\n83.93260\n1.6599519\n2.02\n\n\nUMF_I UPA_6 plot 7 2020\n64.48849\n65.78338\n1.2948954\n2.01\n\n\nUMF_I UPA_3 plot 1 2013\n92.12634\n90.34460\n1.7817429\n1.93\n\n\nUMF_I UPA_2 plot 6 2021\n88.92697\n87.20792\n1.7190527\n1.93\n\n\nUMF_I UPA_3 plot 1 2012\n89.74763\n88.01856\n1.7290652\n1.93\n\n\nUMF_I UPA_3 plot 1 2023\n98.74674\n96.84718\n1.8995586\n1.92\n\n\nUMF_I UPA_4 plot 8 2023\n62.91237\n64.11419\n1.2018205\n1.91\n\n\nUMF_I UPA_1 plot 4 2013\n84.71152\n86.32938\n1.6178511\n1.91\n\n\nUMF_I UPA_2 plot 6 2013\n72.39286\n71.01508\n1.3777797\n1.90\n\n\nUMF_I UPA_2 plot 6 2016\n79.88236\n78.36775\n1.5146101\n1.90\n\n\nUMF_I UPA_7 plot 3 2020\n37.75361\n38.46851\n0.7148984\n1.89\n\n\nUMF_I UPA_7 plot 3 2019\n37.58997\n38.30057\n0.7106029\n1.89\n\n\nUMF_I UPA_1 plot 6 2018\n79.22584\n77.73220\n1.4936418\n1.89\n\n\nUMF_I UPA_7 plot 6 2020\n76.84243\n78.26924\n1.4268055\n1.86\n\n\nUMF_I UPA_7 plot 6 2019\n76.45739\n77.87579\n1.4183963\n1.86\n\n\nUMF_I UPA_6 plot 4 2020\n55.27042\n56.29516\n1.0247416\n1.85\n\n\nUMF_I UPA_4 plot 6 2014\n57.15729\n58.20641\n1.0491145\n1.84\n\n\nUMF_I UPA_6 plot 8 2014\n80.01950\n81.47478\n1.4552807\n1.82\n\n\nUMF_I UPA_2 plot 4 2011\n96.16023\n94.41840\n1.7418342\n1.81\n\n\nUMF_I UPA_2 plot 6 2011\n66.75033\n65.54787\n1.2024664\n1.80\n\n\nUMF_I UPA_2 plot 4 2013\n100.56273\n98.77820\n1.7845297\n1.77\n\n\nUMF_I UPA_1 plot 9 2021\n108.15476\n110.06666\n1.9118998\n1.77\n\n\nUMF_I UPA_4 plot 6 2012\n53.90106\n54.85001\n0.9489575\n1.76\n\n\nUMF_I UPA_10 plot 8 2015\n76.60485\n77.95310\n1.3482513\n1.76\n\n\nUMF_I UPA_1 plot 6 2016\n77.12099\n75.76869\n1.3523052\n1.75\n\n\nUMF_I UPA_10 plot 8 2017\n78.26024\n79.62969\n1.3694572\n1.75\n\n\nUMF_I UPA_1 plot 9 2018\n103.01691\n104.81830\n1.8013842\n1.75\n\n\nUMF_I UPA_6 plot 8 2016\n82.73919\n84.18556\n1.4463757\n1.75\n\n\nUMF_I UPA_3 plot 2 2023\n87.55731\n86.05718\n1.5001349\n1.71\n\n\nUMF_I UPA_4 plot 9 2018\n63.08077\n62.01486\n1.0659035\n1.69\n\n\nUMF_I UPA_3 plot 8 2012\n76.48495\n77.77480\n1.2898512\n1.69\n\n\nUMF_I UPA_4 plot 8 2018\n61.43267\n62.45680\n1.0241310\n1.67\n\n\nUMF_I UPA_3 plot 2 2017\n84.48085\n83.08389\n1.3969600\n1.65\n\n\nUMF_I UPA_1 plot 2 2016\n65.67454\n66.75800\n1.0834597\n1.65\n\n\nUMF_I UPA_1 plot 9 2013\n95.79155\n97.35707\n1.5655202\n1.63\n\n\nUMF_I UPA_5 plot 5 2015\n64.84191\n65.89449\n1.0525843\n1.62\n\n\nUMF_I UPA_5 plot 5 2013\n63.19198\n64.21549\n1.0235017\n1.62\n\n\nUMF_I UPA_5 plot 10 2015\n69.19741\n70.31497\n1.1175542\n1.62\n\n\nUMF_I UPA_2 plot 7 2016\n70.90359\n69.76314\n1.1404425\n1.61\n\n\nUMF_I UPA_3 plot 8 2013\n79.42413\n80.69837\n1.2742404\n1.60\n\n\nUMF_I UPA_13 plot 1 2022\n78.01820\n79.26652\n1.2483240\n1.60\n\n\nUMF_I UPA_4 plot 6 2023\n64.34666\n65.37483\n1.0281715\n1.60\n\n\nUMF_I UPA_1 plot 2 2021\n67.56413\n68.64286\n1.0787234\n1.60\n\n\nUMF_I UPA_13 plot 5 2020\n45.56140\n46.28546\n0.7240602\n1.59\n\n\nUMF_I UPA_13 plot 8 2022\n52.23611\n53.06279\n0.8266777\n1.58\n\n\nUMF_I UPA_5 plot 10 2013\n66.57363\n67.62568\n1.0520450\n1.58\n\n\nUMF_I UPA_13 plot 1 2020\n76.25764\n77.45406\n1.1964251\n1.57\n\n\nUMF_I UPA_1 plot 6 2013\n71.46023\n70.34148\n1.1187464\n1.57\n\n\nUMF_I UPA_13 plot 5 2022\n47.39914\n48.13703\n0.7378831\n1.56\n\n\nUMF_I UPA_4 plot 4 2014\n59.50858\n60.43472\n0.9261397\n1.56\n\n\nUMF_I UPA_13 plot 8 2020\n50.98947\n51.78075\n0.7912733\n1.55\n\n\nUMF_I UPA_3 plot 8 2017\n81.09508\n82.33227\n1.2371862\n1.53\n\n\nUMF_I UPA_4 plot 4 2012\n56.87086\n57.73384\n0.8629793\n1.52\n\n\nUMF_I UPA_5 plot 10 2019\n72.95890\n74.05974\n1.1008397\n1.51\n\n\nUMF_I UPA_10 plot 8 2023\n73.56025\n74.66892\n1.1086706\n1.51\n\n\nUMF_I UPA_1 plot 9 2016\n104.66734\n106.23096\n1.5636226\n1.49\n\n\nUMF_I UPA_2 plot 3 2016\n70.50813\n69.46436\n1.0437755\n1.48\n\n\nUMF_I UPA_2 plot 7 2021\n76.13251\n75.00818\n1.1243280\n1.48\n\n\nUMF_IV UPA_15 plot 2 2022\n98.74045\n97.28317\n1.4572871\n1.48\n\n\nUMF_IV UPA_15 plot 2 2020\n97.45259\n96.01660\n1.4359886\n1.47\n\n\nUMF_I UPA_1 plot 2 2018\n68.20128\n69.20472\n1.0034468\n1.47\n\n\nUMF_I UPA_2 plot 3 2021\n81.37186\n80.18205\n1.1898072\n1.46\n\n\nUMF_I UPA_2 plot 3 2013\n69.79904\n68.78026\n1.0187847\n1.46\n\n\nUMF_I UPA_1 plot 2 2013\n61.88458\n62.78657\n0.9019917\n1.46\n\n\nUMF_I UPA_6 plot 7 2016\n68.70774\n69.70901\n1.0012759\n1.46\n\n\nUMF_I UPA_2 plot 7 2013\n70.89011\n69.85988\n1.0302270\n1.45\n\n\nUMF_I UPA_6 plot 7 2014\n67.47663\n68.44021\n0.9635778\n1.43\n\n\nUMF_I UPA_5 plot 1 2019\n90.86566\n92.16302\n1.2973597\n1.43\n\n\nUMF_I UPA_2 plot 7 2011\n65.49202\n64.56168\n0.9303363\n1.42\n\n\nUMF_I UPA_6 plot 4 2016\n62.23487\n63.11545\n0.8805732\n1.41\n\n\nUMF_I UPA_6 plot 4 2014\n57.61442\n58.41779\n0.8033667\n1.39\n\n\nUMF_I UPA_10 plot 7 2017\n64.17284\n65.06394\n0.8910982\n1.39\n\n\nUMF_I UPA_4 plot 4 2018\n65.74774\n66.65737\n0.9096273\n1.38\n\n\nUMF_I UPA_2 plot 3 2011\n61.81673\n60.96325\n0.8534875\n1.38\n\n\nUMF_I UPA_10 plot 7 2015\n62.10232\n62.94780\n0.8454744\n1.36\n\n\nUMF_I UPA_10 plot 7 2023\n66.00121\n66.89919\n0.8979759\n1.36\n\n\nUMF_I UPA_3 plot 4 2013\n88.96555\n87.76129\n1.2042664\n1.35\n\n\nUMF_IV UPA_15 plot 4 2020\n49.51833\n48.84890\n0.6694356\n1.35\n\n\nUMF_I UPA_5 plot 4 2019\n57.98692\n58.76763\n0.7807015\n1.35\n\n\nUMF_I UPA_3 plot 4 2012\n86.21513\n85.06654\n1.1485848\n1.33\n\n\nUMF_I UPA_4 plot 8 2014\n60.99722\n61.79394\n0.7967169\n1.31\n\n\nUMF_I UPA_5 plot 1 2015\n96.62997\n97.86797\n1.2379950\n1.28\n\n\nUMF_IV UPA_15 plot 4 2022\n51.02614\n50.37884\n0.6472966\n1.27\n\n\nUMF_I UPA_4 plot 1 2014\n99.55331\n100.78863\n1.2353146\n1.24\n\n\nUMF_I UPA_4 plot 8 2012\n56.95336\n57.65442\n0.7010619\n1.23\n\n\nUMF_I UPA_5 plot 1 2013\n94.39891\n95.55004\n1.1511343\n1.22\n\n\nUMF_I UPA_13 plot 4 2022\n82.50755\n83.49894\n0.9913893\n1.20\n\n\nUMF_I UPA_13 plot 4 2020\n80.37445\n81.33181\n0.9573547\n1.19\n\n\nUMF_I UPA_4 plot 1 2012\n96.85337\n98.00653\n1.1531593\n1.19\n\n\nUMF_I UPA_10 plot 3 2023\n53.80592\n54.44106\n0.6351407\n1.18\n\n\nUMF_I UPA_6 plot 2 2020\n43.71303\n44.20093\n0.4879055\n1.12\n\n\nUMF_I UPA_10 plot 2 2023\n63.50069\n62.79932\n0.7013696\n1.10\n\n\nUMF_I UPA_6 plot 3 2016\n68.01510\n68.74598\n0.7308836\n1.07\n\n\nUMF_I UPA_3 plot 5 2012\n46.09271\n45.59783\n0.4948804\n1.07\n\n\nUMF_I UPA_3 plot 2 2013\n90.47815\n89.51823\n0.9599262\n1.06\n\n\nUMF_I UPA_5 plot 4 2013\n68.88582\n69.60691\n0.7210914\n1.05\n\n\nUMF_I UPA_3 plot 2 2012\n86.64463\n85.74108\n0.9035441\n1.04\n\n\nUMF_I UPA_5 plot 4 2015\n70.69376\n71.42920\n0.7354401\n1.04\n\n\nUMF_I UPA_1 plot 10 2010\n78.02907\n78.83287\n0.8038040\n1.03\n\n\nUMF_I UPA_3 plot 5 2013\n48.58948\n48.10361\n0.4858700\n1.00\n\n\nUMF_I UPA_7 plot 1 2020\n44.15510\n44.58483\n0.4297336\n0.97\n\n\nUMF_I UPA_7 plot 1 2019\n43.97294\n44.39937\n0.4264318\n0.97\n\n\nUMF_I UPA_6 plot 10 2016\n42.77583\n43.18735\n0.4115190\n0.96\n\n\nUMF_I UPA_7 plot 7 2019\n71.38729\n70.71808\n0.6692170\n0.94\n\n\nUMF_I UPA_10 plot 5 2023\n39.22463\n38.85817\n0.3664532\n0.93\n\n\nUMF_I UPA_6 plot 10 2014\n38.23924\n38.59431\n0.3550766\n0.93\n\n\nUMF_I UPA_7 plot 7 2020\n71.77288\n71.10683\n0.6660560\n0.93\n\n\nUMF_I UPA_6 plot 8 2020\n64.27557\n64.86683\n0.5912558\n0.92\n\n\nUMF_IV UPA_15 plot 1 2020\n85.66747\n84.89497\n0.7725050\n0.90\n\n\nUMF_I UPA_4 plot 4 2023\n63.04084\n63.60904\n0.5682029\n0.90\n\n\nUMF_I UPA_2 plot 4 2021\n77.42662\n76.74579\n0.6808313\n0.88\n\n\nUMF_I UPA_6 plot 3 2014\n66.90394\n67.49047\n0.5865315\n0.88\n\n\nUMF_IV UPA_15 plot 1 2022\n87.35465\n86.59366\n0.7609898\n0.87\n\n\nUMF_I UPA_3 plot 3 2013\n84.61047\n83.87583\n0.7346432\n0.87\n\n\nUMF_I UPA_1 plot 6 2021\n64.89678\n65.45626\n0.5594741\n0.86\n\n\nUMF_I UPA_1 plot 5 2021\n52.16414\n51.71444\n0.4496935\n0.86\n\n\nUMF_I UPA_3 plot 5 2017\n50.05510\n49.62707\n0.4280239\n0.86\n\n\nUMF_I UPA_3 plot 3 2012\n81.53275\n80.83752\n0.6952286\n0.85\n\n\nUMF_I UPA_3 plot 5 2023\n51.86898\n51.42948\n0.4395053\n0.85\n\n\nUMF_I UPA_7 plot 8 2020\n89.54130\n90.29225\n0.7509533\n0.84\n\n\nUMF_I UPA_7 plot 8 2019\n89.34384\n90.09226\n0.7484156\n0.84\n\n\nUMF_I UPA_3 plot 3 2017\n82.47439\n81.78563\n0.6887610\n0.84\n\n\nUMF_I UPA_3 plot 3 2023\n87.47240\n86.75832\n0.7140807\n0.82\n\n\nUMF_I UPA_8 plot 7 2019\n58.83860\n59.30061\n0.4620051\n0.79\n\n\nUMF_I UPA_9 plot 7 2019\n58.83860\n59.30061\n0.4620051\n0.79\n\n\nUMF_I UPA_5 plot 6 2013\n65.40087\n64.90076\n0.5001170\n0.76\n\n\nUMF_I UPA_6 plot 2 2014\n42.16957\n41.85613\n0.3134444\n0.74\n\n\nUMF_I UPA_6 plot 5 2014\n74.23097\n73.68984\n0.5411267\n0.73\n\n\nUMF_I UPA_5 plot 6 2015\n67.84900\n67.36446\n0.4845461\n0.71\n\n\nUMF_I UPA_1 plot 5 2018\n49.43925\n49.08748\n0.3517625\n0.71\n\n\nUMF_I UPA_5 plot 5 2019\n45.13145\n45.45032\n0.3188698\n0.71\n\n\nUMF_I UPA_13 plot 7 2022\n79.77982\n80.33656\n0.5567359\n0.70\n\n\nUMF_I UPA_13 plot 7 2020\n77.39105\n77.91421\n0.5231639\n0.68\n\n\nUMF_I UPA_5 plot 6 2019\n67.57095\n67.12176\n0.4491889\n0.66\n\n\nUMF_I UPA_6 plot 5 2016\n73.14978\n72.66495\n0.4848302\n0.66\n\n\nUMF_I UPA_10 plot 1 2023\n84.99371\n85.53011\n0.5363965\n0.63\n\n\nUMF_I UPA_1 plot 7 2010\n48.37900\n48.68136\n0.3023567\n0.62\n\n\nUMF_I UPA_4 plot 10 2023\n116.53078\n115.80563\n0.7251568\n0.62\n\n\nUMF_I UPA_8 plot 7 2017\n55.68702\n56.03201\n0.3449874\n0.62\n\n\nUMF_I UPA_9 plot 7 2017\n55.68702\n56.03201\n0.3449874\n0.62\n\n\nUMF_I UPA_4 plot 2 2018\n54.00996\n54.34087\n0.3309095\n0.61\n\n\nUMF_I UPA_6 plot 2 2016\n44.53567\n44.26407\n0.2715974\n0.61\n\n\nUMF_I UPA_4 plot 10 2012\n112.79100\n112.10639\n0.6846067\n0.61\n\n\nUMF_I UPA_1 plot 10 2013\n85.05974\n85.56967\n0.5099252\n0.60\n\n\nUMF_I UPA_6 plot 5 2020\n83.75145\n83.27018\n0.4812609\n0.57\n\n\nUMF_I UPA_2 plot 9 2016\n95.03303\n94.53889\n0.4941441\n0.52\n\n\nUMF_I UPA_4 plot 10 2014\n116.95538\n116.35725\n0.5981315\n0.51\n\n\nUMF_I UPA_8 plot 2 2019\n56.53209\n56.81470\n0.2826127\n0.50\n\n\nUMF_I UPA_9 plot 2 2019\n56.53209\n56.81470\n0.2826127\n0.50\n\n\nUMF_I UPA_2 plot 4 2016\n63.55154\n63.23934\n0.3121983\n0.49\n\n\nUMF_I UPA_3 plot 9 2023\n78.08600\n77.71997\n0.3660287\n0.47\n\n\nUMF_I UPA_2 plot 9 2021\n112.67888\n112.15249\n0.5263914\n0.47\n\n\nUMF_I UPA_1 plot 10 2016\n93.31957\n93.75176\n0.4321846\n0.46\n\n\nUMF_I UPA_6 plot 10 2020\n49.06983\n49.29309\n0.2232562\n0.45\n\n\nUMF_I UPA_2 plot 5 2021\n104.99960\n104.53147\n0.4681390\n0.45\n\n\nUMF_I UPA_3 plot 10 2013\n71.59298\n71.27629\n0.3166953\n0.44\n\n\nUMF_I UPA_10 plot 1 2017\n91.30645\n91.70979\n0.4033415\n0.44\n\n\nUMF_I UPA_4 plot 2 2012\n108.80715\n108.32791\n0.4792397\n0.44\n\n\nUMF_I UPA_4 plot 10 2018\n110.48908\n110.00539\n0.4836951\n0.44\n\n\nUMF_I UPA_3 plot 9 2012\n81.29350\n81.64255\n0.3490532\n0.43\n\n\nUMF_I UPA_1 plot 10 2018\n94.52630\n94.93131\n0.4050089\n0.43\n\n\nUMF_I UPA_8 plot 2 2017\n53.73655\n53.96239\n0.2258434\n0.42\n\n\nUMF_I UPA_9 plot 2 2017\n53.73655\n53.96239\n0.2258434\n0.42\n\n\nUMF_I UPA_3 plot 9 2017\n82.17611\n82.51290\n0.3367915\n0.41\n\n\nUMF_I UPA_3 plot 10 2012\n68.93371\n68.65249\n0.2812111\n0.41\n\n\nUMF_I UPA_10 plot 1 2015\n88.26045\n88.61520\n0.3547438\n0.40\n\n\nUMF_I UPA_2 plot 5 2016\n92.29810\n91.94119\n0.3569125\n0.39\n\n\nUMF_I UPA_10 plot 6 2017\n75.02884\n74.74635\n0.2824919\n0.38\n\n\nUMF_I UPA_3 plot 9 2013\n83.69625\n84.00952\n0.3132760\n0.37\n\n\nUMF_I UPA_10 plot 6 2015\n72.87267\n72.60231\n0.2703594\n0.37\n\n\nUMF_I UPA_1 plot 1 2016\n68.44220\n68.69547\n0.2532788\n0.37\n\n\nUMF_I UPA_4 plot 2 2014\n111.15618\n110.77485\n0.3813256\n0.34\n\n\nUMF_I UPA_2 plot 5 2013\n82.59449\n82.32679\n0.2677017\n0.32\n\n\nUMF_I UPA_4 plot 1 2023\n99.61186\n99.91806\n0.3062021\n0.31\n\n\nUMF_I UPA_2 plot 9 2013\n84.28983\n84.03138\n0.2584545\n0.31\n\n\nUMF_I UPA_4 plot 2 2023\n55.26882\n55.43507\n0.1662474\n0.30\n\n\nUMF_I UPA_8 plot 8 2019\n62.52768\n62.69680\n0.1691232\n0.27\n\n\nUMF_I UPA_9 plot 8 2019\n62.52768\n62.69680\n0.1691232\n0.27\n\n\nUMF_I UPA_1 plot 1 2018\n71.14094\n71.33313\n0.1921936\n0.27\n\n\nUMF_I UPA_10 plot 2 2015\n53.74205\n53.88480\n0.1427504\n0.27\n\n\nUMF_I UPA_3 plot 10 2023\n71.49882\n71.68077\n0.1819545\n0.25\n\n\nUMF_I UPA_1 plot 7 2018\n58.71161\n58.56780\n0.1438099\n0.24\n\n\nUMF_I UPA_6 plot 6 2020\n49.78098\n49.90245\n0.1214775\n0.24\n\n\nUMF_I UPA_8 plot 8 2017\n60.54031\n60.67592\n0.1356164\n0.22\n\n\nUMF_I UPA_9 plot 8 2017\n60.54031\n60.67592\n0.1356164\n0.22\n\n\nUMF_I UPA_1 plot 7 2016\n57.77350\n57.65079\n0.1227096\n0.21\n\n\nUMF_I UPA_2 plot 9 2011\n74.85400\n74.71161\n0.1423887\n0.19\n\n\nUMF_I UPA_5 plot 2 2019\n94.52580\n94.35240\n0.1734021\n0.18\n\n\nUMF_I UPA_5 plot 2 2013\n89.07632\n88.91380\n0.1625188\n0.18\n\n\nUMF_I UPA_6 plot 6 2016\n78.62709\n78.75516\n0.1280660\n0.16\n\n\nUMF_I UPA_5 plot 2 2015\n90.92365\n90.77653\n0.1471140\n0.16\n\n\nUMF_I UPA_2 plot 10 2016\n83.98366\n83.85487\n0.1287838\n0.15\n\n\nUMF_I UPA_2 plot 10 2013\n77.00184\n76.89262\n0.1092198\n0.14\n\n\nUMF_I UPA_1 plot 5 2016\n47.68992\n47.75724\n0.0673127\n0.14\n\n\nUMF_I UPA_1 plot 1 2021\n76.89511\n77.00218\n0.1070777\n0.14\n\n\nUMF_I UPA_1 plot 7 2021\n61.43515\n61.35126\n0.0838844\n0.14\n\n\nUMF_I UPA_2 plot 5 2011\n72.96436\n72.87122\n0.0931383\n0.13\n\n\nUMF_I UPA_10 plot 2 2017\n56.43735\n56.50327\n0.0659212\n0.12\n\n\nUMF_I UPA_1 plot 8 2013\n69.36293\n69.28518\n0.0777496\n0.11\n\n\nUMF_I UPA_2 plot 10 2021\n97.49249\n97.38766\n0.1048290\n0.11\n\n\nUMF_I UPA_2 plot 10 2011\n68.19918\n68.13211\n0.0670619\n0.10\n\n\nUMF_I UPA_4 plot 1 2018\n94.11279\n94.20081\n0.0880225\n0.09\n\n\nUMF_I UPA_6 plot 6 2014\n77.67906\n77.74176\n0.0627007\n0.08\n\n\nUMF_I UPA_1 plot 10 2021\n99.37983\n99.45315\n0.0733164\n0.07\n\n\nUMF_I UPA_1 plot 7 2013\n55.56796\n55.52756\n0.0404060\n0.07\n\n\nUMF_I UPA_7 plot 5 2020\n52.46662\n52.49355\n0.0269255\n0.05\n\n\nUMF_I UPA_10 plot 6 2023\n71.15509\n71.17819\n0.0230965\n0.03\n\n\nUMF_I UPA_1 plot 8 2010\n62.20382\n62.18935\n0.0144732\n0.02\n\n\nUMF_I UPA_7 plot 5 2019\n52.01084\n52.01619\n0.0053426\n0.01\n\n\nUMF_I UPA_3 plot 10 2017\n67.96002\n67.96002\n0.0000056\n0.00\n\n\n\n\n\n\nCode\ntext &lt;- max(dif_AGBs$diff_perc)\n\n\n\n\n\n\n\n\nImportant\n\n\n\nWe can see as much as 8.08 % difference in biomass estimation due to the different wood density databases.\n\n\n\n\n\n\nChave, Jerome, David Coomes, Steven Jansen, Simon L. Lewis, Nathan G. Swenson, and Amy E. Zanne. 2009. “Towards a Worldwide Wood Economics Spectrum.” Ecology Letters 12: 351–66. https://doi.org/10.1111/j.1461-0248.2009.01285.x.",
    "crumbs": [
      "Data Exploration",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Comparing wood density databases</span>"
    ]
  }
]